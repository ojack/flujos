(function(){var $94c28b103a4a6d930fad09b856750405$exports={},$7446334a50f2a0a9edc09a8962bee8ae$exports={},$9ef8fa1341c22d7f2dffb07658fdb4ff$exports={},$47097ee663d5613230304ea01db841ae$exports={},$47097ee663d5613230304ea01db841ae$var$R="object"==typeof Reflect?Reflect:null,$47097ee663d5613230304ea01db841ae$var$ReflectApply=$47097ee663d5613230304ea01db841ae$var$R&&"function"==typeof $47097ee663d5613230304ea01db841ae$var$R.apply?$47097ee663d5613230304ea01db841ae$var$R.apply:function(e,a,t){return Function.prototype.apply.call(e,a,t)},$47097ee663d5613230304ea01db841ae$var$ReflectOwnKeys;function $47097ee663d5613230304ea01db841ae$var$ProcessEmitWarning(e){console&&console.warn&&console.warn(e)}$47097ee663d5613230304ea01db841ae$var$ReflectOwnKeys=$47097ee663d5613230304ea01db841ae$var$R&&"function"==typeof $47097ee663d5613230304ea01db841ae$var$R.ownKeys?$47097ee663d5613230304ea01db841ae$var$R.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var $47097ee663d5613230304ea01db841ae$var$NumberIsNaN=Number.isNaN||function(e){return e!=e};function $47097ee663d5613230304ea01db841ae$var$EventEmitter(){$47097ee663d5613230304ea01db841ae$var$EventEmitter.init.call(this)}$47097ee663d5613230304ea01db841ae$exports=$47097ee663d5613230304ea01db841ae$var$EventEmitter;var $47097ee663d5613230304ea01db841ae$export$once=$47097ee663d5613230304ea01db841ae$var$once;$47097ee663d5613230304ea01db841ae$exports.once=$47097ee663d5613230304ea01db841ae$export$once,$47097ee663d5613230304ea01db841ae$var$EventEmitter.EventEmitter=$47097ee663d5613230304ea01db841ae$var$EventEmitter,$47097ee663d5613230304ea01db841ae$var$EventEmitter.prototype._events=void 0,$47097ee663d5613230304ea01db841ae$var$EventEmitter.prototype._eventsCount=0,$47097ee663d5613230304ea01db841ae$var$EventEmitter.prototype._maxListeners=void 0;var $47097ee663d5613230304ea01db841ae$var$defaultMaxListeners=10;function $47097ee663d5613230304ea01db841ae$var$checkListener(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function $47097ee663d5613230304ea01db841ae$var$_getMaxListeners(e){return void 0===e._maxListeners?$47097ee663d5613230304ea01db841ae$var$EventEmitter.defaultMaxListeners:e._maxListeners}function $47097ee663d5613230304ea01db841ae$var$_addListener(e,a,t,r){var c,s,d;if($47097ee663d5613230304ea01db841ae$var$checkListener(t),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",a,t.listener?t.listener:t),s=e._events),d=s[a]),void 0===d)d=s[a]=t,++e._eventsCount;else if("function"==typeof d?d=s[a]=r?[t,d]:[d,t]:r?d.unshift(t):d.push(t),(c=$47097ee663d5613230304ea01db841ae$var$_getMaxListeners(e))>0&&d.length>c&&!d.warned){d.warned=!0;var i=new Error("Possible EventEmitter memory leak detected. "+d.length+" "+String(a)+" listeners added. Use emitter.setMaxListeners() to increase limit");i.name="MaxListenersExceededWarning",i.emitter=e,i.type=a,i.count=d.length,$47097ee663d5613230304ea01db841ae$var$ProcessEmitWarning(i)}return e}function $47097ee663d5613230304ea01db841ae$var$onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function $47097ee663d5613230304ea01db841ae$var$_onceWrap(e,a,t){var r={fired:!1,wrapFn:void 0,target:e,type:a,listener:t},c=$47097ee663d5613230304ea01db841ae$var$onceWrapper.bind(r);return c.listener=t,r.wrapFn=c,c}function $47097ee663d5613230304ea01db841ae$var$_listeners(e,a,t){var r=e._events;if(void 0===r)return[];var c=r[a];return void 0===c?[]:"function"==typeof c?t?[c.listener||c]:[c]:t?$47097ee663d5613230304ea01db841ae$var$unwrapListeners(c):$47097ee663d5613230304ea01db841ae$var$arrayClone(c,c.length)}function $47097ee663d5613230304ea01db841ae$var$listenerCount(e){var a=this._events;if(void 0!==a){var t=a[e];if("function"==typeof t)return 1;if(void 0!==t)return t.length}return 0}function $47097ee663d5613230304ea01db841ae$var$arrayClone(e,a){for(var t=new Array(a),r=0;r<a;++r)t[r]=e[r];return t}function $47097ee663d5613230304ea01db841ae$var$spliceOne(e,a){for(;a+1<e.length;a++)e[a]=e[a+1];e.pop()}function $47097ee663d5613230304ea01db841ae$var$unwrapListeners(e){for(var a=new Array(e.length),t=0;t<a.length;++t)a[t]=e[t].listener||e[t];return a}function $47097ee663d5613230304ea01db841ae$var$once(e,a){return new Promise((function(t,r){function c(t){e.removeListener(a,s),r(t)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",c),t([].slice.call(arguments))}$47097ee663d5613230304ea01db841ae$var$eventTargetAgnosticAddListener(e,a,s,{once:!0}),"error"!==a&&$47097ee663d5613230304ea01db841ae$var$addErrorHandlerIfEventEmitter(e,c,{once:!0})}))}function $47097ee663d5613230304ea01db841ae$var$addErrorHandlerIfEventEmitter(e,a,t){"function"==typeof e.on&&$47097ee663d5613230304ea01db841ae$var$eventTargetAgnosticAddListener(e,"error",a,t)}function $47097ee663d5613230304ea01db841ae$var$eventTargetAgnosticAddListener(e,a,t,r){if("function"==typeof e.on)r.once?e.once(a,t):e.on(a,t);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(a,(function c(s){r.once&&e.removeEventListener(a,c),t(s)}))}}Object.defineProperty($47097ee663d5613230304ea01db841ae$var$EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return $47097ee663d5613230304ea01db841ae$var$defaultMaxListeners},set:function(e){if("number"!=typeof e||e<0||$47097ee663d5613230304ea01db841ae$var$NumberIsNaN(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");$47097ee663d5613230304ea01db841ae$var$defaultMaxListeners=e}}),$47097ee663d5613230304ea01db841ae$var$EventEmitter.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},$47097ee663d5613230304ea01db841ae$var$EventEmitter.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||$47097ee663d5613230304ea01db841ae$var$NumberIsNaN(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},$47097ee663d5613230304ea01db841ae$var$EventEmitter.prototype.getMaxListeners=function(){return $47097ee663d5613230304ea01db841ae$var$_getMaxListeners(this)},$47097ee663d5613230304ea01db841ae$var$EventEmitter.prototype.emit=function(e){for(var a=[],t=1;t<arguments.length;t++)a.push(arguments[t]);var r="error"===e,c=this._events;if(void 0!==c)r=r&&void 0===c.error;else if(!r)return!1;if(r){var s;if(a.length>0&&(s=a[0]),s instanceof Error)throw s;var d=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw d.context=s,d}var i=c[e];if(void 0===i)return!1;if("function"==typeof i)$47097ee663d5613230304ea01db841ae$var$ReflectApply(i,this,a);else{var o=i.length,n=$47097ee663d5613230304ea01db841ae$var$arrayClone(i,o);for(t=0;t<o;++t)$47097ee663d5613230304ea01db841ae$var$ReflectApply(n[t],this,a)}return!0},$47097ee663d5613230304ea01db841ae$var$EventEmitter.prototype.addListener=function(e,a){return $47097ee663d5613230304ea01db841ae$var$_addListener(this,e,a,!1)},$47097ee663d5613230304ea01db841ae$var$EventEmitter.prototype.on=$47097ee663d5613230304ea01db841ae$var$EventEmitter.prototype.addListener,$47097ee663d5613230304ea01db841ae$var$EventEmitter.prototype.prependListener=function(e,a){return $47097ee663d5613230304ea01db841ae$var$_addListener(this,e,a,!0)},$47097ee663d5613230304ea01db841ae$var$EventEmitter.prototype.once=function(e,a){return $47097ee663d5613230304ea01db841ae$var$checkListener(a),this.on(e,$47097ee663d5613230304ea01db841ae$var$_onceWrap(this,e,a)),this},$47097ee663d5613230304ea01db841ae$var$EventEmitter.prototype.prependOnceListener=function(e,a){return $47097ee663d5613230304ea01db841ae$var$checkListener(a),this.prependListener(e,$47097ee663d5613230304ea01db841ae$var$_onceWrap(this,e,a)),this},$47097ee663d5613230304ea01db841ae$var$EventEmitter.prototype.removeListener=function(e,a){var t,r,c,s,d;if($47097ee663d5613230304ea01db841ae$var$checkListener(a),void 0===(r=this._events))return this;if(void 0===(t=r[e]))return this;if(t===a||t.listener===a)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,t.listener||a));else if("function"!=typeof t){for(c=-1,s=t.length-1;s>=0;s--)if(t[s]===a||t[s].listener===a){d=t[s].listener,c=s;break}if(c<0)return this;0===c?t.shift():$47097ee663d5613230304ea01db841ae$var$spliceOne(t,c),1===t.length&&(r[e]=t[0]),void 0!==r.removeListener&&this.emit("removeListener",e,d||a)}return this},$47097ee663d5613230304ea01db841ae$var$EventEmitter.prototype.off=$47097ee663d5613230304ea01db841ae$var$EventEmitter.prototype.removeListener,$47097ee663d5613230304ea01db841ae$var$EventEmitter.prototype.removeAllListeners=function(e){var a,t,r;if(void 0===(t=this._events))return this;if(void 0===t.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==t[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete t[e]),this;if(0===arguments.length){var c,s=Object.keys(t);for(r=0;r<s.length;++r)"removeListener"!==(c=s[r])&&this.removeAllListeners(c);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(a=t[e]))this.removeListener(e,a);else if(void 0!==a)for(r=a.length-1;r>=0;r--)this.removeListener(e,a[r]);return this},$47097ee663d5613230304ea01db841ae$var$EventEmitter.prototype.listeners=function(e){return $47097ee663d5613230304ea01db841ae$var$_listeners(this,e,!0)},$47097ee663d5613230304ea01db841ae$var$EventEmitter.prototype.rawListeners=function(e){return $47097ee663d5613230304ea01db841ae$var$_listeners(this,e,!1)},$47097ee663d5613230304ea01db841ae$var$EventEmitter.listenerCount=function(e,a){return"function"==typeof e.listenerCount?e.listenerCount(a):$47097ee663d5613230304ea01db841ae$var$listenerCount.call(e,a)},$47097ee663d5613230304ea01db841ae$var$EventEmitter.prototype.listenerCount=$47097ee663d5613230304ea01db841ae$var$listenerCount,$47097ee663d5613230304ea01db841ae$var$EventEmitter.prototype.eventNames=function(){return this._eventsCount>0?$47097ee663d5613230304ea01db841ae$var$ReflectOwnKeys(this._events):[]};var $10e1dd25d7ef981085f794456239c45d$export$Device,$10e1dd25d7ef981085f794456239c45d$exports={},$10e1dd25d7ef981085f794456239c45d$var$__createBinding=$10e1dd25d7ef981085f794456239c45d$exports&&$10e1dd25d7ef981085f794456239c45d$exports.__createBinding||(Object.create?function(e,a,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,r){void 0===r&&(r=t),e[r]=a[t]}),$10e1dd25d7ef981085f794456239c45d$var$__setModuleDefault=$10e1dd25d7ef981085f794456239c45d$exports&&$10e1dd25d7ef981085f794456239c45d$exports.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),$10e1dd25d7ef981085f794456239c45d$var$__importStar=$10e1dd25d7ef981085f794456239c45d$exports&&$10e1dd25d7ef981085f794456239c45d$exports.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)"default"!==t&&Object.hasOwnProperty.call(e,t)&&$10e1dd25d7ef981085f794456239c45d$var$__createBinding(a,e,t);return $10e1dd25d7ef981085f794456239c45d$var$__setModuleDefault(a,e),a};Object.defineProperty($10e1dd25d7ef981085f794456239c45d$exports,"__esModule",{value:!0});var $10e1dd25d7ef981085f794456239c45d$export$detectDevice=($10e1dd25d7ef981085f794456239c45d$export$types=void 0,$10e1dd25d7ef981085f794456239c45d$export$version=$10e1dd25d7ef981085f794456239c45d$exports.types=$10e1dd25d7ef981085f794456239c45d$export$types,$10e1dd25d7ef981085f794456239c45d$export$Device=$10e1dd25d7ef981085f794456239c45d$exports.version=$10e1dd25d7ef981085f794456239c45d$export$version,$10e1dd25d7ef981085f794456239c45d$exports.Device=$10e1dd25d7ef981085f794456239c45d$export$Device);$10e1dd25d7ef981085f794456239c45d$exports.detectDevice=$10e1dd25d7ef981085f794456239c45d$export$detectDevice;var $300fb327e45c7345f50fad064ffa0c99$exports={},$300fb327e45c7345f50fad064ffa0c99$var$__createBinding=$300fb327e45c7345f50fad064ffa0c99$exports&&$300fb327e45c7345f50fad064ffa0c99$exports.__createBinding||(Object.create?function(e,a,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,r){void 0===r&&(r=t),e[r]=a[t]}),$300fb327e45c7345f50fad064ffa0c99$var$__setModuleDefault=$300fb327e45c7345f50fad064ffa0c99$exports&&$300fb327e45c7345f50fad064ffa0c99$exports.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),$300fb327e45c7345f50fad064ffa0c99$var$__importStar=$300fb327e45c7345f50fad064ffa0c99$exports&&$300fb327e45c7345f50fad064ffa0c99$exports.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)"default"!==t&&Object.hasOwnProperty.call(e,t)&&$300fb327e45c7345f50fad064ffa0c99$var$__createBinding(a,e,t);return $300fb327e45c7345f50fad064ffa0c99$var$__setModuleDefault(a,e),a},$300fb327e45c7345f50fad064ffa0c99$var$__importDefault=$300fb327e45c7345f50fad064ffa0c99$exports&&$300fb327e45c7345f50fad064ffa0c99$exports.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty($300fb327e45c7345f50fad064ffa0c99$exports,"__esModule",{value:!0});var $300fb327e45c7345f50fad064ffa0c99$export$Device=($300fb327e45c7345f50fad064ffa0c99$export$detectDevice=void 0,$300fb327e45c7345f50fad064ffa0c99$exports.detectDevice=$300fb327e45c7345f50fad064ffa0c99$export$detectDevice);$300fb327e45c7345f50fad064ffa0c99$exports.Device=$300fb327e45c7345f50fad064ffa0c99$export$Device;var $486312f63fefa61d7f5e5449fd7c99f5$exports={},$486312f63fefa61d7f5e5449fd7c99f5$export$bowser,$486312f63fefa61d7f5e5449fd7c99f5$var$define,e,t;e=$486312f63fefa61d7f5e5449fd7c99f5$exports,t=function(){return function(e){var a={};function t(r){if(a[r])return a[r].exports;var c=a[r]={i:r,l:!1,exports:{}};return e[r].call(c.exports,c,c.exports,t),c.l=!0,c.exports}return t.m=e,t.c=a,t.d=function(e,a,r){t.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,a){if(1&a&&(e=t(e)),8&a)return e;if(4&a&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&a&&"string"!=typeof e)for(var c in e)t.d(r,c,function(a){return e[a]}.bind(null,c));return r},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},t.p="",t(t.s=90)}({17:function(e,a,t){a.__esModule=!0,a.default=void 0;var r=t(18),c=function(){function e(){}return e.getFirstMatch=function(e,a){var t=a.match(e);return t&&t.length>0&&t[1]||""},e.getSecondMatch=function(e,a){var t=a.match(e);return t&&t.length>1&&t[2]||""},e.matchAndReturnConst=function(e,a,t){if(e.test(a))return t},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var a=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(a.push(0),10===a[0])switch(a[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var a=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(a.push(0),!(1===a[0]&&a[1]<5))return 1===a[0]&&a[1]<6?"Cupcake":1===a[0]&&a[1]>=6?"Donut":2===a[0]&&a[1]<2?"Eclair":2===a[0]&&2===a[1]?"Froyo":2===a[0]&&a[1]>2?"Gingerbread":3===a[0]?"Honeycomb":4===a[0]&&a[1]<1?"Ice Cream Sandwich":4===a[0]&&a[1]<4?"Jelly Bean":4===a[0]&&a[1]>=4?"KitKat":5===a[0]?"Lollipop":6===a[0]?"Marshmallow":7===a[0]?"Nougat":8===a[0]?"Oreo":9===a[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(a,t,r){void 0===r&&(r=!1);var c=e.getVersionPrecision(a),s=e.getVersionPrecision(t),d=Math.max(c,s),i=0,o=e.map([a,t],(function(a){var t=d-e.getVersionPrecision(a),r=a+new Array(t+1).join(".0");return e.map(r.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(r&&(i=d-Math.min(c,s)),d-=1;d>=i;){if(o[0][d]>o[1][d])return 1;if(o[0][d]===o[1][d]){if(d===i)return 0;d-=1}else if(o[0][d]<o[1][d])return-1}},e.map=function(e,a){var t,r=[];if(Array.prototype.map)return Array.prototype.map.call(e,a);for(t=0;t<e.length;t+=1)r.push(a(e[t]));return r},e.find=function(e,a){var t,r;if(Array.prototype.find)return Array.prototype.find.call(e,a);for(t=0,r=e.length;t<r;t+=1){var c=e[t];if(a(c,t))return c}},e.assign=function(e){for(var a,t,r=e,c=arguments.length,s=new Array(c>1?c-1:0),d=1;d<c;d++)s[d-1]=arguments[d];if(Object.assign)return Object.assign.apply(Object,[e].concat(s));var i=function(){var e=s[a];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(a){r[a]=e[a]}))};for(a=0,t=s.length;a<t;a+=1)i();return e},e.getBrowserAlias=function(e){return r.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return r.BROWSER_MAP[e]||""},e}();a.default=c,e.exports=a.default},18:function(e,a,t){a.__esModule=!0,a.ENGINE_MAP=a.OS_MAP=a.PLATFORMS_MAP=a.BROWSER_MAP=a.BROWSER_ALIASES_MAP=void 0,a.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},a.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},a.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},a.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},a.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,a,t){a.__esModule=!0,a.default=void 0;var r,c=(r=t(91))&&r.__esModule?r:{default:r},s=t(18);function d(e,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){}var a,t;return e.getParser=function(e,a){if(void 0===a&&(a=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new c.default(e,a)},e.parse=function(e){return new c.default(e).getResult()},a=e,(t=[{key:"BROWSER_MAP",get:function(){return s.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return s.ENGINE_MAP}},{key:"OS_MAP",get:function(){return s.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return s.PLATFORMS_MAP}}])&&d(a,t),e}();a.default=i,e.exports=a.default},91:function(e,a,t){a.__esModule=!0,a.default=void 0;var r=o(t(92)),c=o(t(93)),s=o(t(94)),d=o(t(95)),i=o(t(17));function o(e){return e&&e.__esModule?e:{default:e}}var n=function(){function e(e,a){if(void 0===a&&(a=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==a&&this.parse()}var a=e.prototype;return a.getUA=function(){return this._ua},a.test=function(e){return e.test(this._ua)},a.parseBrowser=function(){var e=this;this.parsedResult.browser={};var a=i.default.find(r.default,(function(a){if("function"==typeof a.test)return a.test(e);if(a.test instanceof Array)return a.test.some((function(a){return e.test(a)}));throw new Error("Browser's test function is not valid")}));return a&&(this.parsedResult.browser=a.describe(this.getUA())),this.parsedResult.browser},a.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},a.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},a.getBrowserVersion=function(){return this.getBrowser().version},a.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},a.parseOS=function(){var e=this;this.parsedResult.os={};var a=i.default.find(c.default,(function(a){if("function"==typeof a.test)return a.test(e);if(a.test instanceof Array)return a.test.some((function(a){return e.test(a)}));throw new Error("Browser's test function is not valid")}));return a&&(this.parsedResult.os=a.describe(this.getUA())),this.parsedResult.os},a.getOSName=function(e){var a=this.getOS().name;return e?String(a).toLowerCase()||"":a||""},a.getOSVersion=function(){return this.getOS().version},a.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},a.getPlatformType=function(e){void 0===e&&(e=!1);var a=this.getPlatform().type;return e?String(a).toLowerCase()||"":a||""},a.parsePlatform=function(){var e=this;this.parsedResult.platform={};var a=i.default.find(s.default,(function(a){if("function"==typeof a.test)return a.test(e);if(a.test instanceof Array)return a.test.some((function(a){return e.test(a)}));throw new Error("Browser's test function is not valid")}));return a&&(this.parsedResult.platform=a.describe(this.getUA())),this.parsedResult.platform},a.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},a.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},a.parseEngine=function(){var e=this;this.parsedResult.engine={};var a=i.default.find(d.default,(function(a){if("function"==typeof a.test)return a.test(e);if(a.test instanceof Array)return a.test.some((function(a){return e.test(a)}));throw new Error("Browser's test function is not valid")}));return a&&(this.parsedResult.engine=a.describe(this.getUA())),this.parsedResult.engine},a.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},a.getResult=function(){return i.default.assign({},this.parsedResult)},a.satisfies=function(e){var a=this,t={},r=0,c={},s=0;if(Object.keys(e).forEach((function(a){var d=e[a];"string"==typeof d?(c[a]=d,s+=1):"object"==typeof d&&(t[a]=d,r+=1)})),r>0){var d=Object.keys(t),o=i.default.find(d,(function(e){return a.isOS(e)}));if(o){var n=this.satisfies(t[o]);if(void 0!==n)return n}var f=i.default.find(d,(function(e){return a.isPlatform(e)}));if(f){var $=this.satisfies(t[f]);if(void 0!==$)return $}}if(s>0){var b=Object.keys(c),p=i.default.find(b,(function(e){return a.isBrowser(e,!0)}));if(void 0!==p)return this.compareVersion(c[p])}},a.isBrowser=function(e,a){void 0===a&&(a=!1);var t=this.getBrowserName().toLowerCase(),r=e.toLowerCase(),c=i.default.getBrowserTypeByAlias(r);return a&&c&&(r=c.toLowerCase()),r===t},a.compareVersion=function(e){var a=[0],t=e,r=!1,c=this.getBrowserVersion();if("string"==typeof c)return">"===e[0]||"<"===e[0]?(t=e.substr(1),"="===e[1]?(r=!0,t=e.substr(2)):a=[],">"===e[0]?a.push(1):a.push(-1)):"="===e[0]?t=e.substr(1):"~"===e[0]&&(r=!0,t=e.substr(1)),a.indexOf(i.default.compareVersions(c,t,r))>-1},a.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},a.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},a.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},a.is=function(e,a){return void 0===a&&(a=!1),this.isBrowser(e,a)||this.isOS(e)||this.isPlatform(e)},a.some=function(e){var a=this;return void 0===e&&(e=[]),e.some((function(e){return a.is(e)}))},e}();a.default=n,e.exports=a.default},92:function(e,a,t){a.__esModule=!0,a.default=void 0;var r,c=(r=t(17))&&r.__esModule?r:{default:r},s=/version\/(\d+(\.?_?\d+)+)/i,d=[{test:[/googlebot/i],describe:function(e){var a={name:"Googlebot"},t=c.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||c.default.getFirstMatch(s,e);return t&&(a.version=t),a}},{test:[/opera/i],describe:function(e){var a={name:"Opera"},t=c.default.getFirstMatch(s,e)||c.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/opr\/|opios/i],describe:function(e){var a={name:"Opera"},t=c.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||c.default.getFirstMatch(s,e);return t&&(a.version=t),a}},{test:[/SamsungBrowser/i],describe:function(e){var a={name:"Samsung Internet for Android"},t=c.default.getFirstMatch(s,e)||c.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/Whale/i],describe:function(e){var a={name:"NAVER Whale Browser"},t=c.default.getFirstMatch(s,e)||c.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/MZBrowser/i],describe:function(e){var a={name:"MZ Browser"},t=c.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||c.default.getFirstMatch(s,e);return t&&(a.version=t),a}},{test:[/focus/i],describe:function(e){var a={name:"Focus"},t=c.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||c.default.getFirstMatch(s,e);return t&&(a.version=t),a}},{test:[/swing/i],describe:function(e){var a={name:"Swing"},t=c.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||c.default.getFirstMatch(s,e);return t&&(a.version=t),a}},{test:[/coast/i],describe:function(e){var a={name:"Opera Coast"},t=c.default.getFirstMatch(s,e)||c.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var a={name:"Opera Touch"},t=c.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||c.default.getFirstMatch(s,e);return t&&(a.version=t),a}},{test:[/yabrowser/i],describe:function(e){var a={name:"Yandex Browser"},t=c.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||c.default.getFirstMatch(s,e);return t&&(a.version=t),a}},{test:[/ucbrowser/i],describe:function(e){var a={name:"UC Browser"},t=c.default.getFirstMatch(s,e)||c.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/Maxthon|mxios/i],describe:function(e){var a={name:"Maxthon"},t=c.default.getFirstMatch(s,e)||c.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/epiphany/i],describe:function(e){var a={name:"Epiphany"},t=c.default.getFirstMatch(s,e)||c.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/puffin/i],describe:function(e){var a={name:"Puffin"},t=c.default.getFirstMatch(s,e)||c.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/sleipnir/i],describe:function(e){var a={name:"Sleipnir"},t=c.default.getFirstMatch(s,e)||c.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/k-meleon/i],describe:function(e){var a={name:"K-Meleon"},t=c.default.getFirstMatch(s,e)||c.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/micromessenger/i],describe:function(e){var a={name:"WeChat"},t=c.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||c.default.getFirstMatch(s,e);return t&&(a.version=t),a}},{test:[/qqbrowser/i],describe:function(e){var a={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},t=c.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||c.default.getFirstMatch(s,e);return t&&(a.version=t),a}},{test:[/msie|trident/i],describe:function(e){var a={name:"Internet Explorer"},t=c.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/\sedg\//i],describe:function(e){var a={name:"Microsoft Edge"},t=c.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/edg([ea]|ios)/i],describe:function(e){var a={name:"Microsoft Edge"},t=c.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/vivaldi/i],describe:function(e){var a={name:"Vivaldi"},t=c.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/seamonkey/i],describe:function(e){var a={name:"SeaMonkey"},t=c.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/sailfish/i],describe:function(e){var a={name:"Sailfish"},t=c.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return t&&(a.version=t),a}},{test:[/silk/i],describe:function(e){var a={name:"Amazon Silk"},t=c.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/phantom/i],describe:function(e){var a={name:"PhantomJS"},t=c.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/slimerjs/i],describe:function(e){var a={name:"SlimerJS"},t=c.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var a={name:"BlackBerry"},t=c.default.getFirstMatch(s,e)||c.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var a={name:"WebOS Browser"},t=c.default.getFirstMatch(s,e)||c.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/bada/i],describe:function(e){var a={name:"Bada"},t=c.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/tizen/i],describe:function(e){var a={name:"Tizen"},t=c.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||c.default.getFirstMatch(s,e);return t&&(a.version=t),a}},{test:[/qupzilla/i],describe:function(e){var a={name:"QupZilla"},t=c.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||c.default.getFirstMatch(s,e);return t&&(a.version=t),a}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var a={name:"Firefox"},t=c.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/electron/i],describe:function(e){var a={name:"Electron"},t=c.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/MiuiBrowser/i],describe:function(e){var a={name:"Miui"},t=c.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/chromium/i],describe:function(e){var a={name:"Chromium"},t=c.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||c.default.getFirstMatch(s,e);return t&&(a.version=t),a}},{test:[/chrome|crios|crmo/i],describe:function(e){var a={name:"Chrome"},t=c.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/GSA/i],describe:function(e){var a={name:"Google Search"},t=c.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:function(e){var a=!e.test(/like android/i),t=e.test(/android/i);return a&&t},describe:function(e){var a={name:"Android Browser"},t=c.default.getFirstMatch(s,e);return t&&(a.version=t),a}},{test:[/playstation 4/i],describe:function(e){var a={name:"PlayStation 4"},t=c.default.getFirstMatch(s,e);return t&&(a.version=t),a}},{test:[/safari|applewebkit/i],describe:function(e){var a={name:"Safari"},t=c.default.getFirstMatch(s,e);return t&&(a.version=t),a}},{test:[/.*/i],describe:function(e){var a=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:c.default.getFirstMatch(a,e),version:c.default.getSecondMatch(a,e)}}}];a.default=d,e.exports=a.default},93:function(e,a,t){a.__esModule=!0,a.default=void 0;var r,c=(r=t(17))&&r.__esModule?r:{default:r},s=t(18),d=[{test:[/Roku\/DVP/],describe:function(e){var a=c.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:s.OS_MAP.Roku,version:a}}},{test:[/windows phone/i],describe:function(e){var a=c.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.WindowsPhone,version:a}}},{test:[/windows /i],describe:function(e){var a=c.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),t=c.default.getWindowsVersionName(a);return{name:s.OS_MAP.Windows,version:a,versionName:t}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var a={name:s.OS_MAP.iOS},t=c.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return t&&(a.version=t),a}},{test:[/macintosh/i],describe:function(e){var a=c.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),t=c.default.getMacOSVersionName(a),r={name:s.OS_MAP.MacOS,version:a};return t&&(r.versionName=t),r}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var a=c.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:s.OS_MAP.iOS,version:a}}},{test:function(e){var a=!e.test(/like android/i),t=e.test(/android/i);return a&&t},describe:function(e){var a=c.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),t=c.default.getAndroidVersionName(a),r={name:s.OS_MAP.Android,version:a};return t&&(r.versionName=t),r}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var a=c.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),t={name:s.OS_MAP.WebOS};return a&&a.length&&(t.version=a),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var a=c.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||c.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||c.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:s.OS_MAP.BlackBerry,version:a}}},{test:[/bada/i],describe:function(e){var a=c.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Bada,version:a}}},{test:[/tizen/i],describe:function(e){var a=c.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Tizen,version:a}}},{test:[/linux/i],describe:function(){return{name:s.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:s.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var a=c.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.PlayStation4,version:a}}}];a.default=d,e.exports=a.default},94:function(e,a,t){a.__esModule=!0,a.default=void 0;var r,c=(r=t(17))&&r.__esModule?r:{default:r},s=t(18),d=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var a=c.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",t={type:s.PLATFORMS_MAP.mobile,vendor:"Huawei"};return a&&(t.model=a),t}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){var a=e.test(/ipod|iphone/i),t=e.test(/like (ipod|iphone)/i);return a&&!t},describe:function(e){var a=c.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:s.PLATFORMS_MAP.mobile,vendor:"Apple",model:a}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var a=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&a>=3},describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}}];a.default=d,e.exports=a.default},95:function(e,a,t){a.__esModule=!0,a.default=void 0;var r,c=(r=t(17))&&r.__esModule?r:{default:r},s=t(18),d=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:s.ENGINE_MAP.Blink};var a=c.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:s.ENGINE_MAP.EdgeHTML,version:a}}},{test:[/trident/i],describe:function(e){var a={name:s.ENGINE_MAP.Trident},t=c.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:function(e){return e.test(/presto/i)},describe:function(e){var a={name:s.ENGINE_MAP.Presto},t=c.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:function(e){var a=e.test(/gecko/i),t=e.test(/like gecko/i);return a&&!t},describe:function(e){var a={name:s.ENGINE_MAP.Gecko},t=c.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:s.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var a={name:s.ENGINE_MAP.WebKit},t=c.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return t&&(a.version=t),a}}];a.default=d,e.exports=a.default}})},"object"==typeof $486312f63fefa61d7f5e5449fd7c99f5$exports?$486312f63fefa61d7f5e5449fd7c99f5$exports=t():"function"==typeof $486312f63fefa61d7f5e5449fd7c99f5$var$define&&$486312f63fefa61d7f5e5449fd7c99f5$var$define.amd?$486312f63fefa61d7f5e5449fd7c99f5$var$define([],t):"object"==typeof $486312f63fefa61d7f5e5449fd7c99f5$exports?($486312f63fefa61d7f5e5449fd7c99f5$export$bowser=t(),$486312f63fefa61d7f5e5449fd7c99f5$exports.bowser=$486312f63fefa61d7f5e5449fd7c99f5$export$bowser):e.bowser=t();const $300fb327e45c7345f50fad064ffa0c99$var$bowser_1=$300fb327e45c7345f50fad064ffa0c99$var$__importDefault($486312f63fefa61d7f5e5449fd7c99f5$exports);var $1495c7c2155b511d7a7eba88d183bc8a$exports={},$1495c7c2155b511d7a7eba88d183bc8a$var$__importDefault=$1495c7c2155b511d7a7eba88d183bc8a$exports&&$1495c7c2155b511d7a7eba88d183bc8a$exports.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty($1495c7c2155b511d7a7eba88d183bc8a$exports,"__esModule",{value:!0});var $1495c7c2155b511d7a7eba88d183bc8a$export$Logger=void 0;$1495c7c2155b511d7a7eba88d183bc8a$exports.Logger=$1495c7c2155b511d7a7eba88d183bc8a$export$Logger;var $e4073ed42c3319e72efcba5381e94562$exports={},$7048cb8750e201b4c4cd498dc5275c29$exports={},$7048cb8750e201b4c4cd498dc5275c29$var$process=$7048cb8750e201b4c4cd498dc5275c29$exports={},$7048cb8750e201b4c4cd498dc5275c29$var$cachedSetTimeout,$7048cb8750e201b4c4cd498dc5275c29$var$cachedClearTimeout;function $7048cb8750e201b4c4cd498dc5275c29$var$defaultSetTimout(){throw new Error("setTimeout has not been defined")}function $7048cb8750e201b4c4cd498dc5275c29$var$defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function $7048cb8750e201b4c4cd498dc5275c29$var$runTimeout(e){if($7048cb8750e201b4c4cd498dc5275c29$var$cachedSetTimeout===setTimeout)return setTimeout(e,0);if(($7048cb8750e201b4c4cd498dc5275c29$var$cachedSetTimeout===$7048cb8750e201b4c4cd498dc5275c29$var$defaultSetTimout||!$7048cb8750e201b4c4cd498dc5275c29$var$cachedSetTimeout)&&setTimeout)return $7048cb8750e201b4c4cd498dc5275c29$var$cachedSetTimeout=setTimeout,setTimeout(e,0);try{return $7048cb8750e201b4c4cd498dc5275c29$var$cachedSetTimeout(e,0)}catch(a){try{return $7048cb8750e201b4c4cd498dc5275c29$var$cachedSetTimeout.call(null,e,0)}catch(a){return $7048cb8750e201b4c4cd498dc5275c29$var$cachedSetTimeout.call(this,e,0)}}}function $7048cb8750e201b4c4cd498dc5275c29$var$runClearTimeout(e){if($7048cb8750e201b4c4cd498dc5275c29$var$cachedClearTimeout===clearTimeout)return clearTimeout(e);if(($7048cb8750e201b4c4cd498dc5275c29$var$cachedClearTimeout===$7048cb8750e201b4c4cd498dc5275c29$var$defaultClearTimeout||!$7048cb8750e201b4c4cd498dc5275c29$var$cachedClearTimeout)&&clearTimeout)return $7048cb8750e201b4c4cd498dc5275c29$var$cachedClearTimeout=clearTimeout,clearTimeout(e);try{return $7048cb8750e201b4c4cd498dc5275c29$var$cachedClearTimeout(e)}catch(a){try{return $7048cb8750e201b4c4cd498dc5275c29$var$cachedClearTimeout.call(null,e)}catch(a){return $7048cb8750e201b4c4cd498dc5275c29$var$cachedClearTimeout.call(this,e)}}}!function(){try{$7048cb8750e201b4c4cd498dc5275c29$var$cachedSetTimeout="function"==typeof setTimeout?setTimeout:$7048cb8750e201b4c4cd498dc5275c29$var$defaultSetTimout}catch(e){$7048cb8750e201b4c4cd498dc5275c29$var$cachedSetTimeout=$7048cb8750e201b4c4cd498dc5275c29$var$defaultSetTimout}try{$7048cb8750e201b4c4cd498dc5275c29$var$cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:$7048cb8750e201b4c4cd498dc5275c29$var$defaultClearTimeout}catch(e){$7048cb8750e201b4c4cd498dc5275c29$var$cachedClearTimeout=$7048cb8750e201b4c4cd498dc5275c29$var$defaultClearTimeout}}();var $7048cb8750e201b4c4cd498dc5275c29$var$queue=[],$7048cb8750e201b4c4cd498dc5275c29$var$draining=!1,$7048cb8750e201b4c4cd498dc5275c29$var$currentQueue,$7048cb8750e201b4c4cd498dc5275c29$var$queueIndex=-1;function $7048cb8750e201b4c4cd498dc5275c29$var$cleanUpNextTick(){$7048cb8750e201b4c4cd498dc5275c29$var$draining&&$7048cb8750e201b4c4cd498dc5275c29$var$currentQueue&&($7048cb8750e201b4c4cd498dc5275c29$var$draining=!1,$7048cb8750e201b4c4cd498dc5275c29$var$currentQueue.length?$7048cb8750e201b4c4cd498dc5275c29$var$queue=$7048cb8750e201b4c4cd498dc5275c29$var$currentQueue.concat($7048cb8750e201b4c4cd498dc5275c29$var$queue):$7048cb8750e201b4c4cd498dc5275c29$var$queueIndex=-1,$7048cb8750e201b4c4cd498dc5275c29$var$queue.length&&$7048cb8750e201b4c4cd498dc5275c29$var$drainQueue())}function $7048cb8750e201b4c4cd498dc5275c29$var$drainQueue(){if(!$7048cb8750e201b4c4cd498dc5275c29$var$draining){var e=$7048cb8750e201b4c4cd498dc5275c29$var$runTimeout($7048cb8750e201b4c4cd498dc5275c29$var$cleanUpNextTick);$7048cb8750e201b4c4cd498dc5275c29$var$draining=!0;for(var a=$7048cb8750e201b4c4cd498dc5275c29$var$queue.length;a;){for($7048cb8750e201b4c4cd498dc5275c29$var$currentQueue=$7048cb8750e201b4c4cd498dc5275c29$var$queue,$7048cb8750e201b4c4cd498dc5275c29$var$queue=[];++$7048cb8750e201b4c4cd498dc5275c29$var$queueIndex<a;)$7048cb8750e201b4c4cd498dc5275c29$var$currentQueue&&$7048cb8750e201b4c4cd498dc5275c29$var$currentQueue[$7048cb8750e201b4c4cd498dc5275c29$var$queueIndex].run();$7048cb8750e201b4c4cd498dc5275c29$var$queueIndex=-1,a=$7048cb8750e201b4c4cd498dc5275c29$var$queue.length}$7048cb8750e201b4c4cd498dc5275c29$var$currentQueue=null,$7048cb8750e201b4c4cd498dc5275c29$var$draining=!1,$7048cb8750e201b4c4cd498dc5275c29$var$runClearTimeout(e)}}function $7048cb8750e201b4c4cd498dc5275c29$var$Item(e,a){this.fun=e,this.array=a}function $7048cb8750e201b4c4cd498dc5275c29$var$noop(){}$7048cb8750e201b4c4cd498dc5275c29$var$process.nextTick=function(e){var a=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)a[t-1]=arguments[t];$7048cb8750e201b4c4cd498dc5275c29$var$queue.push(new $7048cb8750e201b4c4cd498dc5275c29$var$Item(e,a)),1!==$7048cb8750e201b4c4cd498dc5275c29$var$queue.length||$7048cb8750e201b4c4cd498dc5275c29$var$draining||$7048cb8750e201b4c4cd498dc5275c29$var$runTimeout($7048cb8750e201b4c4cd498dc5275c29$var$drainQueue)},$7048cb8750e201b4c4cd498dc5275c29$var$Item.prototype.run=function(){this.fun.apply(null,this.array)},$7048cb8750e201b4c4cd498dc5275c29$var$process.title="browser",$7048cb8750e201b4c4cd498dc5275c29$var$process.browser=!0,$7048cb8750e201b4c4cd498dc5275c29$var$process.env={},$7048cb8750e201b4c4cd498dc5275c29$var$process.argv=[],$7048cb8750e201b4c4cd498dc5275c29$var$process.version="",$7048cb8750e201b4c4cd498dc5275c29$var$process.versions={},$7048cb8750e201b4c4cd498dc5275c29$var$process.on=$7048cb8750e201b4c4cd498dc5275c29$var$noop,$7048cb8750e201b4c4cd498dc5275c29$var$process.addListener=$7048cb8750e201b4c4cd498dc5275c29$var$noop,$7048cb8750e201b4c4cd498dc5275c29$var$process.once=$7048cb8750e201b4c4cd498dc5275c29$var$noop,$7048cb8750e201b4c4cd498dc5275c29$var$process.off=$7048cb8750e201b4c4cd498dc5275c29$var$noop,$7048cb8750e201b4c4cd498dc5275c29$var$process.removeListener=$7048cb8750e201b4c4cd498dc5275c29$var$noop,$7048cb8750e201b4c4cd498dc5275c29$var$process.removeAllListeners=$7048cb8750e201b4c4cd498dc5275c29$var$noop,$7048cb8750e201b4c4cd498dc5275c29$var$process.emit=$7048cb8750e201b4c4cd498dc5275c29$var$noop,$7048cb8750e201b4c4cd498dc5275c29$var$process.prependListener=$7048cb8750e201b4c4cd498dc5275c29$var$noop,$7048cb8750e201b4c4cd498dc5275c29$var$process.prependOnceListener=$7048cb8750e201b4c4cd498dc5275c29$var$noop,$7048cb8750e201b4c4cd498dc5275c29$var$process.listeners=function(e){return[]},$7048cb8750e201b4c4cd498dc5275c29$var$process.binding=function(e){throw new Error("process.binding is not supported")},$7048cb8750e201b4c4cd498dc5275c29$var$process.cwd=function(){return"/"},$7048cb8750e201b4c4cd498dc5275c29$var$process.chdir=function(e){throw new Error("process.chdir is not supported")},$7048cb8750e201b4c4cd498dc5275c29$var$process.umask=function(){return 0};var $e4073ed42c3319e72efcba5381e94562$var$process=$7048cb8750e201b4c4cd498dc5275c29$exports,$e4073ed42c3319e72efcba5381e94562$export$formatArgs=$e4073ed42c3319e72efcba5381e94562$var$formatArgs;$e4073ed42c3319e72efcba5381e94562$exports.formatArgs=$e4073ed42c3319e72efcba5381e94562$export$formatArgs;var $e4073ed42c3319e72efcba5381e94562$export$save=$e4073ed42c3319e72efcba5381e94562$var$save;$e4073ed42c3319e72efcba5381e94562$exports.save=$e4073ed42c3319e72efcba5381e94562$export$save;var $e4073ed42c3319e72efcba5381e94562$export$load=$e4073ed42c3319e72efcba5381e94562$var$load;$e4073ed42c3319e72efcba5381e94562$exports.load=$e4073ed42c3319e72efcba5381e94562$export$load;var $e4073ed42c3319e72efcba5381e94562$export$useColors=$e4073ed42c3319e72efcba5381e94562$var$useColors;$e4073ed42c3319e72efcba5381e94562$exports.useColors=$e4073ed42c3319e72efcba5381e94562$export$useColors;var $e4073ed42c3319e72efcba5381e94562$export$storage=$e4073ed42c3319e72efcba5381e94562$var$localstorage();$e4073ed42c3319e72efcba5381e94562$exports.storage=$e4073ed42c3319e72efcba5381e94562$export$storage;var $e4073ed42c3319e72efcba5381e94562$export$destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();$e4073ed42c3319e72efcba5381e94562$exports.destroy=$e4073ed42c3319e72efcba5381e94562$export$destroy;var $e4073ed42c3319e72efcba5381e94562$export$colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function $e4073ed42c3319e72efcba5381e94562$var$useColors(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function $e4073ed42c3319e72efcba5381e94562$var$formatArgs(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+$e4073ed42c3319e72efcba5381e94562$exports.humanize(this.diff),!this.useColors)return;const a="color: "+this.color;e.splice(1,0,a,"color: inherit");let t=0,r=0;e[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(t++,"%c"===e&&(r=t))})),e.splice(r,0,a)}$e4073ed42c3319e72efcba5381e94562$exports.colors=$e4073ed42c3319e72efcba5381e94562$export$colors;var $e4073ed42c3319e72efcba5381e94562$export$log=console.debug||console.log||(()=>{});function $e4073ed42c3319e72efcba5381e94562$var$save(e){try{e?$e4073ed42c3319e72efcba5381e94562$export$storage.setItem("debug",e):$e4073ed42c3319e72efcba5381e94562$export$storage.removeItem("debug")}catch(e){}}function $e4073ed42c3319e72efcba5381e94562$var$load(){let e;try{e=$e4073ed42c3319e72efcba5381e94562$export$storage.getItem("debug")}catch(e){}return!e&&void 0!==$e4073ed42c3319e72efcba5381e94562$var$process&&"env"in $e4073ed42c3319e72efcba5381e94562$var$process&&(e=void 0),e}function $e4073ed42c3319e72efcba5381e94562$var$localstorage(){try{return localStorage}catch(e){}}$e4073ed42c3319e72efcba5381e94562$exports.log=$e4073ed42c3319e72efcba5381e94562$export$log;var $4c17dad650ae0ea20ee65ba3f01b0335$exports,$4c17dad650ae0ea20ee65ba3f01b0335$var$s,$4c17dad650ae0ea20ee65ba3f01b0335$var$m,$4c17dad650ae0ea20ee65ba3f01b0335$var$h,$4c17dad650ae0ea20ee65ba3f01b0335$var$d,$4c17dad650ae0ea20ee65ba3f01b0335$var$w,$4c17dad650ae0ea20ee65ba3f01b0335$var$y,$4c17dad650ae0ea20ee65ba3f01b0335$executed=!1;function $4c17dad650ae0ea20ee65ba3f01b0335$var$parse(e){if(!((e=String(e)).length>100)){var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(a){var t=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return t*$4c17dad650ae0ea20ee65ba3f01b0335$var$y;case"weeks":case"week":case"w":return t*$4c17dad650ae0ea20ee65ba3f01b0335$var$w;case"days":case"day":case"d":return t*$4c17dad650ae0ea20ee65ba3f01b0335$var$d;case"hours":case"hour":case"hrs":case"hr":case"h":return t*$4c17dad650ae0ea20ee65ba3f01b0335$var$h;case"minutes":case"minute":case"mins":case"min":case"m":return t*$4c17dad650ae0ea20ee65ba3f01b0335$var$m;case"seconds":case"second":case"secs":case"sec":case"s":return t*$4c17dad650ae0ea20ee65ba3f01b0335$var$s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function $4c17dad650ae0ea20ee65ba3f01b0335$var$fmtShort(e){var a=Math.abs(e);return a>=$4c17dad650ae0ea20ee65ba3f01b0335$var$d?Math.round(e/$4c17dad650ae0ea20ee65ba3f01b0335$var$d)+"d":a>=$4c17dad650ae0ea20ee65ba3f01b0335$var$h?Math.round(e/$4c17dad650ae0ea20ee65ba3f01b0335$var$h)+"h":a>=$4c17dad650ae0ea20ee65ba3f01b0335$var$m?Math.round(e/$4c17dad650ae0ea20ee65ba3f01b0335$var$m)+"m":a>=$4c17dad650ae0ea20ee65ba3f01b0335$var$s?Math.round(e/$4c17dad650ae0ea20ee65ba3f01b0335$var$s)+"s":e+"ms"}function $4c17dad650ae0ea20ee65ba3f01b0335$var$fmtLong(e){var a=Math.abs(e);return a>=$4c17dad650ae0ea20ee65ba3f01b0335$var$d?$4c17dad650ae0ea20ee65ba3f01b0335$var$plural(e,a,$4c17dad650ae0ea20ee65ba3f01b0335$var$d,"day"):a>=$4c17dad650ae0ea20ee65ba3f01b0335$var$h?$4c17dad650ae0ea20ee65ba3f01b0335$var$plural(e,a,$4c17dad650ae0ea20ee65ba3f01b0335$var$h,"hour"):a>=$4c17dad650ae0ea20ee65ba3f01b0335$var$m?$4c17dad650ae0ea20ee65ba3f01b0335$var$plural(e,a,$4c17dad650ae0ea20ee65ba3f01b0335$var$m,"minute"):a>=$4c17dad650ae0ea20ee65ba3f01b0335$var$s?$4c17dad650ae0ea20ee65ba3f01b0335$var$plural(e,a,$4c17dad650ae0ea20ee65ba3f01b0335$var$s,"second"):e+" ms"}function $4c17dad650ae0ea20ee65ba3f01b0335$var$plural(e,a,t,r){var c=a>=1.5*t;return Math.round(e/t)+" "+r+(c?"s":"")}function $4c17dad650ae0ea20ee65ba3f01b0335$exec(){$4c17dad650ae0ea20ee65ba3f01b0335$exports={},$4c17dad650ae0ea20ee65ba3f01b0335$var$w=7*($4c17dad650ae0ea20ee65ba3f01b0335$var$d=24*($4c17dad650ae0ea20ee65ba3f01b0335$var$h=60*($4c17dad650ae0ea20ee65ba3f01b0335$var$m=60*($4c17dad650ae0ea20ee65ba3f01b0335$var$s=1e3)))),$4c17dad650ae0ea20ee65ba3f01b0335$var$y=365.25*$4c17dad650ae0ea20ee65ba3f01b0335$var$d,$4c17dad650ae0ea20ee65ba3f01b0335$exports=function(e,a){a=a||{};var t=typeof e;if("string"===t&&e.length>0)return $4c17dad650ae0ea20ee65ba3f01b0335$var$parse(e);if("number"===t&&isFinite(e))return a.long?$4c17dad650ae0ea20ee65ba3f01b0335$var$fmtLong(e):$4c17dad650ae0ea20ee65ba3f01b0335$var$fmtShort(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}}function $4c17dad650ae0ea20ee65ba3f01b0335$init(){return $4c17dad650ae0ea20ee65ba3f01b0335$executed||($4c17dad650ae0ea20ee65ba3f01b0335$executed=!0,$4c17dad650ae0ea20ee65ba3f01b0335$exec()),$4c17dad650ae0ea20ee65ba3f01b0335$exports}var $c4c6ab818a8a6aa5dd39f49b661d4bd9$exports={};function $c4c6ab818a8a6aa5dd39f49b661d4bd9$var$setup(e){function a(e){let r,c=null;function s(...e){if(!s.enabled)return;const t=s,c=Number(new Date),d=c-(r||c);t.diff=d,t.prev=r,t.curr=c,r=c,e[0]=a.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let i=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,c)=>{if("%%"===r)return"%";i++;const s=a.formatters[c];if("function"==typeof s){const a=e[i];r=s.call(t,a),e.splice(i,1),i--}return r})),a.formatArgs.call(t,e);(t.log||a.log).apply(t,e)}return s.namespace=e,s.useColors=a.useColors(),s.color=a.selectColor(e),s.extend=t,s.destroy=a.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:()=>null===c?a.enabled(e):c,set:e=>{c=e}}),"function"==typeof a.init&&a.init(s),s}function t(e,t){const r=a(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return a.debug=a,a.default=a,a.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},a.disable=function(){const e=[...a.names.map(r),...a.skips.map(r).map((e=>"-"+e))].join(",");return a.enable(""),e},a.enable=function(e){let t;a.save(e),a.names=[],a.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),c=r.length;for(t=0;t<c;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?a.skips.push(new RegExp("^"+e.substr(1)+"$")):a.names.push(new RegExp("^"+e+"$")))},a.enabled=function(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=a.skips.length;t<r;t++)if(a.skips[t].test(e))return!1;for(t=0,r=a.names.length;t<r;t++)if(a.names[t].test(e))return!0;return!1},a.humanize=$4c17dad650ae0ea20ee65ba3f01b0335$init(),a.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((t=>{a[t]=e[t]})),a.names=[],a.skips=[],a.formatters={},a.selectColor=function(e){let t=0;for(let a=0;a<e.length;a++)t=(t<<5)-t+e.charCodeAt(a),t|=0;return a.colors[Math.abs(t)%a.colors.length]},a.enable(a.load()),a}$c4c6ab818a8a6aa5dd39f49b661d4bd9$exports=$c4c6ab818a8a6aa5dd39f49b661d4bd9$var$setup,$e4073ed42c3319e72efcba5381e94562$exports=$c4c6ab818a8a6aa5dd39f49b661d4bd9$exports($e4073ed42c3319e72efcba5381e94562$exports);const{formatters:$e4073ed42c3319e72efcba5381e94562$var$formatters}=$e4073ed42c3319e72efcba5381e94562$exports;$e4073ed42c3319e72efcba5381e94562$var$formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}};const $1495c7c2155b511d7a7eba88d183bc8a$var$debug_1=$1495c7c2155b511d7a7eba88d183bc8a$var$__importDefault($e4073ed42c3319e72efcba5381e94562$exports),$1495c7c2155b511d7a7eba88d183bc8a$var$APP_NAME="mediasoup-client";class $1495c7c2155b511d7a7eba88d183bc8a$var$Logger{constructor(e){e?(this._debug=$1495c7c2155b511d7a7eba88d183bc8a$var$debug_1.default(`${$1495c7c2155b511d7a7eba88d183bc8a$var$APP_NAME}:${e}`),this._warn=$1495c7c2155b511d7a7eba88d183bc8a$var$debug_1.default(`${$1495c7c2155b511d7a7eba88d183bc8a$var$APP_NAME}:WARN:${e}`),this._error=$1495c7c2155b511d7a7eba88d183bc8a$var$debug_1.default(`${$1495c7c2155b511d7a7eba88d183bc8a$var$APP_NAME}:ERROR:${e}`)):(this._debug=$1495c7c2155b511d7a7eba88d183bc8a$var$debug_1.default($1495c7c2155b511d7a7eba88d183bc8a$var$APP_NAME),this._warn=$1495c7c2155b511d7a7eba88d183bc8a$var$debug_1.default(`${$1495c7c2155b511d7a7eba88d183bc8a$var$APP_NAME}:WARN`),this._error=$1495c7c2155b511d7a7eba88d183bc8a$var$debug_1.default(`${$1495c7c2155b511d7a7eba88d183bc8a$var$APP_NAME}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}$1495c7c2155b511d7a7eba88d183bc8a$export$Logger=$1495c7c2155b511d7a7eba88d183bc8a$var$Logger,$1495c7c2155b511d7a7eba88d183bc8a$exports.Logger=$1495c7c2155b511d7a7eba88d183bc8a$export$Logger;var $233e1f2fffc8d465fe34283eded93370$exports={};Object.defineProperty($233e1f2fffc8d465fe34283eded93370$exports,"__esModule",{value:!0});var $233e1f2fffc8d465fe34283eded93370$export$EnhancedEventEmitter=void 0;$233e1f2fffc8d465fe34283eded93370$exports.EnhancedEventEmitter=$233e1f2fffc8d465fe34283eded93370$export$EnhancedEventEmitter;const $233e1f2fffc8d465fe34283eded93370$var$logger=new $1495c7c2155b511d7a7eba88d183bc8a$exports.Logger("EnhancedEventEmitter");class $233e1f2fffc8d465fe34283eded93370$var$EnhancedEventEmitter extends $47097ee663d5613230304ea01db841ae$exports.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}safeEmit(e,...a){const t=this.listenerCount(e);try{return this.emit(e,...a)}catch(a){return $233e1f2fffc8d465fe34283eded93370$var$logger.error("safeEmit() | event listener threw an error [event:%s]:%o",e,a),Boolean(t)}}async safeEmitAsPromise(e,...a){return new Promise(((t,r)=>{try{this.emit(e,...a,t,r)}catch(a){$233e1f2fffc8d465fe34283eded93370$var$logger.error("safeEmitAsPromise() | event listener threw an error [event:%s]:%o",e,a),r(a)}}))}}$233e1f2fffc8d465fe34283eded93370$export$EnhancedEventEmitter=$233e1f2fffc8d465fe34283eded93370$var$EnhancedEventEmitter,$233e1f2fffc8d465fe34283eded93370$exports.EnhancedEventEmitter=$233e1f2fffc8d465fe34283eded93370$export$EnhancedEventEmitter;var $bc57fcc64273e15720ee6bd761f472a5$exports={};Object.defineProperty($bc57fcc64273e15720ee6bd761f472a5$exports,"__esModule",{value:!0});var $bc57fcc64273e15720ee6bd761f472a5$export$InvalidStateError=($bc57fcc64273e15720ee6bd761f472a5$export$UnsupportedError=void 0,$bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError=$bc57fcc64273e15720ee6bd761f472a5$export$UnsupportedError);$bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError=$bc57fcc64273e15720ee6bd761f472a5$export$InvalidStateError;class $bc57fcc64273e15720ee6bd761f472a5$var$UnsupportedError extends Error{constructor(e){super(e),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,$bc57fcc64273e15720ee6bd761f472a5$var$UnsupportedError):this.stack=new Error(e).stack}}var $bc57fcc64273e15720ee6bd761f472a5$export$UnsupportedError=$bc57fcc64273e15720ee6bd761f472a5$var$UnsupportedError;$bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError=$bc57fcc64273e15720ee6bd761f472a5$export$UnsupportedError;class $bc57fcc64273e15720ee6bd761f472a5$var$InvalidStateError extends Error{constructor(e){super(e),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,$bc57fcc64273e15720ee6bd761f472a5$var$InvalidStateError):this.stack=new Error(e).stack}}$bc57fcc64273e15720ee6bd761f472a5$export$InvalidStateError=$bc57fcc64273e15720ee6bd761f472a5$var$InvalidStateError,$bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError=$bc57fcc64273e15720ee6bd761f472a5$export$InvalidStateError;var $6abc7ab33e1327c2d411a5fc6b37fe23$exports={};Object.defineProperty($6abc7ab33e1327c2d411a5fc6b37fe23$exports,"__esModule",{value:!0});var $6abc7ab33e1327c2d411a5fc6b37fe23$export$generateRandomNumber=($6abc7ab33e1327c2d411a5fc6b37fe23$export$clone=void 0,$6abc7ab33e1327c2d411a5fc6b37fe23$exports.clone=$6abc7ab33e1327c2d411a5fc6b37fe23$export$clone);function $6abc7ab33e1327c2d411a5fc6b37fe23$var$clone(e,a){return void 0===e?a:JSON.parse(JSON.stringify(e))}$6abc7ab33e1327c2d411a5fc6b37fe23$exports.generateRandomNumber=$6abc7ab33e1327c2d411a5fc6b37fe23$export$generateRandomNumber;var $6abc7ab33e1327c2d411a5fc6b37fe23$export$clone=$6abc7ab33e1327c2d411a5fc6b37fe23$var$clone;function $6abc7ab33e1327c2d411a5fc6b37fe23$var$generateRandomNumber(){return Math.round(1e7*Math.random())}$6abc7ab33e1327c2d411a5fc6b37fe23$exports.clone=$6abc7ab33e1327c2d411a5fc6b37fe23$export$clone,$6abc7ab33e1327c2d411a5fc6b37fe23$export$generateRandomNumber=$6abc7ab33e1327c2d411a5fc6b37fe23$var$generateRandomNumber,$6abc7ab33e1327c2d411a5fc6b37fe23$exports.generateRandomNumber=$6abc7ab33e1327c2d411a5fc6b37fe23$export$generateRandomNumber;const $300fb327e45c7345f50fad064ffa0c99$var$utils=$300fb327e45c7345f50fad064ffa0c99$var$__importStar($6abc7ab33e1327c2d411a5fc6b37fe23$exports);var $c14b343179c41479c8bdeecb64f7be76$exports={},$c14b343179c41479c8bdeecb64f7be76$var$__createBinding=$c14b343179c41479c8bdeecb64f7be76$exports&&$c14b343179c41479c8bdeecb64f7be76$exports.__createBinding||(Object.create?function(e,a,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,r){void 0===r&&(r=t),e[r]=a[t]}),$c14b343179c41479c8bdeecb64f7be76$var$__setModuleDefault=$c14b343179c41479c8bdeecb64f7be76$exports&&$c14b343179c41479c8bdeecb64f7be76$exports.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),$c14b343179c41479c8bdeecb64f7be76$var$__importStar=$c14b343179c41479c8bdeecb64f7be76$exports&&$c14b343179c41479c8bdeecb64f7be76$exports.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)"default"!==t&&Object.hasOwnProperty.call(e,t)&&$c14b343179c41479c8bdeecb64f7be76$var$__createBinding(a,e,t);return $c14b343179c41479c8bdeecb64f7be76$var$__setModuleDefault(a,e),a};Object.defineProperty($c14b343179c41479c8bdeecb64f7be76$exports,"__esModule",{value:!0});var $c14b343179c41479c8bdeecb64f7be76$export$canReceive=($c14b343179c41479c8bdeecb64f7be76$export$validateRtpCapabilities=void 0,$c14b343179c41479c8bdeecb64f7be76$export$validateRtpCodecCapability=$c14b343179c41479c8bdeecb64f7be76$exports.validateRtpCapabilities=$c14b343179c41479c8bdeecb64f7be76$export$validateRtpCapabilities,$c14b343179c41479c8bdeecb64f7be76$export$validateRtcpFeedback=$c14b343179c41479c8bdeecb64f7be76$exports.validateRtpCodecCapability=$c14b343179c41479c8bdeecb64f7be76$export$validateRtpCodecCapability,$c14b343179c41479c8bdeecb64f7be76$export$validateRtpHeaderExtension=$c14b343179c41479c8bdeecb64f7be76$exports.validateRtcpFeedback=$c14b343179c41479c8bdeecb64f7be76$export$validateRtcpFeedback,$c14b343179c41479c8bdeecb64f7be76$export$validateRtpParameters=$c14b343179c41479c8bdeecb64f7be76$exports.validateRtpHeaderExtension=$c14b343179c41479c8bdeecb64f7be76$export$validateRtpHeaderExtension,$c14b343179c41479c8bdeecb64f7be76$export$validateRtpCodecParameters=$c14b343179c41479c8bdeecb64f7be76$exports.validateRtpParameters=$c14b343179c41479c8bdeecb64f7be76$export$validateRtpParameters,$c14b343179c41479c8bdeecb64f7be76$export$validateRtpHeaderExtensionParameters=$c14b343179c41479c8bdeecb64f7be76$exports.validateRtpCodecParameters=$c14b343179c41479c8bdeecb64f7be76$export$validateRtpCodecParameters,$c14b343179c41479c8bdeecb64f7be76$export$validateRtpEncodingParameters=$c14b343179c41479c8bdeecb64f7be76$exports.validateRtpHeaderExtensionParameters=$c14b343179c41479c8bdeecb64f7be76$export$validateRtpHeaderExtensionParameters,$c14b343179c41479c8bdeecb64f7be76$export$validateRtcpParameters=$c14b343179c41479c8bdeecb64f7be76$exports.validateRtpEncodingParameters=$c14b343179c41479c8bdeecb64f7be76$export$validateRtpEncodingParameters,$c14b343179c41479c8bdeecb64f7be76$export$validateSctpCapabilities=$c14b343179c41479c8bdeecb64f7be76$exports.validateRtcpParameters=$c14b343179c41479c8bdeecb64f7be76$export$validateRtcpParameters,$c14b343179c41479c8bdeecb64f7be76$export$validateNumSctpStreams=$c14b343179c41479c8bdeecb64f7be76$exports.validateSctpCapabilities=$c14b343179c41479c8bdeecb64f7be76$export$validateSctpCapabilities,$c14b343179c41479c8bdeecb64f7be76$export$validateSctpParameters=$c14b343179c41479c8bdeecb64f7be76$exports.validateNumSctpStreams=$c14b343179c41479c8bdeecb64f7be76$export$validateNumSctpStreams,$c14b343179c41479c8bdeecb64f7be76$export$validateSctpStreamParameters=$c14b343179c41479c8bdeecb64f7be76$exports.validateSctpParameters=$c14b343179c41479c8bdeecb64f7be76$export$validateSctpParameters,$c14b343179c41479c8bdeecb64f7be76$export$getExtendedRtpCapabilities=$c14b343179c41479c8bdeecb64f7be76$exports.validateSctpStreamParameters=$c14b343179c41479c8bdeecb64f7be76$export$validateSctpStreamParameters,$c14b343179c41479c8bdeecb64f7be76$export$getRecvRtpCapabilities=$c14b343179c41479c8bdeecb64f7be76$exports.getExtendedRtpCapabilities=$c14b343179c41479c8bdeecb64f7be76$export$getExtendedRtpCapabilities,$c14b343179c41479c8bdeecb64f7be76$export$getSendingRtpParameters=$c14b343179c41479c8bdeecb64f7be76$exports.getRecvRtpCapabilities=$c14b343179c41479c8bdeecb64f7be76$export$getRecvRtpCapabilities,$c14b343179c41479c8bdeecb64f7be76$export$getSendingRemoteRtpParameters=$c14b343179c41479c8bdeecb64f7be76$exports.getSendingRtpParameters=$c14b343179c41479c8bdeecb64f7be76$export$getSendingRtpParameters,$c14b343179c41479c8bdeecb64f7be76$export$reduceCodecs=$c14b343179c41479c8bdeecb64f7be76$exports.getSendingRemoteRtpParameters=$c14b343179c41479c8bdeecb64f7be76$export$getSendingRemoteRtpParameters,$c14b343179c41479c8bdeecb64f7be76$export$generateProbatorRtpParameters=$c14b343179c41479c8bdeecb64f7be76$exports.reduceCodecs=$c14b343179c41479c8bdeecb64f7be76$export$reduceCodecs,$c14b343179c41479c8bdeecb64f7be76$export$canSend=$c14b343179c41479c8bdeecb64f7be76$exports.generateProbatorRtpParameters=$c14b343179c41479c8bdeecb64f7be76$export$generateProbatorRtpParameters,$c14b343179c41479c8bdeecb64f7be76$exports.canSend=$c14b343179c41479c8bdeecb64f7be76$export$canSend);$c14b343179c41479c8bdeecb64f7be76$exports.canReceive=$c14b343179c41479c8bdeecb64f7be76$export$canReceive;var $803176d1d2905276e28c7469d4ae563c$exports={};const $803176d1d2905276e28c7469d4ae563c$var$debug=$e4073ed42c3319e72efcba5381e94562$exports("h264-profile-level-id");$803176d1d2905276e28c7469d4ae563c$var$debug.log=console.info.bind(console);const $803176d1d2905276e28c7469d4ae563c$var$ProfileConstrainedBaseline=1,$803176d1d2905276e28c7469d4ae563c$var$ProfileBaseline=2,$803176d1d2905276e28c7469d4ae563c$var$ProfileMain=3,$803176d1d2905276e28c7469d4ae563c$var$ProfileConstrainedHigh=4,$803176d1d2905276e28c7469d4ae563c$var$ProfileHigh=5;var $803176d1d2905276e28c7469d4ae563c$export$ProfileConstrainedBaseline=$803176d1d2905276e28c7469d4ae563c$var$ProfileConstrainedBaseline;$803176d1d2905276e28c7469d4ae563c$exports.ProfileConstrainedBaseline=$803176d1d2905276e28c7469d4ae563c$export$ProfileConstrainedBaseline;var $803176d1d2905276e28c7469d4ae563c$export$ProfileBaseline=$803176d1d2905276e28c7469d4ae563c$var$ProfileBaseline;$803176d1d2905276e28c7469d4ae563c$exports.ProfileBaseline=$803176d1d2905276e28c7469d4ae563c$export$ProfileBaseline;var $803176d1d2905276e28c7469d4ae563c$export$ProfileMain=$803176d1d2905276e28c7469d4ae563c$var$ProfileMain;$803176d1d2905276e28c7469d4ae563c$exports.ProfileMain=$803176d1d2905276e28c7469d4ae563c$export$ProfileMain;var $803176d1d2905276e28c7469d4ae563c$export$ProfileConstrainedHigh=$803176d1d2905276e28c7469d4ae563c$var$ProfileConstrainedHigh;$803176d1d2905276e28c7469d4ae563c$exports.ProfileConstrainedHigh=$803176d1d2905276e28c7469d4ae563c$export$ProfileConstrainedHigh;var $803176d1d2905276e28c7469d4ae563c$export$ProfileHigh=$803176d1d2905276e28c7469d4ae563c$var$ProfileHigh;$803176d1d2905276e28c7469d4ae563c$exports.ProfileHigh=$803176d1d2905276e28c7469d4ae563c$export$ProfileHigh;const $803176d1d2905276e28c7469d4ae563c$var$Level1_b=0,$803176d1d2905276e28c7469d4ae563c$var$Level1=10,$803176d1d2905276e28c7469d4ae563c$var$Level1_1=11,$803176d1d2905276e28c7469d4ae563c$var$Level1_2=12,$803176d1d2905276e28c7469d4ae563c$var$Level1_3=13,$803176d1d2905276e28c7469d4ae563c$var$Level2=20,$803176d1d2905276e28c7469d4ae563c$var$Level2_1=21,$803176d1d2905276e28c7469d4ae563c$var$Level2_2=22,$803176d1d2905276e28c7469d4ae563c$var$Level3=30,$803176d1d2905276e28c7469d4ae563c$var$Level3_1=31,$803176d1d2905276e28c7469d4ae563c$var$Level3_2=32,$803176d1d2905276e28c7469d4ae563c$var$Level4=40,$803176d1d2905276e28c7469d4ae563c$var$Level4_1=41,$803176d1d2905276e28c7469d4ae563c$var$Level4_2=42,$803176d1d2905276e28c7469d4ae563c$var$Level5=50,$803176d1d2905276e28c7469d4ae563c$var$Level5_1=51,$803176d1d2905276e28c7469d4ae563c$var$Level5_2=52;var $803176d1d2905276e28c7469d4ae563c$export$Level1_b=$803176d1d2905276e28c7469d4ae563c$var$Level1_b;$803176d1d2905276e28c7469d4ae563c$exports.Level1_b=$803176d1d2905276e28c7469d4ae563c$export$Level1_b;var $803176d1d2905276e28c7469d4ae563c$export$Level1=$803176d1d2905276e28c7469d4ae563c$var$Level1;$803176d1d2905276e28c7469d4ae563c$exports.Level1=$803176d1d2905276e28c7469d4ae563c$export$Level1;var $803176d1d2905276e28c7469d4ae563c$export$Level1_1=$803176d1d2905276e28c7469d4ae563c$var$Level1_1;$803176d1d2905276e28c7469d4ae563c$exports.Level1_1=$803176d1d2905276e28c7469d4ae563c$export$Level1_1;var $803176d1d2905276e28c7469d4ae563c$export$Level1_2=$803176d1d2905276e28c7469d4ae563c$var$Level1_2;$803176d1d2905276e28c7469d4ae563c$exports.Level1_2=$803176d1d2905276e28c7469d4ae563c$export$Level1_2;var $803176d1d2905276e28c7469d4ae563c$export$Level1_3=$803176d1d2905276e28c7469d4ae563c$var$Level1_3;$803176d1d2905276e28c7469d4ae563c$exports.Level1_3=$803176d1d2905276e28c7469d4ae563c$export$Level1_3;var $803176d1d2905276e28c7469d4ae563c$export$Level2=$803176d1d2905276e28c7469d4ae563c$var$Level2;$803176d1d2905276e28c7469d4ae563c$exports.Level2=$803176d1d2905276e28c7469d4ae563c$export$Level2;var $803176d1d2905276e28c7469d4ae563c$export$Level2_1=$803176d1d2905276e28c7469d4ae563c$var$Level2_1;$803176d1d2905276e28c7469d4ae563c$exports.Level2_1=$803176d1d2905276e28c7469d4ae563c$export$Level2_1;var $803176d1d2905276e28c7469d4ae563c$export$Level2_2=$803176d1d2905276e28c7469d4ae563c$var$Level2_2;$803176d1d2905276e28c7469d4ae563c$exports.Level2_2=$803176d1d2905276e28c7469d4ae563c$export$Level2_2;var $803176d1d2905276e28c7469d4ae563c$export$Level3=$803176d1d2905276e28c7469d4ae563c$var$Level3;$803176d1d2905276e28c7469d4ae563c$exports.Level3=$803176d1d2905276e28c7469d4ae563c$export$Level3;var $803176d1d2905276e28c7469d4ae563c$export$Level3_1=$803176d1d2905276e28c7469d4ae563c$var$Level3_1;$803176d1d2905276e28c7469d4ae563c$exports.Level3_1=$803176d1d2905276e28c7469d4ae563c$export$Level3_1;var $803176d1d2905276e28c7469d4ae563c$export$Level3_2=$803176d1d2905276e28c7469d4ae563c$var$Level3_2;$803176d1d2905276e28c7469d4ae563c$exports.Level3_2=$803176d1d2905276e28c7469d4ae563c$export$Level3_2;var $803176d1d2905276e28c7469d4ae563c$export$Level4=$803176d1d2905276e28c7469d4ae563c$var$Level4;$803176d1d2905276e28c7469d4ae563c$exports.Level4=$803176d1d2905276e28c7469d4ae563c$export$Level4;var $803176d1d2905276e28c7469d4ae563c$export$Level4_1=$803176d1d2905276e28c7469d4ae563c$var$Level4_1;$803176d1d2905276e28c7469d4ae563c$exports.Level4_1=$803176d1d2905276e28c7469d4ae563c$export$Level4_1;var $803176d1d2905276e28c7469d4ae563c$export$Level4_2=$803176d1d2905276e28c7469d4ae563c$var$Level4_2;$803176d1d2905276e28c7469d4ae563c$exports.Level4_2=$803176d1d2905276e28c7469d4ae563c$export$Level4_2;var $803176d1d2905276e28c7469d4ae563c$export$Level5=$803176d1d2905276e28c7469d4ae563c$var$Level5;$803176d1d2905276e28c7469d4ae563c$exports.Level5=$803176d1d2905276e28c7469d4ae563c$export$Level5;var $803176d1d2905276e28c7469d4ae563c$export$Level5_1=$803176d1d2905276e28c7469d4ae563c$var$Level5_1;$803176d1d2905276e28c7469d4ae563c$exports.Level5_1=$803176d1d2905276e28c7469d4ae563c$export$Level5_1;var $803176d1d2905276e28c7469d4ae563c$export$Level5_2=$803176d1d2905276e28c7469d4ae563c$var$Level5_2;$803176d1d2905276e28c7469d4ae563c$exports.Level5_2=$803176d1d2905276e28c7469d4ae563c$export$Level5_2;class $803176d1d2905276e28c7469d4ae563c$var$ProfileLevelId{constructor(e,a){this.profile=e,this.level=a}}var $803176d1d2905276e28c7469d4ae563c$export$ProfileLevelId=$803176d1d2905276e28c7469d4ae563c$var$ProfileLevelId;$803176d1d2905276e28c7469d4ae563c$exports.ProfileLevelId=$803176d1d2905276e28c7469d4ae563c$export$ProfileLevelId;const $803176d1d2905276e28c7469d4ae563c$var$DefaultProfileLevelId=new $803176d1d2905276e28c7469d4ae563c$var$ProfileLevelId($803176d1d2905276e28c7469d4ae563c$var$ProfileConstrainedBaseline,$803176d1d2905276e28c7469d4ae563c$var$Level3_1),$803176d1d2905276e28c7469d4ae563c$var$ConstraintSet3Flag=16;class $803176d1d2905276e28c7469d4ae563c$var$BitPattern{constructor(e){this._mask=~$803176d1d2905276e28c7469d4ae563c$var$byteMaskString("x",e),this._maskedValue=$803176d1d2905276e28c7469d4ae563c$var$byteMaskString("1",e)}isMatch(e){return this._maskedValue===(e&this._mask)}}class $803176d1d2905276e28c7469d4ae563c$var$ProfilePattern{constructor(e,a,t){this.profile_idc=e,this.profile_iop=a,this.profile=t}}const $803176d1d2905276e28c7469d4ae563c$var$ProfilePatterns=[new $803176d1d2905276e28c7469d4ae563c$var$ProfilePattern(66,new $803176d1d2905276e28c7469d4ae563c$var$BitPattern("x1xx0000"),$803176d1d2905276e28c7469d4ae563c$var$ProfileConstrainedBaseline),new $803176d1d2905276e28c7469d4ae563c$var$ProfilePattern(77,new $803176d1d2905276e28c7469d4ae563c$var$BitPattern("1xxx0000"),$803176d1d2905276e28c7469d4ae563c$var$ProfileConstrainedBaseline),new $803176d1d2905276e28c7469d4ae563c$var$ProfilePattern(88,new $803176d1d2905276e28c7469d4ae563c$var$BitPattern("11xx0000"),$803176d1d2905276e28c7469d4ae563c$var$ProfileConstrainedBaseline),new $803176d1d2905276e28c7469d4ae563c$var$ProfilePattern(66,new $803176d1d2905276e28c7469d4ae563c$var$BitPattern("x0xx0000"),$803176d1d2905276e28c7469d4ae563c$var$ProfileBaseline),new $803176d1d2905276e28c7469d4ae563c$var$ProfilePattern(88,new $803176d1d2905276e28c7469d4ae563c$var$BitPattern("10xx0000"),$803176d1d2905276e28c7469d4ae563c$var$ProfileBaseline),new $803176d1d2905276e28c7469d4ae563c$var$ProfilePattern(77,new $803176d1d2905276e28c7469d4ae563c$var$BitPattern("0x0x0000"),$803176d1d2905276e28c7469d4ae563c$var$ProfileMain),new $803176d1d2905276e28c7469d4ae563c$var$ProfilePattern(100,new $803176d1d2905276e28c7469d4ae563c$var$BitPattern("00000000"),$803176d1d2905276e28c7469d4ae563c$var$ProfileHigh),new $803176d1d2905276e28c7469d4ae563c$var$ProfilePattern(100,new $803176d1d2905276e28c7469d4ae563c$var$BitPattern("00001100"),$803176d1d2905276e28c7469d4ae563c$var$ProfileConstrainedHigh)];var $803176d1d2905276e28c7469d4ae563c$export$parseProfileLevelId=function(e){if("string"!=typeof e||6!==e.length)return null;const a=parseInt(e,16);if(0===a)return null;const t=255&a,r=a>>8&255,c=a>>16&255;let s;switch(t){case $803176d1d2905276e28c7469d4ae563c$var$Level1_1:s=0!=(r&$803176d1d2905276e28c7469d4ae563c$var$ConstraintSet3Flag)?$803176d1d2905276e28c7469d4ae563c$var$Level1_b:$803176d1d2905276e28c7469d4ae563c$var$Level1_1;break;case $803176d1d2905276e28c7469d4ae563c$var$Level1:case $803176d1d2905276e28c7469d4ae563c$var$Level1_2:case $803176d1d2905276e28c7469d4ae563c$var$Level1_3:case $803176d1d2905276e28c7469d4ae563c$var$Level2:case $803176d1d2905276e28c7469d4ae563c$var$Level2_1:case $803176d1d2905276e28c7469d4ae563c$var$Level2_2:case $803176d1d2905276e28c7469d4ae563c$var$Level3:case $803176d1d2905276e28c7469d4ae563c$var$Level3_1:case $803176d1d2905276e28c7469d4ae563c$var$Level3_2:case $803176d1d2905276e28c7469d4ae563c$var$Level4:case $803176d1d2905276e28c7469d4ae563c$var$Level4_1:case $803176d1d2905276e28c7469d4ae563c$var$Level4_2:case $803176d1d2905276e28c7469d4ae563c$var$Level5:case $803176d1d2905276e28c7469d4ae563c$var$Level5_1:case $803176d1d2905276e28c7469d4ae563c$var$Level5_2:s=t;break;default:return $803176d1d2905276e28c7469d4ae563c$var$debug("parseProfileLevelId() | unrecognized level_idc:%s",t),null}for(const e of $803176d1d2905276e28c7469d4ae563c$var$ProfilePatterns)if(c===e.profile_idc&&e.profile_iop.isMatch(r))return new $803176d1d2905276e28c7469d4ae563c$var$ProfileLevelId(e.profile,s);return $803176d1d2905276e28c7469d4ae563c$var$debug("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null};$803176d1d2905276e28c7469d4ae563c$exports.parseProfileLevelId=$803176d1d2905276e28c7469d4ae563c$export$parseProfileLevelId;var $803176d1d2905276e28c7469d4ae563c$export$profileLevelIdToString=function(e){if(e.level==$803176d1d2905276e28c7469d4ae563c$var$Level1_b)switch(e.profile){case $803176d1d2905276e28c7469d4ae563c$var$ProfileConstrainedBaseline:return"42f00b";case $803176d1d2905276e28c7469d4ae563c$var$ProfileBaseline:return"42100b";case $803176d1d2905276e28c7469d4ae563c$var$ProfileMain:return"4d100b";default:return $803176d1d2905276e28c7469d4ae563c$var$debug("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",e.profile),null}let a;switch(e.profile){case $803176d1d2905276e28c7469d4ae563c$var$ProfileConstrainedBaseline:a="42e0";break;case $803176d1d2905276e28c7469d4ae563c$var$ProfileBaseline:a="4200";break;case $803176d1d2905276e28c7469d4ae563c$var$ProfileMain:a="4d00";break;case $803176d1d2905276e28c7469d4ae563c$var$ProfileConstrainedHigh:a="640c";break;case $803176d1d2905276e28c7469d4ae563c$var$ProfileHigh:a="6400";break;default:return $803176d1d2905276e28c7469d4ae563c$var$debug("profileLevelIdToString() | unrecognized profile:%s",e.profile),null}let t=e.level.toString(16);return 1===t.length&&(t=`0${t}`),`${a}${t}`};$803176d1d2905276e28c7469d4ae563c$exports.profileLevelIdToString=$803176d1d2905276e28c7469d4ae563c$export$profileLevelIdToString;var $803176d1d2905276e28c7469d4ae563c$export$parseSdpProfileLevelId=function(e={}){const a=e["profile-level-id"];return a?$803176d1d2905276e28c7469d4ae563c$export$parseProfileLevelId(a):$803176d1d2905276e28c7469d4ae563c$var$DefaultProfileLevelId};$803176d1d2905276e28c7469d4ae563c$exports.parseSdpProfileLevelId=$803176d1d2905276e28c7469d4ae563c$export$parseSdpProfileLevelId;var $803176d1d2905276e28c7469d4ae563c$export$isSameProfile=function(e={},a={}){const t=$803176d1d2905276e28c7469d4ae563c$export$parseSdpProfileLevelId(e),r=$803176d1d2905276e28c7469d4ae563c$export$parseSdpProfileLevelId(a);return Boolean(t&&r&&t.profile===r.profile)};$803176d1d2905276e28c7469d4ae563c$exports.isSameProfile=$803176d1d2905276e28c7469d4ae563c$export$isSameProfile;var $803176d1d2905276e28c7469d4ae563c$export$generateProfileLevelIdForAnswer=function(e={},a={}){if(!e["profile-level-id"]&&!a["profile-level-id"])return $803176d1d2905276e28c7469d4ae563c$var$debug("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;const t=$803176d1d2905276e28c7469d4ae563c$export$parseSdpProfileLevelId(e),r=$803176d1d2905276e28c7469d4ae563c$export$parseSdpProfileLevelId(a);if(!t)throw new TypeError("invalid local_profile_level_id");if(!r)throw new TypeError("invalid remote_profile_level_id");if(t.profile!==r.profile)throw new TypeError("H264 Profile mismatch");const c=$803176d1d2905276e28c7469d4ae563c$var$isLevelAsymmetryAllowed(e)&&$803176d1d2905276e28c7469d4ae563c$var$isLevelAsymmetryAllowed(a),s=t.level,d=$803176d1d2905276e28c7469d4ae563c$var$minLevel(s,r.level),i=c?s:d;return $803176d1d2905276e28c7469d4ae563c$var$debug("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",t.profile,i),$803176d1d2905276e28c7469d4ae563c$export$profileLevelIdToString(new $803176d1d2905276e28c7469d4ae563c$var$ProfileLevelId(t.profile,i))};function $803176d1d2905276e28c7469d4ae563c$var$byteMaskString(e,a){return(a[0]===e)<<7|(a[1]===e)<<6|(a[2]===e)<<5|(a[3]===e)<<4|(a[4]===e)<<3|(a[5]===e)<<2|(a[6]===e)<<1|(a[7]===e)<<0}function $803176d1d2905276e28c7469d4ae563c$var$isLessLevel(e,a){return e===$803176d1d2905276e28c7469d4ae563c$var$Level1_b?a!==$803176d1d2905276e28c7469d4ae563c$var$Level1&&a!==$803176d1d2905276e28c7469d4ae563c$var$Level1_b:a===$803176d1d2905276e28c7469d4ae563c$var$Level1_b?e!==$803176d1d2905276e28c7469d4ae563c$var$Level1:e<a}function $803176d1d2905276e28c7469d4ae563c$var$minLevel(e,a){return $803176d1d2905276e28c7469d4ae563c$var$isLessLevel(e,a)?e:a}function $803176d1d2905276e28c7469d4ae563c$var$isLevelAsymmetryAllowed(e={}){const a=e["level-asymmetry-allowed"];return 1===a||"1"===a}$803176d1d2905276e28c7469d4ae563c$exports.generateProfileLevelIdForAnswer=$803176d1d2905276e28c7469d4ae563c$export$generateProfileLevelIdForAnswer;const $c14b343179c41479c8bdeecb64f7be76$var$h264=$c14b343179c41479c8bdeecb64f7be76$var$__importStar($803176d1d2905276e28c7469d4ae563c$exports),$c14b343179c41479c8bdeecb64f7be76$var$utils=$c14b343179c41479c8bdeecb64f7be76$var$__importStar($6abc7ab33e1327c2d411a5fc6b37fe23$exports),$c14b343179c41479c8bdeecb64f7be76$var$RTP_PROBATOR_MID="probator",$c14b343179c41479c8bdeecb64f7be76$var$RTP_PROBATOR_SSRC=1234,$c14b343179c41479c8bdeecb64f7be76$var$RTP_PROBATOR_CODEC_PAYLOAD_TYPE=127;function $c14b343179c41479c8bdeecb64f7be76$var$validateRtpCapabilities(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);for(const a of e.codecs)$c14b343179c41479c8bdeecb64f7be76$var$validateRtpCodecCapability(a);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const a of e.headerExtensions)$c14b343179c41479c8bdeecb64f7be76$var$validateRtpHeaderExtension(a)}var $c14b343179c41479c8bdeecb64f7be76$export$validateRtpCapabilities=$c14b343179c41479c8bdeecb64f7be76$var$validateRtpCapabilities;function $c14b343179c41479c8bdeecb64f7be76$var$validateRtpCodecCapability(e){const a=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const t=a.exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");if(e.kind=t[1].toLowerCase(),e.preferredPayloadType&&"number"!=typeof e.preferredPayloadType)throw new TypeError("invalid codec.preferredPayloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===e.kind?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const a of Object.keys(e.parameters)){let t=e.parameters[a];if(void 0===t&&(e.parameters[a]="",t=""),"string"!=typeof t&&"number"!=typeof t)throw new TypeError(`invalid codec parameter [key:${a}s, value:${t}]`);if("apt"===a&&"number"!=typeof t)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);for(const a of e.rtcpFeedback)$c14b343179c41479c8bdeecb64f7be76$var$validateRtcpFeedback(a)}$c14b343179c41479c8bdeecb64f7be76$exports.validateRtpCapabilities=$c14b343179c41479c8bdeecb64f7be76$export$validateRtpCapabilities;var $c14b343179c41479c8bdeecb64f7be76$export$validateRtpCodecCapability=$c14b343179c41479c8bdeecb64f7be76$var$validateRtpCodecCapability;function $c14b343179c41479c8bdeecb64f7be76$var$validateRtcpFeedback(e){if("object"!=typeof e)throw new TypeError("fb is not an object");if(!e.type||"string"!=typeof e.type)throw new TypeError("missing fb.type");e.parameter&&"string"==typeof e.parameter||(e.parameter="")}$c14b343179c41479c8bdeecb64f7be76$exports.validateRtpCodecCapability=$c14b343179c41479c8bdeecb64f7be76$export$validateRtpCodecCapability;var $c14b343179c41479c8bdeecb64f7be76$export$validateRtcpFeedback=$c14b343179c41479c8bdeecb64f7be76$var$validateRtcpFeedback;function $c14b343179c41479c8bdeecb64f7be76$var$validateRtpHeaderExtension(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if(e.kind&&"string"==typeof e.kind||(e.kind=""),""!==e.kind&&"audio"!==e.kind&&"video"!==e.kind)throw new TypeError("invalid ext.kind");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.preferredId)throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&"boolean"!=typeof e.preferredEncrypt)throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&"string"!=typeof e.direction)throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}$c14b343179c41479c8bdeecb64f7be76$exports.validateRtcpFeedback=$c14b343179c41479c8bdeecb64f7be76$export$validateRtcpFeedback;var $c14b343179c41479c8bdeecb64f7be76$export$validateRtpHeaderExtension=$c14b343179c41479c8bdeecb64f7be76$var$validateRtpHeaderExtension;function $c14b343179c41479c8bdeecb64f7be76$var$validateRtpParameters(e){if("object"!=typeof e)throw new TypeError("params is not an object");if(e.mid&&"string"!=typeof e.mid)throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");for(const a of e.codecs)$c14b343179c41479c8bdeecb64f7be76$var$validateRtpCodecParameters(a);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const a of e.headerExtensions)$c14b343179c41479c8bdeecb64f7be76$var$validateRtpHeaderExtensionParameters(a);if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);for(const a of e.encodings)$c14b343179c41479c8bdeecb64f7be76$var$validateRtpEncodingParameters(a);if(e.rtcp&&"object"!=typeof e.rtcp)throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),$c14b343179c41479c8bdeecb64f7be76$var$validateRtcpParameters(e.rtcp)}$c14b343179c41479c8bdeecb64f7be76$exports.validateRtpHeaderExtension=$c14b343179c41479c8bdeecb64f7be76$export$validateRtpHeaderExtension;var $c14b343179c41479c8bdeecb64f7be76$export$validateRtpParameters=$c14b343179c41479c8bdeecb64f7be76$var$validateRtpParameters;function $c14b343179c41479c8bdeecb64f7be76$var$validateRtpCodecParameters(e){const a=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const t=a.exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");if("number"!=typeof e.payloadType)throw new TypeError("missing codec.payloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===t[1].toLowerCase()?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const a of Object.keys(e.parameters)){let t=e.parameters[a];if(void 0===t&&(e.parameters[a]="",t=""),"string"!=typeof t&&"number"!=typeof t)throw new TypeError(`invalid codec parameter [key:${a}s, value:${t}]`);if("apt"===a&&"number"!=typeof t)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);for(const a of e.rtcpFeedback)$c14b343179c41479c8bdeecb64f7be76$var$validateRtcpFeedback(a)}$c14b343179c41479c8bdeecb64f7be76$exports.validateRtpParameters=$c14b343179c41479c8bdeecb64f7be76$export$validateRtpParameters;var $c14b343179c41479c8bdeecb64f7be76$export$validateRtpCodecParameters=$c14b343179c41479c8bdeecb64f7be76$var$validateRtpCodecParameters;function $c14b343179c41479c8bdeecb64f7be76$var$validateRtpHeaderExtensionParameters(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.id)throw new TypeError("missing ext.id");if(e.encrypt&&"boolean"!=typeof e.encrypt)throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const a of Object.keys(e.parameters)){let t=e.parameters[a];if(void 0===t&&(e.parameters[a]="",t=""),"string"!=typeof t&&"number"!=typeof t)throw new TypeError("invalid header extension parameter")}}$c14b343179c41479c8bdeecb64f7be76$exports.validateRtpCodecParameters=$c14b343179c41479c8bdeecb64f7be76$export$validateRtpCodecParameters;var $c14b343179c41479c8bdeecb64f7be76$export$validateRtpHeaderExtensionParameters=$c14b343179c41479c8bdeecb64f7be76$var$validateRtpHeaderExtensionParameters;function $c14b343179c41479c8bdeecb64f7be76$var$validateRtpEncodingParameters(e){if("object"!=typeof e)throw new TypeError("encoding is not an object");if(e.ssrc&&"number"!=typeof e.ssrc)throw new TypeError("invalid encoding.ssrc");if(e.rid&&"string"!=typeof e.rid)throw new TypeError("invalid encoding.rid");if(e.rtx&&"object"!=typeof e.rtx)throw new TypeError("invalid encoding.rtx");if(e.rtx&&"number"!=typeof e.rtx.ssrc)throw new TypeError("missing encoding.rtx.ssrc");if(e.dtx&&"boolean"==typeof e.dtx||(e.dtx=!1),e.scalabilityMode&&"string"!=typeof e.scalabilityMode)throw new TypeError("invalid encoding.scalabilityMode")}$c14b343179c41479c8bdeecb64f7be76$exports.validateRtpHeaderExtensionParameters=$c14b343179c41479c8bdeecb64f7be76$export$validateRtpHeaderExtensionParameters;var $c14b343179c41479c8bdeecb64f7be76$export$validateRtpEncodingParameters=$c14b343179c41479c8bdeecb64f7be76$var$validateRtpEncodingParameters;function $c14b343179c41479c8bdeecb64f7be76$var$validateRtcpParameters(e){if("object"!=typeof e)throw new TypeError("rtcp is not an object");if(e.cname&&"string"!=typeof e.cname)throw new TypeError("invalid rtcp.cname");e.reducedSize&&"boolean"==typeof e.reducedSize||(e.reducedSize=!0)}$c14b343179c41479c8bdeecb64f7be76$exports.validateRtpEncodingParameters=$c14b343179c41479c8bdeecb64f7be76$export$validateRtpEncodingParameters;var $c14b343179c41479c8bdeecb64f7be76$export$validateRtcpParameters=$c14b343179c41479c8bdeecb64f7be76$var$validateRtcpParameters;function $c14b343179c41479c8bdeecb64f7be76$var$validateSctpCapabilities(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(!e.numStreams||"object"!=typeof e.numStreams)throw new TypeError("missing caps.numStreams");$c14b343179c41479c8bdeecb64f7be76$var$validateNumSctpStreams(e.numStreams)}$c14b343179c41479c8bdeecb64f7be76$exports.validateRtcpParameters=$c14b343179c41479c8bdeecb64f7be76$export$validateRtcpParameters;var $c14b343179c41479c8bdeecb64f7be76$export$validateSctpCapabilities=$c14b343179c41479c8bdeecb64f7be76$var$validateSctpCapabilities;function $c14b343179c41479c8bdeecb64f7be76$var$validateNumSctpStreams(e){if("object"!=typeof e)throw new TypeError("numStreams is not an object");if("number"!=typeof e.OS)throw new TypeError("missing numStreams.OS");if("number"!=typeof e.MIS)throw new TypeError("missing numStreams.MIS")}$c14b343179c41479c8bdeecb64f7be76$exports.validateSctpCapabilities=$c14b343179c41479c8bdeecb64f7be76$export$validateSctpCapabilities;var $c14b343179c41479c8bdeecb64f7be76$export$validateNumSctpStreams=$c14b343179c41479c8bdeecb64f7be76$var$validateNumSctpStreams;function $c14b343179c41479c8bdeecb64f7be76$var$validateSctpParameters(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.port)throw new TypeError("missing params.port");if("number"!=typeof e.OS)throw new TypeError("missing params.OS");if("number"!=typeof e.MIS)throw new TypeError("missing params.MIS");if("number"!=typeof e.maxMessageSize)throw new TypeError("missing params.maxMessageSize")}$c14b343179c41479c8bdeecb64f7be76$exports.validateNumSctpStreams=$c14b343179c41479c8bdeecb64f7be76$export$validateNumSctpStreams;var $c14b343179c41479c8bdeecb64f7be76$export$validateSctpParameters=$c14b343179c41479c8bdeecb64f7be76$var$validateSctpParameters;function $c14b343179c41479c8bdeecb64f7be76$var$validateSctpStreamParameters(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.streamId)throw new TypeError("missing params.streamId");let a=!1;if("boolean"==typeof e.ordered?a=!0:e.ordered=!0,e.maxPacketLifeTime&&"number"!=typeof e.maxPacketLifeTime)throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&"number"!=typeof e.maxRetransmits)throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(a&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(a||!e.maxPacketLifeTime&&!e.maxRetransmits||(e.ordered=!1),e.priority&&"string"!=typeof e.priority)throw new TypeError("invalid params.priority");if(e.label&&"string"!=typeof e.label)throw new TypeError("invalid params.label");if(e.protocol&&"string"!=typeof e.protocol)throw new TypeError("invalid params.protocol")}$c14b343179c41479c8bdeecb64f7be76$exports.validateSctpParameters=$c14b343179c41479c8bdeecb64f7be76$export$validateSctpParameters;var $c14b343179c41479c8bdeecb64f7be76$export$validateSctpStreamParameters=$c14b343179c41479c8bdeecb64f7be76$var$validateSctpStreamParameters;function $c14b343179c41479c8bdeecb64f7be76$var$getExtendedRtpCapabilities(e,a){const t={codecs:[],headerExtensions:[]};for(const r of a.codecs||[]){if($c14b343179c41479c8bdeecb64f7be76$var$isRtxCodec(r))continue;const a=(e.codecs||[]).find((e=>$c14b343179c41479c8bdeecb64f7be76$var$matchCodecs(e,r,{strict:!0,modify:!0})));if(!a)continue;const c={mimeType:a.mimeType,kind:a.kind,clockRate:a.clockRate,channels:a.channels,localPayloadType:a.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:r.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:a.parameters,remoteParameters:r.parameters,rtcpFeedback:$c14b343179c41479c8bdeecb64f7be76$var$reduceRtcpFeedback(a,r)};t.codecs.push(c)}for(const r of t.codecs){const t=e.codecs.find((e=>$c14b343179c41479c8bdeecb64f7be76$var$isRtxCodec(e)&&e.parameters.apt===r.localPayloadType)),c=a.codecs.find((e=>$c14b343179c41479c8bdeecb64f7be76$var$isRtxCodec(e)&&e.parameters.apt===r.remotePayloadType));t&&c&&(r.localRtxPayloadType=t.preferredPayloadType,r.remoteRtxPayloadType=c.preferredPayloadType)}for(const r of a.headerExtensions){const a=e.headerExtensions.find((e=>$c14b343179c41479c8bdeecb64f7be76$var$matchHeaderExtensions(e,r)));if(!a)continue;const c={kind:r.kind,uri:r.uri,sendId:a.preferredId,recvId:r.preferredId,encrypt:a.preferredEncrypt,direction:"sendrecv"};switch(r.direction){case"sendrecv":c.direction="sendrecv";break;case"recvonly":c.direction="sendonly";break;case"sendonly":c.direction="recvonly";break;case"inactive":c.direction="inactive"}t.headerExtensions.push(c)}return t}$c14b343179c41479c8bdeecb64f7be76$exports.validateSctpStreamParameters=$c14b343179c41479c8bdeecb64f7be76$export$validateSctpStreamParameters;var $c14b343179c41479c8bdeecb64f7be76$export$getExtendedRtpCapabilities=$c14b343179c41479c8bdeecb64f7be76$var$getExtendedRtpCapabilities;function $c14b343179c41479c8bdeecb64f7be76$var$getRecvRtpCapabilities(e){const a={codecs:[],headerExtensions:[]};for(const t of e.codecs){const e={mimeType:t.mimeType,kind:t.kind,preferredPayloadType:t.remotePayloadType,clockRate:t.clockRate,channels:t.channels,parameters:t.localParameters,rtcpFeedback:t.rtcpFeedback};if(a.codecs.push(e),!t.remoteRtxPayloadType)continue;const r={mimeType:`${t.kind}/rtx`,kind:t.kind,preferredPayloadType:t.remoteRtxPayloadType,clockRate:t.clockRate,parameters:{apt:t.remotePayloadType},rtcpFeedback:[]};a.codecs.push(r)}for(const t of e.headerExtensions){if("sendrecv"!==t.direction&&"recvonly"!==t.direction)continue;const e={kind:t.kind,uri:t.uri,preferredId:t.recvId,preferredEncrypt:t.encrypt,direction:t.direction};a.headerExtensions.push(e)}return a}$c14b343179c41479c8bdeecb64f7be76$exports.getExtendedRtpCapabilities=$c14b343179c41479c8bdeecb64f7be76$export$getExtendedRtpCapabilities;var $c14b343179c41479c8bdeecb64f7be76$export$getRecvRtpCapabilities=$c14b343179c41479c8bdeecb64f7be76$var$getRecvRtpCapabilities;function $c14b343179c41479c8bdeecb64f7be76$var$getSendingRtpParameters(e,a){const t={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const r of a.codecs){if(r.kind!==e)continue;const a={mimeType:r.mimeType,payloadType:r.localPayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.localParameters,rtcpFeedback:r.rtcpFeedback};if(t.codecs.push(a),r.localRtxPayloadType){const e={mimeType:`${r.kind}/rtx`,payloadType:r.localRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.localPayloadType},rtcpFeedback:[]};t.codecs.push(e)}}for(const r of a.headerExtensions){if(r.kind&&r.kind!==e||"sendrecv"!==r.direction&&"sendonly"!==r.direction)continue;const a={uri:r.uri,id:r.sendId,encrypt:r.encrypt,parameters:{}};t.headerExtensions.push(a)}return t}$c14b343179c41479c8bdeecb64f7be76$exports.getRecvRtpCapabilities=$c14b343179c41479c8bdeecb64f7be76$export$getRecvRtpCapabilities;var $c14b343179c41479c8bdeecb64f7be76$export$getSendingRtpParameters=$c14b343179c41479c8bdeecb64f7be76$var$getSendingRtpParameters;function $c14b343179c41479c8bdeecb64f7be76$var$getSendingRemoteRtpParameters(e,a){const t={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const r of a.codecs){if(r.kind!==e)continue;const a={mimeType:r.mimeType,payloadType:r.localPayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.remoteParameters,rtcpFeedback:r.rtcpFeedback};if(t.codecs.push(a),r.localRtxPayloadType){const e={mimeType:`${r.kind}/rtx`,payloadType:r.localRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.localPayloadType},rtcpFeedback:[]};t.codecs.push(e)}}for(const r of a.headerExtensions){if(r.kind&&r.kind!==e||"sendrecv"!==r.direction&&"sendonly"!==r.direction)continue;const a={uri:r.uri,id:r.sendId,encrypt:r.encrypt,parameters:{}};t.headerExtensions.push(a)}if(t.headerExtensions.some((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri)))for(const e of t.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"goog-remb"!==e.type));else if(t.headerExtensions.some((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri)))for(const e of t.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"transport-cc"!==e.type));else for(const e of t.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"transport-cc"!==e.type&&"goog-remb"!==e.type));return t}$c14b343179c41479c8bdeecb64f7be76$exports.getSendingRtpParameters=$c14b343179c41479c8bdeecb64f7be76$export$getSendingRtpParameters;var $c14b343179c41479c8bdeecb64f7be76$export$getSendingRemoteRtpParameters=$c14b343179c41479c8bdeecb64f7be76$var$getSendingRemoteRtpParameters;function $c14b343179c41479c8bdeecb64f7be76$var$reduceCodecs(e,a){const t=[];if(a){for(let r=0;r<e.length;++r)if($c14b343179c41479c8bdeecb64f7be76$var$matchCodecs(e[r],a)){t.push(e[r]),$c14b343179c41479c8bdeecb64f7be76$var$isRtxCodec(e[r+1])&&t.push(e[r+1]);break}if(0===t.length)throw new TypeError("no matching codec found")}else t.push(e[0]),$c14b343179c41479c8bdeecb64f7be76$var$isRtxCodec(e[1])&&t.push(e[1]);return t}$c14b343179c41479c8bdeecb64f7be76$exports.getSendingRemoteRtpParameters=$c14b343179c41479c8bdeecb64f7be76$export$getSendingRemoteRtpParameters;var $c14b343179c41479c8bdeecb64f7be76$export$reduceCodecs=$c14b343179c41479c8bdeecb64f7be76$var$reduceCodecs;function $c14b343179c41479c8bdeecb64f7be76$var$generateProbatorRtpParameters(e){$c14b343179c41479c8bdeecb64f7be76$var$validateRtpParameters(e=$c14b343179c41479c8bdeecb64f7be76$var$utils.clone(e,{}));const a={mid:$c14b343179c41479c8bdeecb64f7be76$var$RTP_PROBATOR_MID,codecs:[],headerExtensions:[],encodings:[{ssrc:$c14b343179c41479c8bdeecb64f7be76$var$RTP_PROBATOR_SSRC}],rtcp:{cname:"probator"}};return a.codecs.push(e.codecs[0]),a.codecs[0].payloadType=$c14b343179c41479c8bdeecb64f7be76$var$RTP_PROBATOR_CODEC_PAYLOAD_TYPE,a.headerExtensions=e.headerExtensions,a}$c14b343179c41479c8bdeecb64f7be76$exports.reduceCodecs=$c14b343179c41479c8bdeecb64f7be76$export$reduceCodecs;var $c14b343179c41479c8bdeecb64f7be76$export$generateProbatorRtpParameters=$c14b343179c41479c8bdeecb64f7be76$var$generateProbatorRtpParameters;function $c14b343179c41479c8bdeecb64f7be76$var$canSend(e,a){return a.codecs.some((a=>a.kind===e))}$c14b343179c41479c8bdeecb64f7be76$exports.generateProbatorRtpParameters=$c14b343179c41479c8bdeecb64f7be76$export$generateProbatorRtpParameters;var $c14b343179c41479c8bdeecb64f7be76$export$canSend=$c14b343179c41479c8bdeecb64f7be76$var$canSend;function $c14b343179c41479c8bdeecb64f7be76$var$canReceive(e,a){if($c14b343179c41479c8bdeecb64f7be76$var$validateRtpParameters(e),0===e.codecs.length)return!1;const t=e.codecs[0];return a.codecs.some((e=>e.remotePayloadType===t.payloadType))}function $c14b343179c41479c8bdeecb64f7be76$var$isRtxCodec(e){return!!e&&/.+\/rtx$/i.test(e.mimeType)}function $c14b343179c41479c8bdeecb64f7be76$var$matchCodecs(e,a,{strict:t=!1,modify:r=!1}={}){const c=e.mimeType.toLowerCase();if(c!==a.mimeType.toLowerCase())return!1;if(e.clockRate!==a.clockRate)return!1;if(e.channels!==a.channels)return!1;switch(c){case"video/h264":if((e.parameters["packetization-mode"]||0)!==(a.parameters["packetization-mode"]||0))return!1;if(t){if(!$c14b343179c41479c8bdeecb64f7be76$var$h264.isSameProfile(e.parameters,a.parameters))return!1;let t;try{t=$c14b343179c41479c8bdeecb64f7be76$var$h264.generateProfileLevelIdForAnswer(e.parameters,a.parameters)}catch(e){return!1}r&&(t?(e.parameters["profile-level-id"]=t,a.parameters["profile-level-id"]=t):(delete e.parameters["profile-level-id"],delete a.parameters["profile-level-id"]))}break;case"video/vp9":if(t){if((e.parameters["profile-id"]||0)!==(a.parameters["profile-id"]||0))return!1}}return!0}function $c14b343179c41479c8bdeecb64f7be76$var$matchHeaderExtensions(e,a){return(!e.kind||!a.kind||e.kind===a.kind)&&e.uri===a.uri}function $c14b343179c41479c8bdeecb64f7be76$var$reduceRtcpFeedback(e,a){const t=[];for(const r of e.rtcpFeedback||[]){const e=(a.rtcpFeedback||[]).find((e=>e.type===r.type&&(e.parameter===r.parameter||!e.parameter&&!r.parameter)));e&&t.push(e)}return t}$c14b343179c41479c8bdeecb64f7be76$exports.canSend=$c14b343179c41479c8bdeecb64f7be76$export$canSend,$c14b343179c41479c8bdeecb64f7be76$export$canReceive=$c14b343179c41479c8bdeecb64f7be76$var$canReceive,$c14b343179c41479c8bdeecb64f7be76$exports.canReceive=$c14b343179c41479c8bdeecb64f7be76$export$canReceive;const $300fb327e45c7345f50fad064ffa0c99$var$ortc=$300fb327e45c7345f50fad064ffa0c99$var$__importStar($c14b343179c41479c8bdeecb64f7be76$exports);var $5f92f7b37da9b8a6f20b18d49540582a$exports={},$5f92f7b37da9b8a6f20b18d49540582a$var$__createBinding=$5f92f7b37da9b8a6f20b18d49540582a$exports&&$5f92f7b37da9b8a6f20b18d49540582a$exports.__createBinding||(Object.create?function(e,a,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,r){void 0===r&&(r=t),e[r]=a[t]}),$5f92f7b37da9b8a6f20b18d49540582a$var$__setModuleDefault=$5f92f7b37da9b8a6f20b18d49540582a$exports&&$5f92f7b37da9b8a6f20b18d49540582a$exports.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),$5f92f7b37da9b8a6f20b18d49540582a$var$__importStar=$5f92f7b37da9b8a6f20b18d49540582a$exports&&$5f92f7b37da9b8a6f20b18d49540582a$exports.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)"default"!==t&&Object.hasOwnProperty.call(e,t)&&$5f92f7b37da9b8a6f20b18d49540582a$var$__createBinding(a,e,t);return $5f92f7b37da9b8a6f20b18d49540582a$var$__setModuleDefault(a,e),a};Object.defineProperty($5f92f7b37da9b8a6f20b18d49540582a$exports,"__esModule",{value:!0});var $5f92f7b37da9b8a6f20b18d49540582a$export$Transport=void 0;$5f92f7b37da9b8a6f20b18d49540582a$exports.Transport=$5f92f7b37da9b8a6f20b18d49540582a$export$Transport;var $642d060551a4a60f1693af314145e4c8$exports={},$642d060551a4a60f1693af314145e4c8$var$__awaiter=$642d060551a4a60f1693af314145e4c8$exports&&$642d060551a4a60f1693af314145e4c8$exports.__awaiter||function(e,a,t,r){return new(t||(t=Promise))((function(c,s){function d(e){try{o(r.next(e))}catch(e){s(e)}}function i(e){try{o(r.throw(e))}catch(e){s(e)}}function o(e){var a;e.done?c(e.value):(a=e.value,a instanceof t?a:new t((function(e){e(a)}))).then(d,i)}o((r=r.apply(e,a||[])).next())}))};Object.defineProperty($642d060551a4a60f1693af314145e4c8$exports,"__esModule",{value:!0});class $642d060551a4a60f1693af314145e4c8$var$AwaitQueue{constructor({ClosedErrorClass:e=Error,StoppedErrorClass:a=Error}={ClosedErrorClass:Error,StoppedErrorClass:Error}){this.closed=!1,this.pendingTasks=[],this.ClosedErrorClass=Error,this.StoppedErrorClass=Error,this.ClosedErrorClass=e,this.StoppedErrorClass=a}get size(){return this.pendingTasks.length}close(){if(!this.closed){this.closed=!0;for(const e of this.pendingTasks)e.stopped=!0,e.reject(new this.ClosedErrorClass("AwaitQueue closed"));this.pendingTasks.length=0}}push(e,a){return $642d060551a4a60f1693af314145e4c8$var$__awaiter(this,void 0,void 0,(function*(){if(this.closed)throw new this.ClosedErrorClass("AwaitQueue closed");if("function"!=typeof e)throw new TypeError("given task is not a function");if(!e.name&&a)try{Object.defineProperty(e,"name",{value:a})}catch(e){}return new Promise(((t,r)=>{const c={task:e,name:a,resolve:t,reject:r,stopped:!1,enqueuedAt:new Date,executedAt:void 0};this.pendingTasks.push(c),1===this.pendingTasks.length&&this.next()}))}))}stop(){if(!this.closed){for(const e of this.pendingTasks)e.stopped=!0,e.reject(new this.StoppedErrorClass("AwaitQueue stopped"));this.pendingTasks.length=0}}dump(){const e=new Date;return this.pendingTasks.map((a=>({task:a.task,name:a.name,enqueuedTime:a.executedAt?a.executedAt.getTime()-a.enqueuedAt.getTime():e.getTime()-a.enqueuedAt.getTime(),executingTime:a.executedAt?e.getTime()-a.executedAt.getTime():0})))}next(){return $642d060551a4a60f1693af314145e4c8$var$__awaiter(this,void 0,void 0,(function*(){const e=this.pendingTasks[0];e&&(yield this.executeTask(e),this.pendingTasks.shift(),this.next())}))}executeTask(e){return $642d060551a4a60f1693af314145e4c8$var$__awaiter(this,void 0,void 0,(function*(){if(!e.stopped){e.executedAt=new Date;try{const a=yield e.task();if(e.stopped)return;e.resolve(a)}catch(a){if(e.stopped)return;e.reject(a)}}}))}}var $642d060551a4a60f1693af314145e4c8$export$AwaitQueue=$642d060551a4a60f1693af314145e4c8$var$AwaitQueue;$642d060551a4a60f1693af314145e4c8$exports.AwaitQueue=$642d060551a4a60f1693af314145e4c8$export$AwaitQueue;const $5f92f7b37da9b8a6f20b18d49540582a$var$utils=$5f92f7b37da9b8a6f20b18d49540582a$var$__importStar($6abc7ab33e1327c2d411a5fc6b37fe23$exports),$5f92f7b37da9b8a6f20b18d49540582a$var$ortc=$5f92f7b37da9b8a6f20b18d49540582a$var$__importStar($c14b343179c41479c8bdeecb64f7be76$exports);var $9bd46aaebdf0dcccd04feef1bfe3f740$exports={};Object.defineProperty($9bd46aaebdf0dcccd04feef1bfe3f740$exports,"__esModule",{value:!0});var $9bd46aaebdf0dcccd04feef1bfe3f740$export$Producer=void 0;$9bd46aaebdf0dcccd04feef1bfe3f740$exports.Producer=$9bd46aaebdf0dcccd04feef1bfe3f740$export$Producer;const $9bd46aaebdf0dcccd04feef1bfe3f740$var$logger=new $1495c7c2155b511d7a7eba88d183bc8a$exports.Logger("Producer");class $9bd46aaebdf0dcccd04feef1bfe3f740$var$Producer extends $233e1f2fffc8d465fe34283eded93370$exports.EnhancedEventEmitter{constructor({id:e,localId:a,rtpSender:t,track:r,rtpParameters:c,stopTracks:s,disableTrackOnPause:d,zeroRtpOnPause:i,appData:o}){super(),this._closed=!1,this._observer=new $233e1f2fffc8d465fe34283eded93370$exports.EnhancedEventEmitter,$9bd46aaebdf0dcccd04feef1bfe3f740$var$logger.debug("constructor()"),this._id=e,this._localId=a,this._rtpSender=t,this._track=r,this._kind=r.kind,this._rtpParameters=c,this._paused=!!d&&!r.enabled,this._maxSpatialLayer=void 0,this._stopTracks=s,this._disableTrackOnPause=d,this._zeroRtpOnPause=i,this._appData=o,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||($9bd46aaebdf0dcccd04feef1bfe3f740$var$logger.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||($9bd46aaebdf0dcccd04feef1bfe3f740$var$logger.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){$9bd46aaebdf0dcccd04feef1bfe3f740$var$logger.debug("pause()"),this._closed?$9bd46aaebdf0dcccd04feef1bfe3f740$var$logger.error("pause() | Producer closed"):(this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",null).catch((()=>{})),this._observer.safeEmit("pause"))}resume(){$9bd46aaebdf0dcccd04feef1bfe3f740$var$logger.debug("resume()"),this._closed?$9bd46aaebdf0dcccd04feef1bfe3f740$var$logger.error("resume() | Producer closed"):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",this._track).catch((()=>{})),this._observer.safeEmit("resume"))}async replaceTrack({track:e}){if($9bd46aaebdf0dcccd04feef1bfe3f740$var$logger.debug("replaceTrack() [track:%o]",e),this._closed){if(e&&this._stopTracks)try{e.stop()}catch(e){}throw new $bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError("closed")}if(e&&"ended"===e.readyState)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError("track ended");e!==this._track?(this._zeroRtpOnPause&&this._paused||await this.safeEmitAsPromise("@replacetrack",e),this._destroyTrack(),this._track=e,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this._handleTrack()):$9bd46aaebdf0dcccd04feef1bfe3f740$var$logger.debug("replaceTrack() | same track, ignored")}async setMaxSpatialLayer(e){if(this._closed)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError("closed");if("video"!==this._kind)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("not a video Producer");if("number"!=typeof e)throw new TypeError("invalid spatialLayer");e!==this._maxSpatialLayer&&(await this.safeEmitAsPromise("@setmaxspatiallayer",e),this._maxSpatialLayer=e)}async setRtpEncodingParameters(e){if(this._closed)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError("closed");if("object"!=typeof e)throw new TypeError("invalid params");await this.safeEmitAsPromise("@setrtpencodingparameters",e)}_onTrackEnded(){$9bd46aaebdf0dcccd04feef1bfe3f740$var$logger.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}_handleTrack(){this._track&&this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this._onTrackEnded),this._stopTracks&&this._track.stop()}catch(e){}}}$9bd46aaebdf0dcccd04feef1bfe3f740$export$Producer=$9bd46aaebdf0dcccd04feef1bfe3f740$var$Producer,$9bd46aaebdf0dcccd04feef1bfe3f740$exports.Producer=$9bd46aaebdf0dcccd04feef1bfe3f740$export$Producer;var $6d860932940735229ce399ee376f25ac$exports={};Object.defineProperty($6d860932940735229ce399ee376f25ac$exports,"__esModule",{value:!0});var $6d860932940735229ce399ee376f25ac$export$Consumer=void 0;$6d860932940735229ce399ee376f25ac$exports.Consumer=$6d860932940735229ce399ee376f25ac$export$Consumer;const $6d860932940735229ce399ee376f25ac$var$logger=new $1495c7c2155b511d7a7eba88d183bc8a$exports.Logger("Consumer");class $6d860932940735229ce399ee376f25ac$var$Consumer extends $233e1f2fffc8d465fe34283eded93370$exports.EnhancedEventEmitter{constructor({id:e,localId:a,producerId:t,rtpReceiver:r,track:c,rtpParameters:s,appData:d}){super(),this._closed=!1,this._observer=new $233e1f2fffc8d465fe34283eded93370$exports.EnhancedEventEmitter,$6d860932940735229ce399ee376f25ac$var$logger.debug("constructor()"),this._id=e,this._localId=a,this._producerId=t,this._rtpReceiver=r,this._track=c,this._rtpParameters=s,this._paused=!c.enabled,this._appData=d,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||($6d860932940735229ce399ee376f25ac$var$logger.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||($6d860932940735229ce399ee376f25ac$var$logger.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){$6d860932940735229ce399ee376f25ac$var$logger.debug("pause()"),this._closed?$6d860932940735229ce399ee376f25ac$var$logger.error("pause() | Consumer closed"):(this._paused=!0,this._track.enabled=!1,this._observer.safeEmit("pause"))}resume(){$6d860932940735229ce399ee376f25ac$var$logger.debug("resume()"),this._closed?$6d860932940735229ce399ee376f25ac$var$logger.error("resume() | Consumer closed"):(this._paused=!1,this._track.enabled=!0,this._observer.safeEmit("resume"))}_onTrackEnded(){$6d860932940735229ce399ee376f25ac$var$logger.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}_handleTrack(){this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){try{this._track.removeEventListener("ended",this._onTrackEnded),this._track.stop()}catch(e){}}}$6d860932940735229ce399ee376f25ac$export$Consumer=$6d860932940735229ce399ee376f25ac$var$Consumer,$6d860932940735229ce399ee376f25ac$exports.Consumer=$6d860932940735229ce399ee376f25ac$export$Consumer;var $e0d0870270a5e570fb0c2456c14d4c42$exports={};Object.defineProperty($e0d0870270a5e570fb0c2456c14d4c42$exports,"__esModule",{value:!0});var $e0d0870270a5e570fb0c2456c14d4c42$export$DataProducer=void 0;$e0d0870270a5e570fb0c2456c14d4c42$exports.DataProducer=$e0d0870270a5e570fb0c2456c14d4c42$export$DataProducer;const $e0d0870270a5e570fb0c2456c14d4c42$var$logger=new $1495c7c2155b511d7a7eba88d183bc8a$exports.Logger("DataProducer");class $e0d0870270a5e570fb0c2456c14d4c42$var$DataProducer extends $233e1f2fffc8d465fe34283eded93370$exports.EnhancedEventEmitter{constructor({id:e,dataChannel:a,sctpStreamParameters:t,appData:r}){super(),this._closed=!1,this._observer=new $233e1f2fffc8d465fe34283eded93370$exports.EnhancedEventEmitter,$e0d0870270a5e570fb0c2456c14d4c42$var$logger.debug("constructor()"),this._id=e,this._dataChannel=a,this._sctpStreamParameters=t,this._appData=r,this._handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||($e0d0870270a5e570fb0c2456c14d4c42$var$logger.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||($e0d0870270a5e570fb0c2456c14d4c42$var$logger.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(e){if($e0d0870270a5e570fb0c2456c14d4c42$var$logger.debug("send()"),this._closed)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError("closed");this._dataChannel.send(e)}_handleDataChannel(){this._dataChannel.addEventListener("open",(()=>{this._closed||($e0d0870270a5e570fb0c2456c14d4c42$var$logger.debug('DataChannel "open" event'),this.safeEmit("open"))})),this._dataChannel.addEventListener("error",(e=>{if(this._closed)return;let{error:a}=e;a||(a=new Error("unknown DataChannel error")),"sctp-failure"===a.errorDetail?$e0d0870270a5e570fb0c2456c14d4c42$var$logger.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",a.sctpCauseCode,a.message):$e0d0870270a5e570fb0c2456c14d4c42$var$logger.error('DataChannel "error" event: %o',a),this.safeEmit("error",a)})),this._dataChannel.addEventListener("close",(()=>{this._closed||($e0d0870270a5e570fb0c2456c14d4c42$var$logger.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"))})),this._dataChannel.addEventListener("message",(()=>{this._closed||$e0d0870270a5e570fb0c2456c14d4c42$var$logger.warn('DataChannel "message" event in a DataProducer, message discarded')})),this._dataChannel.addEventListener("bufferedamountlow",(()=>{this._closed||this.safeEmit("bufferedamountlow")}))}}$e0d0870270a5e570fb0c2456c14d4c42$export$DataProducer=$e0d0870270a5e570fb0c2456c14d4c42$var$DataProducer,$e0d0870270a5e570fb0c2456c14d4c42$exports.DataProducer=$e0d0870270a5e570fb0c2456c14d4c42$export$DataProducer;var $495f846525d246cda6052a324fbd15fe$exports={};Object.defineProperty($495f846525d246cda6052a324fbd15fe$exports,"__esModule",{value:!0});var $495f846525d246cda6052a324fbd15fe$export$DataConsumer=void 0;$495f846525d246cda6052a324fbd15fe$exports.DataConsumer=$495f846525d246cda6052a324fbd15fe$export$DataConsumer;const $495f846525d246cda6052a324fbd15fe$var$logger=new $1495c7c2155b511d7a7eba88d183bc8a$exports.Logger("DataConsumer");class $495f846525d246cda6052a324fbd15fe$var$DataConsumer extends $233e1f2fffc8d465fe34283eded93370$exports.EnhancedEventEmitter{constructor({id:e,dataProducerId:a,dataChannel:t,sctpStreamParameters:r,appData:c}){super(),this._closed=!1,this._observer=new $233e1f2fffc8d465fe34283eded93370$exports.EnhancedEventEmitter,$495f846525d246cda6052a324fbd15fe$var$logger.debug("constructor()"),this._id=e,this._dataProducerId=a,this._dataChannel=t,this._sctpStreamParameters=r,this._appData=c,this._handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||($495f846525d246cda6052a324fbd15fe$var$logger.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||($495f846525d246cda6052a324fbd15fe$var$logger.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}_handleDataChannel(){this._dataChannel.addEventListener("open",(()=>{this._closed||($495f846525d246cda6052a324fbd15fe$var$logger.debug('DataChannel "open" event'),this.safeEmit("open"))})),this._dataChannel.addEventListener("error",(e=>{if(this._closed)return;let{error:a}=e;a||(a=new Error("unknown DataChannel error")),"sctp-failure"===a.errorDetail?$495f846525d246cda6052a324fbd15fe$var$logger.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",a.sctpCauseCode,a.message):$495f846525d246cda6052a324fbd15fe$var$logger.error('DataChannel "error" event: %o',a),this.safeEmit("error",a)})),this._dataChannel.addEventListener("close",(()=>{this._closed||($495f846525d246cda6052a324fbd15fe$var$logger.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"))})),this._dataChannel.addEventListener("message",(e=>{this._closed||this.safeEmit("message",e.data)}))}}$495f846525d246cda6052a324fbd15fe$export$DataConsumer=$495f846525d246cda6052a324fbd15fe$var$DataConsumer,$495f846525d246cda6052a324fbd15fe$exports.DataConsumer=$495f846525d246cda6052a324fbd15fe$export$DataConsumer;const $5f92f7b37da9b8a6f20b18d49540582a$var$logger=new $1495c7c2155b511d7a7eba88d183bc8a$exports.Logger("Transport");class $5f92f7b37da9b8a6f20b18d49540582a$var$Transport extends $233e1f2fffc8d465fe34283eded93370$exports.EnhancedEventEmitter{constructor({direction:e,id:a,iceParameters:t,iceCandidates:r,dtlsParameters:c,sctpParameters:s,iceServers:d,iceTransportPolicy:i,additionalSettings:o,proprietaryConstraints:n,appData:f,handlerFactory:$,extendedRtpCapabilities:b,canProduceByKind:p}){super(),this._closed=!1,this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._dataProducers=new Map,this._dataConsumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new $642d060551a4a60f1693af314145e4c8$exports.AwaitQueue({ClosedErrorClass:$bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError}),this._observer=new $233e1f2fffc8d465fe34283eded93370$exports.EnhancedEventEmitter,$5f92f7b37da9b8a6f20b18d49540582a$var$logger.debug("constructor() [id:%s, direction:%s]",a,e),this._id=a,this._direction=e,this._extendedRtpCapabilities=b,this._canProduceByKind=p,this._maxSctpMessageSize=s?s.maxMessageSize:null,delete(o=$5f92f7b37da9b8a6f20b18d49540582a$var$utils.clone(o,{})).iceServers,delete o.iceTransportPolicy,delete o.bundlePolicy,delete o.rtcpMuxPolicy,delete o.sdpSemantics,this._handler=$(),this._handler.run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:c,sctpParameters:s,iceServers:d,iceTransportPolicy:i,additionalSettings:o,proprietaryConstraints:n,extendedRtpCapabilities:b}),this._appData=f,this._handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(!this._closed){$5f92f7b37da9b8a6f20b18d49540582a$var$logger.debug("close()"),this._closed=!0,this._awaitQueue.close(),this._handler.close();for(const e of this._producers.values())e.transportClosed();this._producers.clear();for(const e of this._consumers.values())e.transportClosed();this._consumers.clear();for(const e of this._dataProducers.values())e.transportClosed();this._dataProducers.clear();for(const e of this._dataConsumers.values())e.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:e}){if($5f92f7b37da9b8a6f20b18d49540582a$var$logger.debug("restartIce()"),this._closed)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError("closed");if(!e)throw new TypeError("missing iceParameters");return this._awaitQueue.push((async()=>this._handler.restartIce(e)),"transport.restartIce()")}async updateIceServers({iceServers:e}={}){if($5f92f7b37da9b8a6f20b18d49540582a$var$logger.debug("updateIceServers()"),this._closed)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError("closed");if(!Array.isArray(e))throw new TypeError("missing iceServers");return this._awaitQueue.push((async()=>this._handler.updateIceServers(e)),"transport.updateIceServers()")}async produce({track:e,encodings:a,codecOptions:t,codec:r,stopTracks:c=!0,disableTrackOnPause:s=!0,zeroRtpOnPause:d=!1,appData:i={}}={}){if($5f92f7b37da9b8a6f20b18d49540582a$var$logger.debug("produce() [track:%o]",e),!e)throw new TypeError("missing track");if("send"!==this._direction)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("not a sending Transport");if(!this._canProduceByKind[e.kind])throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError(`cannot produce ${e.kind}`);if("ended"===e.readyState)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError("track ended");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("produce"))throw new TypeError('no "produce" listener set into this transport');if(i&&"object"!=typeof i)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push((async()=>{let o;if(a&&!Array.isArray(a))throw TypeError("encodings must be an array");a&&0===a.length?o=void 0:a&&(o=a.map((e=>{const a={active:!0};return!1===e.active&&(a.active=!1),"boolean"==typeof e.dtx&&(a.dtx=e.dtx),"string"==typeof e.scalabilityMode&&(a.scalabilityMode=e.scalabilityMode),"number"==typeof e.scaleResolutionDownBy&&(a.scaleResolutionDownBy=e.scaleResolutionDownBy),"number"==typeof e.maxBitrate&&(a.maxBitrate=e.maxBitrate),"number"==typeof e.maxFramerate&&(a.maxFramerate=e.maxFramerate),"boolean"==typeof e.adaptivePtime&&(a.adaptivePtime=e.adaptivePtime),"string"==typeof e.priority&&(a.priority=e.priority),"string"==typeof e.networkPriority&&(a.networkPriority=e.networkPriority),a})));const{localId:n,rtpParameters:f,rtpSender:$}=await this._handler.send({track:e,encodings:o,codecOptions:t,codec:r});try{$5f92f7b37da9b8a6f20b18d49540582a$var$ortc.validateRtpParameters(f);const{id:a}=await this.safeEmitAsPromise("produce",{kind:e.kind,rtpParameters:f,appData:i}),t=new $9bd46aaebdf0dcccd04feef1bfe3f740$exports.Producer({id:a,localId:n,rtpSender:$,track:e,rtpParameters:f,stopTracks:c,disableTrackOnPause:s,zeroRtpOnPause:d,appData:i});return this._producers.set(t.id,t),this._handleProducer(t),this._observer.safeEmit("newproducer",t),t}catch(e){throw this._handler.stopSending(n).catch((()=>{})),e}}),"transport.produce()").catch((a=>{if(c)try{e.stop()}catch(e){}throw a}))}async consume({id:e,producerId:a,kind:t,rtpParameters:r,appData:c={}}){if($5f92f7b37da9b8a6f20b18d49540582a$var$logger.debug("consume()"),r=$5f92f7b37da9b8a6f20b18d49540582a$var$utils.clone(r,void 0),this._closed)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError("closed");if("recv"!==this._direction)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("not a receiving Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof a)throw new TypeError("missing producerId");if("audio"!==t&&"video"!==t)throw new TypeError(`invalid kind '${t}'`);if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(c&&"object"!=typeof c)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push((async()=>{if(!$5f92f7b37da9b8a6f20b18d49540582a$var$ortc.canReceive(r,this._extendedRtpCapabilities))throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("cannot consume this Producer");const{localId:s,rtpReceiver:d,track:i}=await this._handler.receive({trackId:e,kind:t,rtpParameters:r}),o=new $6d860932940735229ce399ee376f25ac$exports.Consumer({id:e,localId:s,producerId:a,rtpReceiver:d,track:i,rtpParameters:r,appData:c});if(this._consumers.set(o.id,o),this._handleConsumer(o),!this._probatorConsumerCreated&&"video"===t)try{const e=$5f92f7b37da9b8a6f20b18d49540582a$var$ortc.generateProbatorRtpParameters(o.rtpParameters);await this._handler.receive({trackId:"probator",kind:"video",rtpParameters:e}),$5f92f7b37da9b8a6f20b18d49540582a$var$logger.debug("consume() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(e){$5f92f7b37da9b8a6f20b18d49540582a$var$logger.error("consume() | failed to create Consumer for RTP probation:%o",e)}return this._observer.safeEmit("newconsumer",o),o}),"transport.consume()")}async produceData({ordered:e=!0,maxPacketLifeTime:a,maxRetransmits:t,priority:r="low",label:c="",protocol:s="",appData:d={}}={}){if($5f92f7b37da9b8a6f20b18d49540582a$var$logger.debug("produceData()"),"send"!==this._direction)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("not a sending Transport");if(!this._maxSctpMessageSize)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("SCTP not enabled by remote Transport");if(!["very-low","low","medium","high"].includes(r))throw new TypeError("wrong priority");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("producedata"))throw new TypeError('no "producedata" listener set into this transport');if(d&&"object"!=typeof d)throw new TypeError("if given, appData must be an object");return(a||t)&&(e=!1),this._awaitQueue.push((async()=>{const{dataChannel:i,sctpStreamParameters:o}=await this._handler.sendDataChannel({ordered:e,maxPacketLifeTime:a,maxRetransmits:t,priority:r,label:c,protocol:s});$5f92f7b37da9b8a6f20b18d49540582a$var$ortc.validateSctpStreamParameters(o);const{id:n}=await this.safeEmitAsPromise("producedata",{sctpStreamParameters:o,label:c,protocol:s,appData:d}),f=new $e0d0870270a5e570fb0c2456c14d4c42$exports.DataProducer({id:n,dataChannel:i,sctpStreamParameters:o,appData:d});return this._dataProducers.set(f.id,f),this._handleDataProducer(f),this._observer.safeEmit("newdataproducer",f),f}),"transport.produceData()")}async consumeData({id:e,dataProducerId:a,sctpStreamParameters:t,label:r="",protocol:c="",appData:s={}}){if($5f92f7b37da9b8a6f20b18d49540582a$var$logger.debug("consumeData()"),t=$5f92f7b37da9b8a6f20b18d49540582a$var$utils.clone(t,void 0),this._closed)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError("closed");if("recv"!==this._direction)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("not a receiving Transport");if(!this._maxSctpMessageSize)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("SCTP not enabled by remote Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof a)throw new TypeError("missing dataProducerId");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(s&&"object"!=typeof s)throw new TypeError("if given, appData must be an object");return $5f92f7b37da9b8a6f20b18d49540582a$var$ortc.validateSctpStreamParameters(t),this._awaitQueue.push((async()=>{const{dataChannel:d}=await this._handler.receiveDataChannel({sctpStreamParameters:t,label:r,protocol:c}),i=new $495f846525d246cda6052a324fbd15fe$exports.DataConsumer({id:e,dataProducerId:a,dataChannel:d,sctpStreamParameters:t,appData:s});return this._dataConsumers.set(i.id,i),this._handleDataConsumer(i),this._observer.safeEmit("newdataconsumer",i),i}),"transport.consumeData()")}_handleHandler(){const e=this._handler;e.on("@connect",(({dtlsParameters:e},a,t)=>{this._closed?t(new $bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError("closed")):this.safeEmit("connect",{dtlsParameters:e},a,t)})),e.on("@connectionstatechange",(e=>{e!==this._connectionState&&($5f92f7b37da9b8a6f20b18d49540582a$var$logger.debug("connection state changed to %s",e),this._connectionState=e,this._closed||this.safeEmit("connectionstatechange",e))}))}_handleProducer(e){e.on("@close",(()=>{this._producers.delete(e.id),this._closed||this._awaitQueue.push((async()=>this._handler.stopSending(e.localId)),"producer @close event").catch((e=>$5f92f7b37da9b8a6f20b18d49540582a$var$logger.warn("producer.close() failed:%o",e)))})),e.on("@replacetrack",((a,t,r)=>{this._awaitQueue.push((async()=>this._handler.replaceTrack(e.localId,a)),"producer @replacetrack event").then(t).catch(r)})),e.on("@setmaxspatiallayer",((a,t,r)=>{this._awaitQueue.push((async()=>this._handler.setMaxSpatialLayer(e.localId,a)),"producer @setmaxspatiallayer event").then(t).catch(r)})),e.on("@setrtpencodingparameters",((a,t,r)=>{this._awaitQueue.push((async()=>this._handler.setRtpEncodingParameters(e.localId,a)),"producer @setrtpencodingparameters event").then(t).catch(r)})),e.on("@getstats",((a,t)=>{if(this._closed)return t(new $bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError("closed"));this._handler.getSenderStats(e.localId).then(a).catch(t)}))}_handleConsumer(e){e.on("@close",(()=>{this._consumers.delete(e.id),this._closed||this._awaitQueue.push((async()=>this._handler.stopReceiving(e.localId)),"consumer @close event").catch((()=>{}))})),e.on("@getstats",((a,t)=>{if(this._closed)return t(new $bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError("closed"));this._handler.getReceiverStats(e.localId).then(a).catch(t)}))}_handleDataProducer(e){e.on("@close",(()=>{this._dataProducers.delete(e.id)}))}_handleDataConsumer(e){e.on("@close",(()=>{this._dataConsumers.delete(e.id)}))}}$5f92f7b37da9b8a6f20b18d49540582a$export$Transport=$5f92f7b37da9b8a6f20b18d49540582a$var$Transport,$5f92f7b37da9b8a6f20b18d49540582a$exports.Transport=$5f92f7b37da9b8a6f20b18d49540582a$export$Transport;var $49246bb5a2f6e045fa681202ab25d3c3$exports={},$49246bb5a2f6e045fa681202ab25d3c3$var$__createBinding=$49246bb5a2f6e045fa681202ab25d3c3$exports&&$49246bb5a2f6e045fa681202ab25d3c3$exports.__createBinding||(Object.create?function(e,a,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,r){void 0===r&&(r=t),e[r]=a[t]}),$49246bb5a2f6e045fa681202ab25d3c3$var$__setModuleDefault=$49246bb5a2f6e045fa681202ab25d3c3$exports&&$49246bb5a2f6e045fa681202ab25d3c3$exports.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),$49246bb5a2f6e045fa681202ab25d3c3$var$__importStar=$49246bb5a2f6e045fa681202ab25d3c3$exports&&$49246bb5a2f6e045fa681202ab25d3c3$exports.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)"default"!==t&&Object.hasOwnProperty.call(e,t)&&$49246bb5a2f6e045fa681202ab25d3c3$var$__createBinding(a,e,t);return $49246bb5a2f6e045fa681202ab25d3c3$var$__setModuleDefault(a,e),a};Object.defineProperty($49246bb5a2f6e045fa681202ab25d3c3$exports,"__esModule",{value:!0});var $49246bb5a2f6e045fa681202ab25d3c3$export$Chrome74=void 0;$49246bb5a2f6e045fa681202ab25d3c3$exports.Chrome74=$49246bb5a2f6e045fa681202ab25d3c3$export$Chrome74;var $b905cbabdece2b7ed3d885dc9ff42ac0$exports={},$2bdf75ad61f2e6f43363e0eab0350802$var$toIntIfInt=function(e){return String(Number(e))===e?Number(e):e},$2bdf75ad61f2e6f43363e0eab0350802$var$attachProperties=function(e,a,t,r){if(r&&!t)a[r]=$2bdf75ad61f2e6f43363e0eab0350802$var$toIntIfInt(e[1]);else for(var c=0;c<t.length;c+=1)null!=e[c+1]&&(a[t[c]]=$2bdf75ad61f2e6f43363e0eab0350802$var$toIntIfInt(e[c+1]))},$2bdf75ad61f2e6f43363e0eab0350802$var$parseReg=function(e,a,t){var r=e.name&&e.names;e.push&&!a[e.push]?a[e.push]=[]:r&&!a[e.name]&&(a[e.name]={});var c=e.push?{}:r?a[e.name]:a;$2bdf75ad61f2e6f43363e0eab0350802$var$attachProperties(t.match(e.reg),c,e.names,e.name),e.push&&a[e.push].push(c)},$5c5078f18a35988ee6d4c1c84831190a$exports={},$5c5078f18a35988ee6d4c1c84831190a$var$grammar=$5c5078f18a35988ee6d4c1c84831190a$exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var a="candidate:%s %d %s %d %s %d typ %s";return a+=null!=e.raddr?" raddr %s rport %d":"%v%v",a+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(a+=" generation %d"),a+=null!=e["network-id"]?" network-id %d":"%v",a+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var a="ssrc:%d";return null!=e.attribute&&(a+=" %s",null!=e.value&&(a+=":%s")),a}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var a="mediaclk:";return a+=null!=e.id?"id=%s %s":"%v%s",a+=null!=e.mediaClockValue?"=%s":"",a+=null!=e.rateNumerator?" rate=%s":"",a+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys($5c5078f18a35988ee6d4c1c84831190a$var$grammar).forEach((function(e){$5c5078f18a35988ee6d4c1c84831190a$var$grammar[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}));var $2bdf75ad61f2e6f43363e0eab0350802$var$grammar=$5c5078f18a35988ee6d4c1c84831190a$exports,$2bdf75ad61f2e6f43363e0eab0350802$var$validLine=RegExp.prototype.test.bind(/^([a-z])=(.*)/),$2bdf75ad61f2e6f43363e0eab0350802$export$parse=function(e){var a={},t=[],r=a;return e.split(/(\r\n|\r|\n)/).filter($2bdf75ad61f2e6f43363e0eab0350802$var$validLine).forEach((function(e){var a=e[0],c=e.slice(2);"m"===a&&(t.push({rtp:[],fmtp:[]}),r=t[t.length-1]);for(var s=0;s<($2bdf75ad61f2e6f43363e0eab0350802$var$grammar[a]||[]).length;s+=1){var d=$2bdf75ad61f2e6f43363e0eab0350802$var$grammar[a][s];if(d.reg.test(c))return $2bdf75ad61f2e6f43363e0eab0350802$var$parseReg(d,r,c)}})),a.media=t,a},$2bdf75ad61f2e6f43363e0eab0350802$var$paramReducer=function(e,a){var t=a.split(/=(.+)/,2);return 2===t.length?e[t[0]]=$2bdf75ad61f2e6f43363e0eab0350802$var$toIntIfInt(t[1]):1===t.length&&a.length>1&&(e[t[0]]=void 0),e},$2bdf75ad61f2e6f43363e0eab0350802$export$parseParams=function(e){return e.split(/;\s?/).reduce($2bdf75ad61f2e6f43363e0eab0350802$var$paramReducer,{})},$2bdf75ad61f2e6f43363e0eab0350802$export$parseFmtpConfig=$2bdf75ad61f2e6f43363e0eab0350802$export$parseParams,$2bdf75ad61f2e6f43363e0eab0350802$export$parsePayloads=function(e){return e.toString().split(" ").map(Number)},$2bdf75ad61f2e6f43363e0eab0350802$export$parseRemoteCandidates=function(e){for(var a=[],t=e.split(" ").map($2bdf75ad61f2e6f43363e0eab0350802$var$toIntIfInt),r=0;r<t.length;r+=3)a.push({component:t[r],ip:t[r+1],port:t[r+2]});return a},$2bdf75ad61f2e6f43363e0eab0350802$export$parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce($2bdf75ad61f2e6f43363e0eab0350802$var$paramReducer,{})}))},$2bdf75ad61f2e6f43363e0eab0350802$export$parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var a,t=!1;return"~"!==e[0]?a=$2bdf75ad61f2e6f43363e0eab0350802$var$toIntIfInt(e):(a=$2bdf75ad61f2e6f43363e0eab0350802$var$toIntIfInt(e.substring(1,e.length)),t=!0),{scid:a,paused:t}}))}))},$24de56d2b8f31e4627f09d659fff03d7$exports={},$24de56d2b8f31e4627f09d659fff03d7$var$grammar=$5c5078f18a35988ee6d4c1c84831190a$exports,$24de56d2b8f31e4627f09d659fff03d7$var$formatRegExp=/%[sdv%]/g,$24de56d2b8f31e4627f09d659fff03d7$var$format=function(e){var a=1,t=arguments,r=t.length;return e.replace($24de56d2b8f31e4627f09d659fff03d7$var$formatRegExp,(function(e){if(a>=r)return e;var c=t[a];switch(a+=1,e){case"%%":return"%";case"%s":return String(c);case"%d":return Number(c);case"%v":return""}}))},$24de56d2b8f31e4627f09d659fff03d7$var$makeLine=function(e,a,t){var r=[e+"="+(a.format instanceof Function?a.format(a.push?t:t[a.name]):a.format)];if(a.names)for(var c=0;c<a.names.length;c+=1){var s=a.names[c];a.name?r.push(t[a.name][s]):r.push(t[a.names[c]])}else r.push(t[a.name]);return $24de56d2b8f31e4627f09d659fff03d7$var$format.apply(null,r)},$24de56d2b8f31e4627f09d659fff03d7$var$defaultOuterOrder=["v","o","s","i","u","e","p","c","b","t","r","z","a"],$24de56d2b8f31e4627f09d659fff03d7$var$defaultInnerOrder=["i","c","b","a"];$24de56d2b8f31e4627f09d659fff03d7$exports=function(e,a){a=a||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var t=a.outerOrder||$24de56d2b8f31e4627f09d659fff03d7$var$defaultOuterOrder,r=a.innerOrder||$24de56d2b8f31e4627f09d659fff03d7$var$defaultInnerOrder,c=[];return t.forEach((function(a){$24de56d2b8f31e4627f09d659fff03d7$var$grammar[a].forEach((function(t){t.name in e&&null!=e[t.name]?c.push($24de56d2b8f31e4627f09d659fff03d7$var$makeLine(a,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach((function(e){c.push($24de56d2b8f31e4627f09d659fff03d7$var$makeLine(a,t,e))}))}))})),e.media.forEach((function(e){c.push($24de56d2b8f31e4627f09d659fff03d7$var$makeLine("m",$24de56d2b8f31e4627f09d659fff03d7$var$grammar.m[0],e)),r.forEach((function(a){$24de56d2b8f31e4627f09d659fff03d7$var$grammar[a].forEach((function(t){t.name in e&&null!=e[t.name]?c.push($24de56d2b8f31e4627f09d659fff03d7$var$makeLine(a,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach((function(e){c.push($24de56d2b8f31e4627f09d659fff03d7$var$makeLine(a,t,e))}))}))}))})),c.join("\r\n")+"\r\n"};var $b905cbabdece2b7ed3d885dc9ff42ac0$var$writer=$24de56d2b8f31e4627f09d659fff03d7$exports,$b905cbabdece2b7ed3d885dc9ff42ac0$export$write=$b905cbabdece2b7ed3d885dc9ff42ac0$var$writer;$b905cbabdece2b7ed3d885dc9ff42ac0$exports.write=$b905cbabdece2b7ed3d885dc9ff42ac0$export$write;var $b905cbabdece2b7ed3d885dc9ff42ac0$export$parse=$2bdf75ad61f2e6f43363e0eab0350802$export$parse;$b905cbabdece2b7ed3d885dc9ff42ac0$exports.parse=$b905cbabdece2b7ed3d885dc9ff42ac0$export$parse;var $b905cbabdece2b7ed3d885dc9ff42ac0$export$parseParams=$2bdf75ad61f2e6f43363e0eab0350802$export$parseParams;$b905cbabdece2b7ed3d885dc9ff42ac0$exports.parseParams=$b905cbabdece2b7ed3d885dc9ff42ac0$export$parseParams;var $b905cbabdece2b7ed3d885dc9ff42ac0$export$parseFmtpConfig=$2bdf75ad61f2e6f43363e0eab0350802$export$parseFmtpConfig;$b905cbabdece2b7ed3d885dc9ff42ac0$exports.parseFmtpConfig=$b905cbabdece2b7ed3d885dc9ff42ac0$export$parseFmtpConfig;var $b905cbabdece2b7ed3d885dc9ff42ac0$export$parsePayloads=$2bdf75ad61f2e6f43363e0eab0350802$export$parsePayloads;$b905cbabdece2b7ed3d885dc9ff42ac0$exports.parsePayloads=$b905cbabdece2b7ed3d885dc9ff42ac0$export$parsePayloads;var $b905cbabdece2b7ed3d885dc9ff42ac0$export$parseRemoteCandidates=$2bdf75ad61f2e6f43363e0eab0350802$export$parseRemoteCandidates;$b905cbabdece2b7ed3d885dc9ff42ac0$exports.parseRemoteCandidates=$b905cbabdece2b7ed3d885dc9ff42ac0$export$parseRemoteCandidates;var $b905cbabdece2b7ed3d885dc9ff42ac0$export$parseImageAttributes=$2bdf75ad61f2e6f43363e0eab0350802$export$parseImageAttributes;$b905cbabdece2b7ed3d885dc9ff42ac0$exports.parseImageAttributes=$b905cbabdece2b7ed3d885dc9ff42ac0$export$parseImageAttributes;var $b905cbabdece2b7ed3d885dc9ff42ac0$export$parseSimulcastStreamList=$2bdf75ad61f2e6f43363e0eab0350802$export$parseSimulcastStreamList;$b905cbabdece2b7ed3d885dc9ff42ac0$exports.parseSimulcastStreamList=$b905cbabdece2b7ed3d885dc9ff42ac0$export$parseSimulcastStreamList;const $49246bb5a2f6e045fa681202ab25d3c3$var$sdpTransform=$49246bb5a2f6e045fa681202ab25d3c3$var$__importStar($b905cbabdece2b7ed3d885dc9ff42ac0$exports),$49246bb5a2f6e045fa681202ab25d3c3$var$utils=$49246bb5a2f6e045fa681202ab25d3c3$var$__importStar($6abc7ab33e1327c2d411a5fc6b37fe23$exports),$49246bb5a2f6e045fa681202ab25d3c3$var$ortc=$49246bb5a2f6e045fa681202ab25d3c3$var$__importStar($c14b343179c41479c8bdeecb64f7be76$exports);var $d52929f92c17dce5cc60b70ec647fedb$exports={},$d52929f92c17dce5cc60b70ec647fedb$var$__createBinding=$d52929f92c17dce5cc60b70ec647fedb$exports&&$d52929f92c17dce5cc60b70ec647fedb$exports.__createBinding||(Object.create?function(e,a,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,r){void 0===r&&(r=t),e[r]=a[t]}),$d52929f92c17dce5cc60b70ec647fedb$var$__setModuleDefault=$d52929f92c17dce5cc60b70ec647fedb$exports&&$d52929f92c17dce5cc60b70ec647fedb$exports.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),$d52929f92c17dce5cc60b70ec647fedb$var$__importStar=$d52929f92c17dce5cc60b70ec647fedb$exports&&$d52929f92c17dce5cc60b70ec647fedb$exports.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)"default"!==t&&Object.hasOwnProperty.call(e,t)&&$d52929f92c17dce5cc60b70ec647fedb$var$__createBinding(a,e,t);return $d52929f92c17dce5cc60b70ec647fedb$var$__setModuleDefault(a,e),a};Object.defineProperty($d52929f92c17dce5cc60b70ec647fedb$exports,"__esModule",{value:!0});var $d52929f92c17dce5cc60b70ec647fedb$export$applyCodecParameters=($d52929f92c17dce5cc60b70ec647fedb$export$extractRtpCapabilities=void 0,$d52929f92c17dce5cc60b70ec647fedb$export$extractDtlsParameters=$d52929f92c17dce5cc60b70ec647fedb$exports.extractRtpCapabilities=$d52929f92c17dce5cc60b70ec647fedb$export$extractRtpCapabilities,$d52929f92c17dce5cc60b70ec647fedb$export$getCname=$d52929f92c17dce5cc60b70ec647fedb$exports.extractDtlsParameters=$d52929f92c17dce5cc60b70ec647fedb$export$extractDtlsParameters,$d52929f92c17dce5cc60b70ec647fedb$exports.getCname=$d52929f92c17dce5cc60b70ec647fedb$export$getCname);$d52929f92c17dce5cc60b70ec647fedb$exports.applyCodecParameters=$d52929f92c17dce5cc60b70ec647fedb$export$applyCodecParameters;const $d52929f92c17dce5cc60b70ec647fedb$var$sdpTransform=$d52929f92c17dce5cc60b70ec647fedb$var$__importStar($b905cbabdece2b7ed3d885dc9ff42ac0$exports);function $d52929f92c17dce5cc60b70ec647fedb$var$extractRtpCapabilities({sdpObject:e}){const a=new Map,t=[];let r=!1,c=!1;for(const s of e.media){const e=s.type;switch(e){case"audio":if(r)continue;r=!0;break;case"video":if(c)continue;c=!0;break;default:continue}for(const t of s.rtp){const r={kind:e,mimeType:`${e}/${t.codec}`,preferredPayloadType:t.payload,clockRate:t.rate,channels:t.encoding,parameters:{},rtcpFeedback:[]};a.set(r.preferredPayloadType,r)}for(const e of s.fmtp||[]){const t=$d52929f92c17dce5cc60b70ec647fedb$var$sdpTransform.parseParams(e.config),r=a.get(e.payload);r&&(t&&t["profile-level-id"]&&(t["profile-level-id"]=String(t["profile-level-id"])),r.parameters=t)}for(const e of s.rtcpFb||[]){const t=a.get(e.payload);if(!t)continue;const r={type:e.type,parameter:e.subtype};r.parameter||delete r.parameter,t.rtcpFeedback.push(r)}for(const a of s.ext||[]){if(a["encrypt-uri"])continue;const r={kind:e,uri:a.uri,preferredId:a.value};t.push(r)}}return{codecs:Array.from(a.values()),headerExtensions:t}}var $d52929f92c17dce5cc60b70ec647fedb$export$extractRtpCapabilities=$d52929f92c17dce5cc60b70ec647fedb$var$extractRtpCapabilities;function $d52929f92c17dce5cc60b70ec647fedb$var$extractDtlsParameters({sdpObject:e}){const a=(e.media||[]).find((e=>e.iceUfrag&&0!==e.port));if(!a)throw new Error("no active media section found");const t=a.fingerprint||e.fingerprint;let r;switch(a.setup){case"active":r="client";break;case"passive":r="server";break;case"actpass":r="auto"}return{role:r,fingerprints:[{algorithm:t.type,value:t.hash}]}}$d52929f92c17dce5cc60b70ec647fedb$exports.extractRtpCapabilities=$d52929f92c17dce5cc60b70ec647fedb$export$extractRtpCapabilities;var $d52929f92c17dce5cc60b70ec647fedb$export$extractDtlsParameters=$d52929f92c17dce5cc60b70ec647fedb$var$extractDtlsParameters;function $d52929f92c17dce5cc60b70ec647fedb$var$getCname({offerMediaObject:e}){const a=(e.ssrcs||[]).find((e=>"cname"===e.attribute));return a?a.value:""}$d52929f92c17dce5cc60b70ec647fedb$exports.extractDtlsParameters=$d52929f92c17dce5cc60b70ec647fedb$export$extractDtlsParameters;var $d52929f92c17dce5cc60b70ec647fedb$export$getCname=$d52929f92c17dce5cc60b70ec647fedb$var$getCname;function $d52929f92c17dce5cc60b70ec647fedb$var$applyCodecParameters({offerRtpParameters:e,answerMediaObject:a}){for(const t of e.codecs){const e=t.mimeType.toLowerCase();if("audio/opus"!==e)continue;if(!(a.rtp||[]).find((e=>e.payload===t.payloadType)))continue;a.fmtp=a.fmtp||[];let r=a.fmtp.find((e=>e.payload===t.payloadType));r||(r={payload:t.payloadType,config:""},a.fmtp.push(r));const c=$d52929f92c17dce5cc60b70ec647fedb$var$sdpTransform.parseParams(r.config);switch(e){case"audio/opus":{const e=t.parameters["sprop-stereo"];void 0!==e&&(c.stereo=e?1:0);break}}r.config="";for(const e of Object.keys(c))r.config&&(r.config+=";"),r.config+=`${e}=${c[e]}`}}$d52929f92c17dce5cc60b70ec647fedb$exports.getCname=$d52929f92c17dce5cc60b70ec647fedb$export$getCname,$d52929f92c17dce5cc60b70ec647fedb$export$applyCodecParameters=$d52929f92c17dce5cc60b70ec647fedb$var$applyCodecParameters,$d52929f92c17dce5cc60b70ec647fedb$exports.applyCodecParameters=$d52929f92c17dce5cc60b70ec647fedb$export$applyCodecParameters;const $49246bb5a2f6e045fa681202ab25d3c3$var$sdpCommonUtils=$49246bb5a2f6e045fa681202ab25d3c3$var$__importStar($d52929f92c17dce5cc60b70ec647fedb$exports);var $9ea9aaf7fac84dd2d2be874016e3619c$exports={};Object.defineProperty($9ea9aaf7fac84dd2d2be874016e3619c$exports,"__esModule",{value:!0});var $9ea9aaf7fac84dd2d2be874016e3619c$export$addLegacySimulcast=($9ea9aaf7fac84dd2d2be874016e3619c$export$getRtpEncodings=void 0,$9ea9aaf7fac84dd2d2be874016e3619c$exports.getRtpEncodings=$9ea9aaf7fac84dd2d2be874016e3619c$export$getRtpEncodings);function $9ea9aaf7fac84dd2d2be874016e3619c$var$getRtpEncodings({offerMediaObject:e}){const a=new Set;for(const t of e.ssrcs||[]){const e=t.id;a.add(e)}if(0===a.size)throw new Error("no a=ssrc lines found");const t=new Map;for(const r of e.ssrcGroups||[]){if("FID"!==r.semantics)continue;let[e,c]=r.ssrcs.split(/\s+/);e=Number(e),c=Number(c),a.has(e)&&(a.delete(e),a.delete(c),t.set(e,c))}for(const e of a)t.set(e,null);const r=[];for(const[e,a]of t){const t={ssrc:e};a&&(t.rtx={ssrc:a}),r.push(t)}return r}$9ea9aaf7fac84dd2d2be874016e3619c$exports.addLegacySimulcast=$9ea9aaf7fac84dd2d2be874016e3619c$export$addLegacySimulcast;var $9ea9aaf7fac84dd2d2be874016e3619c$export$getRtpEncodings=$9ea9aaf7fac84dd2d2be874016e3619c$var$getRtpEncodings;function $9ea9aaf7fac84dd2d2be874016e3619c$var$addLegacySimulcast({offerMediaObject:e,numStreams:a}){if(a<=1)throw new TypeError("numStreams must be greater than 1");const t=(e.ssrcs||[]).find((e=>"msid"===e.attribute));if(!t)throw new Error("a=ssrc line with msid information not found");const[r,c]=t.value.split(" ")[0],s=t.id;let d;(e.ssrcGroups||[]).some((e=>{if("FID"!==e.semantics)return!1;const a=e.ssrcs.split(/\s+/);return Number(a[0])===s&&(d=Number(a[1]),!0)}));const i=e.ssrcs.find((e=>"cname"===e.attribute));if(!i)throw new Error("a=ssrc line with cname information not found");const o=i.value,n=[],f=[];for(let e=0;e<a;++e)n.push(s+e),d&&f.push(d+e);e.ssrcGroups=[],e.ssrcs=[],e.ssrcGroups.push({semantics:"SIM",ssrcs:n.join(" ")});for(let a=0;a<n.length;++a){const t=n[a];e.ssrcs.push({id:t,attribute:"cname",value:o}),e.ssrcs.push({id:t,attribute:"msid",value:`${r} ${c}`})}for(let a=0;a<f.length;++a){const t=n[a],s=f[a];e.ssrcs.push({id:s,attribute:"cname",value:o}),e.ssrcs.push({id:s,attribute:"msid",value:`${r} ${c}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${t} ${s}`})}}$9ea9aaf7fac84dd2d2be874016e3619c$exports.getRtpEncodings=$9ea9aaf7fac84dd2d2be874016e3619c$export$getRtpEncodings,$9ea9aaf7fac84dd2d2be874016e3619c$export$addLegacySimulcast=$9ea9aaf7fac84dd2d2be874016e3619c$var$addLegacySimulcast,$9ea9aaf7fac84dd2d2be874016e3619c$exports.addLegacySimulcast=$9ea9aaf7fac84dd2d2be874016e3619c$export$addLegacySimulcast;const $49246bb5a2f6e045fa681202ab25d3c3$var$sdpUnifiedPlanUtils=$49246bb5a2f6e045fa681202ab25d3c3$var$__importStar($9ea9aaf7fac84dd2d2be874016e3619c$exports);var $cc0c0c04507cca8137231b297300d331$exports={};Object.defineProperty($cc0c0c04507cca8137231b297300d331$exports,"__esModule",{value:!0});var $cc0c0c04507cca8137231b297300d331$export$HandlerInterface=void 0;$cc0c0c04507cca8137231b297300d331$exports.HandlerInterface=$cc0c0c04507cca8137231b297300d331$export$HandlerInterface;class $cc0c0c04507cca8137231b297300d331$var$HandlerInterface extends $233e1f2fffc8d465fe34283eded93370$exports.EnhancedEventEmitter{constructor(){super()}}$cc0c0c04507cca8137231b297300d331$export$HandlerInterface=$cc0c0c04507cca8137231b297300d331$var$HandlerInterface,$cc0c0c04507cca8137231b297300d331$exports.HandlerInterface=$cc0c0c04507cca8137231b297300d331$export$HandlerInterface;var $2aa38523a6b418a7db72b14d2d309ee6$exports={},$2aa38523a6b418a7db72b14d2d309ee6$var$__createBinding=$2aa38523a6b418a7db72b14d2d309ee6$exports&&$2aa38523a6b418a7db72b14d2d309ee6$exports.__createBinding||(Object.create?function(e,a,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,r){void 0===r&&(r=t),e[r]=a[t]}),$2aa38523a6b418a7db72b14d2d309ee6$var$__setModuleDefault=$2aa38523a6b418a7db72b14d2d309ee6$exports&&$2aa38523a6b418a7db72b14d2d309ee6$exports.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),$2aa38523a6b418a7db72b14d2d309ee6$var$__importStar=$2aa38523a6b418a7db72b14d2d309ee6$exports&&$2aa38523a6b418a7db72b14d2d309ee6$exports.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)"default"!==t&&Object.hasOwnProperty.call(e,t)&&$2aa38523a6b418a7db72b14d2d309ee6$var$__createBinding(a,e,t);return $2aa38523a6b418a7db72b14d2d309ee6$var$__setModuleDefault(a,e),a};Object.defineProperty($2aa38523a6b418a7db72b14d2d309ee6$exports,"__esModule",{value:!0});var $2aa38523a6b418a7db72b14d2d309ee6$export$RemoteSdp=void 0;$2aa38523a6b418a7db72b14d2d309ee6$exports.RemoteSdp=$2aa38523a6b418a7db72b14d2d309ee6$export$RemoteSdp;const $2aa38523a6b418a7db72b14d2d309ee6$var$sdpTransform=$2aa38523a6b418a7db72b14d2d309ee6$var$__importStar($b905cbabdece2b7ed3d885dc9ff42ac0$exports);var $afdfe18d22c4ce02d7172efbb9ee8081$exports={},$afdfe18d22c4ce02d7172efbb9ee8081$var$__createBinding=$afdfe18d22c4ce02d7172efbb9ee8081$exports&&$afdfe18d22c4ce02d7172efbb9ee8081$exports.__createBinding||(Object.create?function(e,a,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,r){void 0===r&&(r=t),e[r]=a[t]}),$afdfe18d22c4ce02d7172efbb9ee8081$var$__setModuleDefault=$afdfe18d22c4ce02d7172efbb9ee8081$exports&&$afdfe18d22c4ce02d7172efbb9ee8081$exports.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),$afdfe18d22c4ce02d7172efbb9ee8081$var$__importStar=$afdfe18d22c4ce02d7172efbb9ee8081$exports&&$afdfe18d22c4ce02d7172efbb9ee8081$exports.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)"default"!==t&&Object.hasOwnProperty.call(e,t)&&$afdfe18d22c4ce02d7172efbb9ee8081$var$__createBinding(a,e,t);return $afdfe18d22c4ce02d7172efbb9ee8081$var$__setModuleDefault(a,e),a};Object.defineProperty($afdfe18d22c4ce02d7172efbb9ee8081$exports,"__esModule",{value:!0});var $afdfe18d22c4ce02d7172efbb9ee8081$export$OfferMediaSection=($afdfe18d22c4ce02d7172efbb9ee8081$export$MediaSection=void 0,$afdfe18d22c4ce02d7172efbb9ee8081$export$AnswerMediaSection=$afdfe18d22c4ce02d7172efbb9ee8081$exports.MediaSection=$afdfe18d22c4ce02d7172efbb9ee8081$export$MediaSection,$afdfe18d22c4ce02d7172efbb9ee8081$exports.AnswerMediaSection=$afdfe18d22c4ce02d7172efbb9ee8081$export$AnswerMediaSection);$afdfe18d22c4ce02d7172efbb9ee8081$exports.OfferMediaSection=$afdfe18d22c4ce02d7172efbb9ee8081$export$OfferMediaSection;const $afdfe18d22c4ce02d7172efbb9ee8081$var$utils=$afdfe18d22c4ce02d7172efbb9ee8081$var$__importStar($6abc7ab33e1327c2d411a5fc6b37fe23$exports);class $afdfe18d22c4ce02d7172efbb9ee8081$var$MediaSection{constructor({iceParameters:e,iceCandidates:a,dtlsParameters:t,planB:r=!1}){if(this._mediaObject={},this._planB=r,e&&this.setIceParameters(e),a){this._mediaObject.candidates=[];for(const e of a){const a={component:1};a.foundation=e.foundation,a.ip=e.ip,a.port=e.port,a.priority=e.priority,a.transport=e.protocol,a.type=e.type,e.tcpType&&(a.tcptype=e.tcpType),this._mediaObject.candidates.push(a)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}t&&this.setDtlsRole(t.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return 0===this._mediaObject.port}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}disable(){this._mediaObject.direction="inactive",delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids}close(){this._mediaObject.direction="inactive",this._mediaObject.port=0,delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}}var $afdfe18d22c4ce02d7172efbb9ee8081$export$MediaSection=$afdfe18d22c4ce02d7172efbb9ee8081$var$MediaSection;$afdfe18d22c4ce02d7172efbb9ee8081$exports.MediaSection=$afdfe18d22c4ce02d7172efbb9ee8081$export$MediaSection;class $afdfe18d22c4ce02d7172efbb9ee8081$var$AnswerMediaSection extends $afdfe18d22c4ce02d7172efbb9ee8081$var$MediaSection{constructor({iceParameters:e,iceCandidates:a,dtlsParameters:t,sctpParameters:r,plainRtpParameters:c,planB:s=!1,offerMediaObject:d,offerRtpParameters:i,answerRtpParameters:o,codecOptions:n,extmapAllowMixed:f=!1}){switch(super({iceParameters:e,iceCandidates:a,dtlsParameters:t,planB:s}),this._mediaObject.mid=String(d.mid),this._mediaObject.type=d.type,this._mediaObject.protocol=d.protocol,c?(this._mediaObject.connection={ip:c.ip,version:c.ipVersion},this._mediaObject.port=c.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),d.type){case"audio":case"video":this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const e of o.codecs){const a={payload:e.payloadType,codec:$afdfe18d22c4ce02d7172efbb9ee8081$var$getCodecName(e),rate:e.clockRate};e.channels>1&&(a.encoding=e.channels),this._mediaObject.rtp.push(a);const t=$afdfe18d22c4ce02d7172efbb9ee8081$var$utils.clone(e.parameters,{});if(n){const{opusStereo:a,opusFec:r,opusDtx:c,opusMaxPlaybackRate:s,opusMaxAverageBitrate:d,opusPtime:o,videoGoogleStartBitrate:f,videoGoogleMaxBitrate:$,videoGoogleMinBitrate:b}=n,p=i.codecs.find((a=>a.payloadType===e.payloadType));switch(e.mimeType.toLowerCase()){case"audio/opus":void 0!==a&&(p.parameters["sprop-stereo"]=a?1:0,t.stereo=a?1:0),void 0!==r&&(p.parameters.useinbandfec=r?1:0,t.useinbandfec=r?1:0),void 0!==c&&(p.parameters.usedtx=c?1:0,t.usedtx=c?1:0),void 0!==s&&(t.maxplaybackrate=s),void 0!==d&&(t.maxaveragebitrate=d),void 0!==o&&(p.parameters.ptime=o,t.ptime=o);break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":void 0!==f&&(t["x-google-start-bitrate"]=f),void 0!==$&&(t["x-google-max-bitrate"]=$),void 0!==b&&(t["x-google-min-bitrate"]=b)}}const r={payload:e.payloadType,config:""};for(const e of Object.keys(t))r.config&&(r.config+=";"),r.config+=`${e}=${t[e]}`;r.config&&this._mediaObject.fmtp.push(r);for(const a of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:a.type,subtype:a.parameter})}this._mediaObject.payloads=o.codecs.map((e=>e.payloadType)).join(" "),this._mediaObject.ext=[];for(const e of o.headerExtensions){(d.ext||[]).some((a=>a.uri===e.uri))&&this._mediaObject.ext.push({uri:e.uri,value:e.id})}if(f&&"extmap-allow-mixed"===d.extmapAllowMixed&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),d.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:d.simulcast.list1},this._mediaObject.rids=[];for(const e of d.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}else if(d.simulcast_03){this._mediaObject.simulcast_03={value:d.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const e of d.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&"video"===this._mediaObject.type&&(this._mediaObject.xGoogleFlag="conference");break;case"application":"number"==typeof d.sctpPort?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=r.port,this._mediaObject.maxMessageSize=r.maxMessageSize):d.sctpmap&&(this._mediaObject.payloads=r.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:r.port,maxMessageSize:r.maxMessageSize})}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}}var $afdfe18d22c4ce02d7172efbb9ee8081$export$AnswerMediaSection=$afdfe18d22c4ce02d7172efbb9ee8081$var$AnswerMediaSection;$afdfe18d22c4ce02d7172efbb9ee8081$exports.AnswerMediaSection=$afdfe18d22c4ce02d7172efbb9ee8081$export$AnswerMediaSection;class $afdfe18d22c4ce02d7172efbb9ee8081$var$OfferMediaSection extends $afdfe18d22c4ce02d7172efbb9ee8081$var$MediaSection{constructor({iceParameters:e,iceCandidates:a,dtlsParameters:t,sctpParameters:r,plainRtpParameters:c,planB:s=!1,mid:d,kind:i,offerRtpParameters:o,streamId:n,trackId:f,oldDataChannelSpec:$=!1}){switch(super({iceParameters:e,iceCandidates:a,dtlsParameters:t,planB:s}),this._mediaObject.mid=String(d),this._mediaObject.type=i,c?(this._mediaObject.connection={ip:c.ip,version:c.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=c.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.protocol=r?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),i){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${n||"-"} ${f}`);for(const e of o.codecs){const a={payload:e.payloadType,codec:$afdfe18d22c4ce02d7172efbb9ee8081$var$getCodecName(e),rate:e.clockRate};e.channels>1&&(a.encoding=e.channels),this._mediaObject.rtp.push(a);const t={payload:e.payloadType,config:""};for(const a of Object.keys(e.parameters))t.config&&(t.config+=";"),t.config+=`${a}=${e.parameters[a]}`;t.config&&this._mediaObject.fmtp.push(t);for(const a of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:a.type,subtype:a.parameter})}this._mediaObject.payloads=o.codecs.map((e=>e.payloadType)).join(" "),this._mediaObject.ext=[];for(const e of o.headerExtensions)this._mediaObject.ext.push({uri:e.uri,value:e.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const e=o.encodings[0],a=e.ssrc,t=e.rtx&&e.rtx.ssrc?e.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],o.rtcp.cname&&this._mediaObject.ssrcs.push({id:a,attribute:"cname",value:o.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:a,attribute:"msid",value:`${n||"-"} ${f}`}),t&&(o.rtcp.cname&&this._mediaObject.ssrcs.push({id:t,attribute:"cname",value:o.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:t,attribute:"msid",value:`${n||"-"} ${f}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${a} ${t}`}));break}case"application":$?(this._mediaObject.payloads=r.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:r.port,maxMessageSize:r.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=r.port,this._mediaObject.maxMessageSize=r.maxMessageSize)}}setDtlsRole(e){this._mediaObject.setup="actpass"}planBReceive({offerRtpParameters:e,streamId:a,trackId:t}){const r=e.encodings[0],c=r.ssrc,s=r.rtx&&r.rtx.ssrc?r.rtx.ssrc:void 0;e.rtcp.cname&&this._mediaObject.ssrcs.push({id:c,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:c,attribute:"msid",value:`${a||"-"} ${t}`}),s&&(e.rtcp.cname&&this._mediaObject.ssrcs.push({id:s,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:s,attribute:"msid",value:`${a||"-"} ${t}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${c} ${s}`}))}planBStopReceiving({offerRtpParameters:e}){const a=e.encodings[0],t=a.ssrc,r=a.rtx&&a.rtx.ssrc?a.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter((e=>e.id!==t&&e.id!==r)),r&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter((e=>e.ssrcs!==`${t} ${r}`)))}}function $afdfe18d22c4ce02d7172efbb9ee8081$var$getCodecName(e){const a=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!a)throw new TypeError("invalid codec.mimeType");return a[2]}$afdfe18d22c4ce02d7172efbb9ee8081$export$OfferMediaSection=$afdfe18d22c4ce02d7172efbb9ee8081$var$OfferMediaSection,$afdfe18d22c4ce02d7172efbb9ee8081$exports.OfferMediaSection=$afdfe18d22c4ce02d7172efbb9ee8081$export$OfferMediaSection;const $2aa38523a6b418a7db72b14d2d309ee6$var$logger=new $1495c7c2155b511d7a7eba88d183bc8a$exports.Logger("RemoteSdp");class $2aa38523a6b418a7db72b14d2d309ee6$var$RemoteSdp{constructor({iceParameters:e,iceCandidates:a,dtlsParameters:t,sctpParameters:r,plainRtpParameters:c,planB:s=!1}){if(this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=e,this._iceCandidates=a,this._dtlsParameters=t,this._sctpParameters=r,this._plainRtpParameters=c,this._planB=s,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},e&&e.iceLite&&(this._sdpObject.icelite="ice-lite"),t){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const e=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:t.fingerprints[e-1].algorithm,hash:t.fingerprints[e-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}c&&(this._sdpObject.origin.address=c.ip,this._sdpObject.origin.ipVer=c.ipVersion)}updateIceParameters(e){$2aa38523a6b418a7db72b14d2d309ee6$var$logger.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;for(const a of this._mediaSections)a.setIceParameters(e)}updateDtlsRole(e){$2aa38523a6b418a7db72b14d2d309ee6$var$logger.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;for(const a of this._mediaSections)a.setDtlsRole(e)}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){const a=this._mediaSections[e];if(a.closed)return{idx:e,reuseMid:a.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:e,reuseMid:a,offerRtpParameters:t,answerRtpParameters:r,codecOptions:c,extmapAllowMixed:s=!1}){const d=new $afdfe18d22c4ce02d7172efbb9ee8081$exports.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:t,answerRtpParameters:r,codecOptions:c,extmapAllowMixed:s});a?this._replaceMediaSection(d,a):this._midToIndex.has(d.mid)?this._replaceMediaSection(d):this._addMediaSection(d)}receive({mid:e,kind:a,offerRtpParameters:t,streamId:r,trackId:c}){const s=this._midToIndex.get(e);let d;if(void 0!==s&&(d=this._mediaSections[s]),d)d.planBReceive({offerRtpParameters:t,streamId:r,trackId:c}),this._replaceMediaSection(d);else{d=new $afdfe18d22c4ce02d7172efbb9ee8081$exports.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:a,offerRtpParameters:t,streamId:r,trackId:c});const s=this._mediaSections.find((e=>e.closed));s?this._replaceMediaSection(d,s.mid):this._addMediaSection(d)}}disableMediaSection(e){const a=this._midToIndex.get(e);if(void 0===a)throw new Error(`no media section found with mid '${e}'`);this._mediaSections[a].disable()}closeMediaSection(e){const a=this._midToIndex.get(e);if(void 0===a)throw new Error(`no media section found with mid '${e}'`);const t=this._mediaSections[a];if(e===this._firstMid)return $2aa38523a6b418a7db72b14d2d309ee6$var$logger.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),void this.disableMediaSection(e);t.close(),this._regenerateBundleMids()}planBStopReceiving({mid:e,offerRtpParameters:a}){const t=this._midToIndex.get(e);if(void 0===t)throw new Error(`no media section found with mid '${e}'`);const r=this._mediaSections[t];r.planBStopReceiving({offerRtpParameters:a}),this._replaceMediaSection(r)}sendSctpAssociation({offerMediaObject:e}){const a=new $afdfe18d22c4ce02d7172efbb9ee8081$exports.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(a)}receiveSctpAssociation({oldDataChannelSpec:e=!1}={}){const a=new $afdfe18d22c4ce02d7172efbb9ee8081$exports.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(a)}getSdp(){return this._sdpObject.origin.sessionVersion++,$2aa38523a6b418a7db72b14d2d309ee6$var$sdpTransform.write(this._sdpObject)}_addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}_replaceMediaSection(e,a){if("string"==typeof a){const t=this._midToIndex.get(a);if(void 0===t)throw new Error(`no media section found for reuseMid '${a}'`);const r=this._mediaSections[t];this._mediaSections[t]=e,this._midToIndex.delete(r.mid),this._midToIndex.set(e.mid,t),this._sdpObject.media[t]=e.getObject(),this._regenerateBundleMids()}else{const a=this._midToIndex.get(e.mid);if(void 0===a)throw new Error(`no media section found with mid '${e.mid}'`);this._mediaSections[a]=e,this._sdpObject.media[a]=e.getObject()}}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter((e=>!e.closed)).map((e=>e.mid)).join(" "))}}$2aa38523a6b418a7db72b14d2d309ee6$export$RemoteSdp=$2aa38523a6b418a7db72b14d2d309ee6$var$RemoteSdp,$2aa38523a6b418a7db72b14d2d309ee6$exports.RemoteSdp=$2aa38523a6b418a7db72b14d2d309ee6$export$RemoteSdp;var $991a06b940351aa492c8a67e5b288aa6$exports={};Object.defineProperty($991a06b940351aa492c8a67e5b288aa6$exports,"__esModule",{value:!0});var $991a06b940351aa492c8a67e5b288aa6$export$parse=void 0;$991a06b940351aa492c8a67e5b288aa6$exports.parse=$991a06b940351aa492c8a67e5b288aa6$export$parse;const $991a06b940351aa492c8a67e5b288aa6$var$ScalabilityModeRegex=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function $991a06b940351aa492c8a67e5b288aa6$var$parse(e){const a=$991a06b940351aa492c8a67e5b288aa6$var$ScalabilityModeRegex.exec(e||"");return a?{spatialLayers:Number(a[1]),temporalLayers:Number(a[2])}:{spatialLayers:1,temporalLayers:1}}$991a06b940351aa492c8a67e5b288aa6$export$parse=$991a06b940351aa492c8a67e5b288aa6$var$parse,$991a06b940351aa492c8a67e5b288aa6$exports.parse=$991a06b940351aa492c8a67e5b288aa6$export$parse;const $49246bb5a2f6e045fa681202ab25d3c3$var$logger=new $1495c7c2155b511d7a7eba88d183bc8a$exports.Logger("Chrome74"),$49246bb5a2f6e045fa681202ab25d3c3$var$SCTP_NUM_STREAMS={OS:1024,MIS:1024};class $49246bb5a2f6e045fa681202ab25d3c3$var$Chrome74 extends $cc0c0c04507cca8137231b297300d331$exports.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new $49246bb5a2f6e045fa681202ab25d3c3$var$Chrome74}get name(){return"Chrome74"}close(){if($49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const a=await e.createOffer();try{e.close()}catch(e){}const t=$49246bb5a2f6e045fa681202ab25d3c3$var$sdpTransform.parse(a.sdp);return $49246bb5a2f6e045fa681202ab25d3c3$var$sdpCommonUtils.extractRtpCapabilities({sdpObject:t})}catch(a){try{e.close()}catch(e){}throw a}}async getNativeSctpCapabilities(){return $49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("getNativeSctpCapabilities()"),{numStreams:$49246bb5a2f6e045fa681202ab25d3c3$var$SCTP_NUM_STREAMS}}run({direction:e,iceParameters:a,iceCandidates:t,dtlsParameters:r,sctpParameters:c,iceServers:s,iceTransportPolicy:d,additionalSettings:i,proprietaryConstraints:o,extendedRtpCapabilities:n}){$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("run()"),this._direction=e,this._remoteSdp=new $2aa38523a6b418a7db72b14d2d309ee6$exports.RemoteSdp({iceParameters:a,iceCandidates:t,dtlsParameters:r,sctpParameters:c}),this._sendingRtpParametersByKind={audio:$49246bb5a2f6e045fa681202ab25d3c3$var$ortc.getSendingRtpParameters("audio",n),video:$49246bb5a2f6e045fa681202ab25d3c3$var$ortc.getSendingRtpParameters("video",n)},this._sendingRemoteRtpParametersByKind={audio:$49246bb5a2f6e045fa681202ab25d3c3$var$ortc.getSendingRemoteRtpParameters("audio",n),video:$49246bb5a2f6e045fa681202ab25d3c3$var$ortc.getSendingRemoteRtpParameters("video",n)},this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:d||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},i),o),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("updateIceServers()");const a=this._pc.getConfiguration();a.iceServers=e,this._pc.setConfiguration(a)}async restartIce(e){if($49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const a={type:"answer",sdp:this._remoteSdp.getSdp()};$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const a=await this._pc.createAnswer();$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:a,codecOptions:t,codec:r}){this._assertSendDirection(),$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),a&&a.length>1&&a.forEach(((e,a)=>{e.rid=`r${a}`}));const c=$49246bb5a2f6e045fa681202ab25d3c3$var$utils.clone(this._sendingRtpParametersByKind[e.kind],{});c.codecs=$49246bb5a2f6e045fa681202ab25d3c3$var$ortc.reduceCodecs(c.codecs,r);const s=$49246bb5a2f6e045fa681202ab25d3c3$var$utils.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});s.codecs=$49246bb5a2f6e045fa681202ab25d3c3$var$ortc.reduceCodecs(s.codecs,r);const d=this._remoteSdp.getNextMediaSectionIdx(),i=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:a});let o,n=await this._pc.createOffer(),f=$49246bb5a2f6e045fa681202ab25d3c3$var$sdpTransform.parse(n.sdp);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:f});let $=!1;const b=$991a06b940351aa492c8a67e5b288aa6$exports.parse((a||[{}])[0].scalabilityMode);a&&1===a.length&&b.spatialLayers>1&&"video/vp9"===c.codecs[0].mimeType.toLowerCase()&&($49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("send() | enabling legacy simulcast for VP9 SVC"),$=!0,f=$49246bb5a2f6e045fa681202ab25d3c3$var$sdpTransform.parse(n.sdp),o=f.media[d.idx],$49246bb5a2f6e045fa681202ab25d3c3$var$sdpUnifiedPlanUtils.addLegacySimulcast({offerMediaObject:o,numStreams:b.spatialLayers}),n={type:"offer",sdp:$49246bb5a2f6e045fa681202ab25d3c3$var$sdpTransform.write(f)}),$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("send() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const p=i.mid;if(c.mid=p,f=$49246bb5a2f6e045fa681202ab25d3c3$var$sdpTransform.parse(this._pc.localDescription.sdp),o=f.media[d.idx],c.rtcp.cname=$49246bb5a2f6e045fa681202ab25d3c3$var$sdpCommonUtils.getCname({offerMediaObject:o}),a)if(1===a.length){let e=$49246bb5a2f6e045fa681202ab25d3c3$var$sdpUnifiedPlanUtils.getRtpEncodings({offerMediaObject:o});Object.assign(e[0],a[0]),$&&(e=[e[0]]),c.encodings=e}else c.encodings=a;else c.encodings=$49246bb5a2f6e045fa681202ab25d3c3$var$sdpUnifiedPlanUtils.getRtpEncodings({offerMediaObject:o});if(c.encodings.length>1&&("video/vp8"===c.codecs[0].mimeType.toLowerCase()||"video/h264"===c.codecs[0].mimeType.toLowerCase()))for(const e of c.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:o,reuseMid:d.reuseMid,offerRtpParameters:c,answerRtpParameters:s,codecOptions:t,extmapAllowMixed:!0});const l={type:"answer",sdp:this._remoteSdp.getSdp()};return $49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("send() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setRemoteDescription(l),this._mapMidTransceiver.set(p,i),{localId:p,rtpParameters:c,rtpSender:i.sender}}async stopSending(e){this._assertSendDirection(),$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("stopSending() [localId:%s]",e);const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.sender.replaceTrack(null),this._pc.removeTrack(a.sender),this._remoteSdp.closeMediaSection(a.mid);const t=await this._pc.createOffer();$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const r={type:"answer",sdp:this._remoteSdp.getSdp()};$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async replaceTrack(e,a){this._assertSendDirection(),a?$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("replaceTrack() [localId:%s, track.id:%s]",e,a.id):$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("replaceTrack() [localId:%s, no track]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");await t.sender.replaceTrack(a)}async setMaxSpatialLayer(e,a){this._assertSendDirection(),$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,a);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach(((e,t)=>{e.active=t<=a})),await t.sender.setParameters(r)}async setRtpEncodingParameters(e,a){this._assertSendDirection(),$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,a);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach(((e,t)=>{r.encodings[t]=Object.assign(Object.assign({},e),a)})),await t.sender.setParameters(r)}async getSenderStats(e){this._assertSendDirection();const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");return a.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:a,maxRetransmits:t,label:r,protocol:c,priority:s}){this._assertSendDirection();const d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:a,maxRetransmits:t,protocol:c,priority:s};$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("sendDataChannel() [options:%o]",d);const i=this._pc.createDataChannel(r,d);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%$49246bb5a2f6e045fa681202ab25d3c3$var$SCTP_NUM_STREAMS.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),a=$49246bb5a2f6e045fa681202ab25d3c3$var$sdpTransform.parse(e.sdp),t=a.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:a}),$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:t});const r={type:"answer",sdp:this._remoteSdp.getSdp()};$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r),this._hasDataChannelMediaSection=!0}return{dataChannel:i,sctpStreamParameters:{streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits}}}async receive({trackId:e,kind:a,rtpParameters:t}){this._assertRecvDirection(),$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("receive() [trackId:%s, kind:%s]",e,a);const r=t.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:r,kind:a,offerRtpParameters:t,streamId:t.rtcp.cname,trackId:e});const c={type:"offer",sdp:this._remoteSdp.getSdp()};$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let s=await this._pc.createAnswer();const d=$49246bb5a2f6e045fa681202ab25d3c3$var$sdpTransform.parse(s.sdp),i=d.media.find((e=>String(e.mid)===r));$49246bb5a2f6e045fa681202ab25d3c3$var$sdpCommonUtils.applyCodecParameters({offerRtpParameters:t,answerMediaObject:i}),s={type:"answer",sdp:$49246bb5a2f6e045fa681202ab25d3c3$var$sdpTransform.write(d)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:d}),$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);const o=this._pc.getTransceivers().find((e=>e.mid===r));if(!o)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(r,o),{localId:r,track:o.receiver.track,rtpReceiver:o.receiver}}async stopReceiving(e){this._assertRecvDirection(),$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("stopReceiving() [localId:%s]",e);const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid);const t={type:"offer",sdp:this._remoteSdp.getSdp()};$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(e){this._assertRecvDirection();const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");return a.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:a,protocol:t}){this._assertRecvDirection();const{streamId:r,ordered:c,maxPacketLifeTime:s,maxRetransmits:d}=e,i={negotiated:!0,id:r,ordered:c,maxPacketLifeTime:s,maxRetransmits:d,protocol:t};$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("receiveDataChannel() [options:%o]",i);const o=this._pc.createDataChannel(a,i);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const a=await this._pc.createAnswer();if(!this._transportReady){const e=$49246bb5a2f6e045fa681202ab25d3c3$var$sdpTransform.parse(a.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}$49246bb5a2f6e045fa681202ab25d3c3$var$logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setLocalDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:o}}async _setupTransport({localDtlsRole:e,localSdpObject:a}){a||(a=$49246bb5a2f6e045fa681202ab25d3c3$var$sdpTransform.parse(this._pc.localDescription.sdp));const t=$49246bb5a2f6e045fa681202ab25d3c3$var$sdpCommonUtils.extractDtlsParameters({sdpObject:a});t.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:t}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}$49246bb5a2f6e045fa681202ab25d3c3$export$Chrome74=$49246bb5a2f6e045fa681202ab25d3c3$var$Chrome74,$49246bb5a2f6e045fa681202ab25d3c3$exports.Chrome74=$49246bb5a2f6e045fa681202ab25d3c3$export$Chrome74;var $f94627158a480fddc2767d3897b30f81$exports={},$f94627158a480fddc2767d3897b30f81$var$__createBinding=$f94627158a480fddc2767d3897b30f81$exports&&$f94627158a480fddc2767d3897b30f81$exports.__createBinding||(Object.create?function(e,a,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,r){void 0===r&&(r=t),e[r]=a[t]}),$f94627158a480fddc2767d3897b30f81$var$__setModuleDefault=$f94627158a480fddc2767d3897b30f81$exports&&$f94627158a480fddc2767d3897b30f81$exports.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),$f94627158a480fddc2767d3897b30f81$var$__importStar=$f94627158a480fddc2767d3897b30f81$exports&&$f94627158a480fddc2767d3897b30f81$exports.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)"default"!==t&&Object.hasOwnProperty.call(e,t)&&$f94627158a480fddc2767d3897b30f81$var$__createBinding(a,e,t);return $f94627158a480fddc2767d3897b30f81$var$__setModuleDefault(a,e),a};Object.defineProperty($f94627158a480fddc2767d3897b30f81$exports,"__esModule",{value:!0});var $f94627158a480fddc2767d3897b30f81$export$Chrome70=void 0;$f94627158a480fddc2767d3897b30f81$exports.Chrome70=$f94627158a480fddc2767d3897b30f81$export$Chrome70;const $f94627158a480fddc2767d3897b30f81$var$sdpTransform=$f94627158a480fddc2767d3897b30f81$var$__importStar($b905cbabdece2b7ed3d885dc9ff42ac0$exports),$f94627158a480fddc2767d3897b30f81$var$utils=$f94627158a480fddc2767d3897b30f81$var$__importStar($6abc7ab33e1327c2d411a5fc6b37fe23$exports),$f94627158a480fddc2767d3897b30f81$var$ortc=$f94627158a480fddc2767d3897b30f81$var$__importStar($c14b343179c41479c8bdeecb64f7be76$exports),$f94627158a480fddc2767d3897b30f81$var$sdpCommonUtils=$f94627158a480fddc2767d3897b30f81$var$__importStar($d52929f92c17dce5cc60b70ec647fedb$exports),$f94627158a480fddc2767d3897b30f81$var$sdpUnifiedPlanUtils=$f94627158a480fddc2767d3897b30f81$var$__importStar($9ea9aaf7fac84dd2d2be874016e3619c$exports),$f94627158a480fddc2767d3897b30f81$var$logger=new $1495c7c2155b511d7a7eba88d183bc8a$exports.Logger("Chrome70"),$f94627158a480fddc2767d3897b30f81$var$SCTP_NUM_STREAMS={OS:1024,MIS:1024};class $f94627158a480fddc2767d3897b30f81$var$Chrome70 extends $cc0c0c04507cca8137231b297300d331$exports.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new $f94627158a480fddc2767d3897b30f81$var$Chrome70}get name(){return"Chrome70"}close(){if($f94627158a480fddc2767d3897b30f81$var$logger.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){$f94627158a480fddc2767d3897b30f81$var$logger.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const a=await e.createOffer();try{e.close()}catch(e){}const t=$f94627158a480fddc2767d3897b30f81$var$sdpTransform.parse(a.sdp);return $f94627158a480fddc2767d3897b30f81$var$sdpCommonUtils.extractRtpCapabilities({sdpObject:t})}catch(a){try{e.close()}catch(e){}throw a}}async getNativeSctpCapabilities(){return $f94627158a480fddc2767d3897b30f81$var$logger.debug("getNativeSctpCapabilities()"),{numStreams:$f94627158a480fddc2767d3897b30f81$var$SCTP_NUM_STREAMS}}run({direction:e,iceParameters:a,iceCandidates:t,dtlsParameters:r,sctpParameters:c,iceServers:s,iceTransportPolicy:d,additionalSettings:i,proprietaryConstraints:o,extendedRtpCapabilities:n}){$f94627158a480fddc2767d3897b30f81$var$logger.debug("run()"),this._direction=e,this._remoteSdp=new $2aa38523a6b418a7db72b14d2d309ee6$exports.RemoteSdp({iceParameters:a,iceCandidates:t,dtlsParameters:r,sctpParameters:c}),this._sendingRtpParametersByKind={audio:$f94627158a480fddc2767d3897b30f81$var$ortc.getSendingRtpParameters("audio",n),video:$f94627158a480fddc2767d3897b30f81$var$ortc.getSendingRtpParameters("video",n)},this._sendingRemoteRtpParametersByKind={audio:$f94627158a480fddc2767d3897b30f81$var$ortc.getSendingRemoteRtpParameters("audio",n),video:$f94627158a480fddc2767d3897b30f81$var$ortc.getSendingRemoteRtpParameters("video",n)},this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:d||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},i),o),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){$f94627158a480fddc2767d3897b30f81$var$logger.debug("updateIceServers()");const a=this._pc.getConfiguration();a.iceServers=e,this._pc.setConfiguration(a)}async restartIce(e){if($f94627158a480fddc2767d3897b30f81$var$logger.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});$f94627158a480fddc2767d3897b30f81$var$logger.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const a={type:"answer",sdp:this._remoteSdp.getSdp()};$f94627158a480fddc2767d3897b30f81$var$logger.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};$f94627158a480fddc2767d3897b30f81$var$logger.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const a=await this._pc.createAnswer();$f94627158a480fddc2767d3897b30f81$var$logger.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:a,codecOptions:t,codec:r}){this._assertSendDirection(),$f94627158a480fddc2767d3897b30f81$var$logger.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const c=$f94627158a480fddc2767d3897b30f81$var$utils.clone(this._sendingRtpParametersByKind[e.kind],{});c.codecs=$f94627158a480fddc2767d3897b30f81$var$ortc.reduceCodecs(c.codecs,r);const s=$f94627158a480fddc2767d3897b30f81$var$utils.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});s.codecs=$f94627158a480fddc2767d3897b30f81$var$ortc.reduceCodecs(s.codecs,r);const d=this._remoteSdp.getNextMediaSectionIdx(),i=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let o,n=await this._pc.createOffer(),f=$f94627158a480fddc2767d3897b30f81$var$sdpTransform.parse(n.sdp);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:f}),a&&a.length>1&&($f94627158a480fddc2767d3897b30f81$var$logger.debug("send() | enabling legacy simulcast"),f=$f94627158a480fddc2767d3897b30f81$var$sdpTransform.parse(n.sdp),o=f.media[d.idx],$f94627158a480fddc2767d3897b30f81$var$sdpUnifiedPlanUtils.addLegacySimulcast({offerMediaObject:o,numStreams:a.length}),n={type:"offer",sdp:$f94627158a480fddc2767d3897b30f81$var$sdpTransform.write(f)});let $=!1;const b=$991a06b940351aa492c8a67e5b288aa6$exports.parse((a||[{}])[0].scalabilityMode);if(a&&1===a.length&&b.spatialLayers>1&&"video/vp9"===c.codecs[0].mimeType.toLowerCase()&&($f94627158a480fddc2767d3897b30f81$var$logger.debug("send() | enabling legacy simulcast for VP9 SVC"),$=!0,f=$f94627158a480fddc2767d3897b30f81$var$sdpTransform.parse(n.sdp),o=f.media[d.idx],$f94627158a480fddc2767d3897b30f81$var$sdpUnifiedPlanUtils.addLegacySimulcast({offerMediaObject:o,numStreams:b.spatialLayers}),n={type:"offer",sdp:$f94627158a480fddc2767d3897b30f81$var$sdpTransform.write(f)}),$f94627158a480fddc2767d3897b30f81$var$logger.debug("send() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n),a){$f94627158a480fddc2767d3897b30f81$var$logger.debug("send() | applying given encodings");const e=i.sender.getParameters();for(let t=0;t<(e.encodings||[]).length;++t){const r=e.encodings[t],c=a[t];if(!c)break;e.encodings[t]=Object.assign(r,c)}await i.sender.setParameters(e)}const p=i.mid;if(c.mid=p,f=$f94627158a480fddc2767d3897b30f81$var$sdpTransform.parse(this._pc.localDescription.sdp),o=f.media[d.idx],c.rtcp.cname=$f94627158a480fddc2767d3897b30f81$var$sdpCommonUtils.getCname({offerMediaObject:o}),c.encodings=$f94627158a480fddc2767d3897b30f81$var$sdpUnifiedPlanUtils.getRtpEncodings({offerMediaObject:o}),a)for(let e=0;e<c.encodings.length;++e)a[e]&&Object.assign(c.encodings[e],a[e]);if($&&(c.encodings=[c.encodings[0]]),c.encodings.length>1&&("video/vp8"===c.codecs[0].mimeType.toLowerCase()||"video/h264"===c.codecs[0].mimeType.toLowerCase()))for(const e of c.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:o,reuseMid:d.reuseMid,offerRtpParameters:c,answerRtpParameters:s,codecOptions:t});const l={type:"answer",sdp:this._remoteSdp.getSdp()};return $f94627158a480fddc2767d3897b30f81$var$logger.debug("send() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setRemoteDescription(l),this._mapMidTransceiver.set(p,i),{localId:p,rtpParameters:c,rtpSender:i.sender}}async stopSending(e){this._assertSendDirection(),$f94627158a480fddc2767d3897b30f81$var$logger.debug("stopSending() [localId:%s]",e);const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.sender.replaceTrack(null),this._pc.removeTrack(a.sender),this._remoteSdp.closeMediaSection(a.mid);const t=await this._pc.createOffer();$f94627158a480fddc2767d3897b30f81$var$logger.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const r={type:"answer",sdp:this._remoteSdp.getSdp()};$f94627158a480fddc2767d3897b30f81$var$logger.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async replaceTrack(e,a){this._assertSendDirection(),a?$f94627158a480fddc2767d3897b30f81$var$logger.debug("replaceTrack() [localId:%s, track.id:%s]",e,a.id):$f94627158a480fddc2767d3897b30f81$var$logger.debug("replaceTrack() [localId:%s, no track]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");await t.sender.replaceTrack(a)}async setMaxSpatialLayer(e,a){this._assertSendDirection(),$f94627158a480fddc2767d3897b30f81$var$logger.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,a);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach(((e,t)=>{e.active=t<=a})),await t.sender.setParameters(r)}async setRtpEncodingParameters(e,a){this._assertSendDirection(),$f94627158a480fddc2767d3897b30f81$var$logger.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,a);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach(((e,t)=>{r.encodings[t]=Object.assign(Object.assign({},e),a)})),await t.sender.setParameters(r)}async getSenderStats(e){this._assertSendDirection();const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");return a.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:a,maxRetransmits:t,label:r,protocol:c,priority:s}){this._assertSendDirection();const d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:t,protocol:c,priority:s};$f94627158a480fddc2767d3897b30f81$var$logger.debug("sendDataChannel() [options:%o]",d);const i=this._pc.createDataChannel(r,d);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%$f94627158a480fddc2767d3897b30f81$var$SCTP_NUM_STREAMS.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),a=$f94627158a480fddc2767d3897b30f81$var$sdpTransform.parse(e.sdp),t=a.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:a}),$f94627158a480fddc2767d3897b30f81$var$logger.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:t});const r={type:"answer",sdp:this._remoteSdp.getSdp()};$f94627158a480fddc2767d3897b30f81$var$logger.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r),this._hasDataChannelMediaSection=!0}return{dataChannel:i,sctpStreamParameters:{streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits}}}async receive({trackId:e,kind:a,rtpParameters:t}){this._assertRecvDirection(),$f94627158a480fddc2767d3897b30f81$var$logger.debug("receive() [trackId:%s, kind:%s]",e,a);const r=t.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:r,kind:a,offerRtpParameters:t,streamId:t.rtcp.cname,trackId:e});const c={type:"offer",sdp:this._remoteSdp.getSdp()};$f94627158a480fddc2767d3897b30f81$var$logger.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let s=await this._pc.createAnswer();const d=$f94627158a480fddc2767d3897b30f81$var$sdpTransform.parse(s.sdp),i=d.media.find((e=>String(e.mid)===r));$f94627158a480fddc2767d3897b30f81$var$sdpCommonUtils.applyCodecParameters({offerRtpParameters:t,answerMediaObject:i}),s={type:"answer",sdp:$f94627158a480fddc2767d3897b30f81$var$sdpTransform.write(d)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:d}),$f94627158a480fddc2767d3897b30f81$var$logger.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);const o=this._pc.getTransceivers().find((e=>e.mid===r));if(!o)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(r,o),{localId:r,track:o.receiver.track,rtpReceiver:o.receiver}}async stopReceiving(e){this._assertRecvDirection(),$f94627158a480fddc2767d3897b30f81$var$logger.debug("stopReceiving() [localId:%s]",e);const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid);const t={type:"offer",sdp:this._remoteSdp.getSdp()};$f94627158a480fddc2767d3897b30f81$var$logger.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();$f94627158a480fddc2767d3897b30f81$var$logger.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(e){this._assertRecvDirection();const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");return a.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:a,protocol:t}){this._assertRecvDirection();const{streamId:r,ordered:c,maxPacketLifeTime:s,maxRetransmits:d}=e,i={negotiated:!0,id:r,ordered:c,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:d,protocol:t};$f94627158a480fddc2767d3897b30f81$var$logger.debug("receiveDataChannel() [options:%o]",i);const o=this._pc.createDataChannel(a,i);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};$f94627158a480fddc2767d3897b30f81$var$logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const a=await this._pc.createAnswer();if(!this._transportReady){const e=$f94627158a480fddc2767d3897b30f81$var$sdpTransform.parse(a.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}$f94627158a480fddc2767d3897b30f81$var$logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setLocalDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:o}}async _setupTransport({localDtlsRole:e,localSdpObject:a}){a||(a=$f94627158a480fddc2767d3897b30f81$var$sdpTransform.parse(this._pc.localDescription.sdp));const t=$f94627158a480fddc2767d3897b30f81$var$sdpCommonUtils.extractDtlsParameters({sdpObject:a});t.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:t}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}$f94627158a480fddc2767d3897b30f81$export$Chrome70=$f94627158a480fddc2767d3897b30f81$var$Chrome70,$f94627158a480fddc2767d3897b30f81$exports.Chrome70=$f94627158a480fddc2767d3897b30f81$export$Chrome70;var $4b535345a8382557a5d35f66f7222c89$exports={},$4b535345a8382557a5d35f66f7222c89$var$__createBinding=$4b535345a8382557a5d35f66f7222c89$exports&&$4b535345a8382557a5d35f66f7222c89$exports.__createBinding||(Object.create?function(e,a,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,r){void 0===r&&(r=t),e[r]=a[t]}),$4b535345a8382557a5d35f66f7222c89$var$__setModuleDefault=$4b535345a8382557a5d35f66f7222c89$exports&&$4b535345a8382557a5d35f66f7222c89$exports.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),$4b535345a8382557a5d35f66f7222c89$var$__importStar=$4b535345a8382557a5d35f66f7222c89$exports&&$4b535345a8382557a5d35f66f7222c89$exports.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)"default"!==t&&Object.hasOwnProperty.call(e,t)&&$4b535345a8382557a5d35f66f7222c89$var$__createBinding(a,e,t);return $4b535345a8382557a5d35f66f7222c89$var$__setModuleDefault(a,e),a};Object.defineProperty($4b535345a8382557a5d35f66f7222c89$exports,"__esModule",{value:!0});var $4b535345a8382557a5d35f66f7222c89$export$Chrome67=void 0;$4b535345a8382557a5d35f66f7222c89$exports.Chrome67=$4b535345a8382557a5d35f66f7222c89$export$Chrome67;const $4b535345a8382557a5d35f66f7222c89$var$sdpTransform=$4b535345a8382557a5d35f66f7222c89$var$__importStar($b905cbabdece2b7ed3d885dc9ff42ac0$exports),$4b535345a8382557a5d35f66f7222c89$var$utils=$4b535345a8382557a5d35f66f7222c89$var$__importStar($6abc7ab33e1327c2d411a5fc6b37fe23$exports),$4b535345a8382557a5d35f66f7222c89$var$ortc=$4b535345a8382557a5d35f66f7222c89$var$__importStar($c14b343179c41479c8bdeecb64f7be76$exports),$4b535345a8382557a5d35f66f7222c89$var$sdpCommonUtils=$4b535345a8382557a5d35f66f7222c89$var$__importStar($d52929f92c17dce5cc60b70ec647fedb$exports);var $95414416f142b78649b3036f3acc7f22$exports={};Object.defineProperty($95414416f142b78649b3036f3acc7f22$exports,"__esModule",{value:!0});var $95414416f142b78649b3036f3acc7f22$export$addLegacySimulcast=($95414416f142b78649b3036f3acc7f22$export$getRtpEncodings=void 0,$95414416f142b78649b3036f3acc7f22$exports.getRtpEncodings=$95414416f142b78649b3036f3acc7f22$export$getRtpEncodings);function $95414416f142b78649b3036f3acc7f22$var$getRtpEncodings({offerMediaObject:e,track:a}){let t;const r=new Set;for(const c of e.ssrcs||[]){if("msid"!==c.attribute)continue;if(c.value.split(" ")[1]===a.id){const e=c.id;r.add(e),t||(t=e)}}if(0===r.size)throw new Error(`a=ssrc line with msid information not found [track.id:${a.id}]`);const c=new Map;for(const a of e.ssrcGroups||[]){if("FID"!==a.semantics)continue;let[e,t]=a.ssrcs.split(/\s+/);e=Number(e),t=Number(t),r.has(e)&&(r.delete(e),r.delete(t),c.set(e,t))}for(const e of r)c.set(e,null);const s=[];for(const[e,a]of c){const t={ssrc:e};a&&(t.rtx={ssrc:a}),s.push(t)}return s}$95414416f142b78649b3036f3acc7f22$exports.addLegacySimulcast=$95414416f142b78649b3036f3acc7f22$export$addLegacySimulcast;var $95414416f142b78649b3036f3acc7f22$export$getRtpEncodings=$95414416f142b78649b3036f3acc7f22$var$getRtpEncodings;function $95414416f142b78649b3036f3acc7f22$var$addLegacySimulcast({offerMediaObject:e,track:a,numStreams:t}){if(t<=1)throw new TypeError("numStreams must be greater than 1");let r,c,s;if(!(e.ssrcs||[]).find((e=>{if("msid"!==e.attribute)return!1;return e.value.split(" ")[1]===a.id&&(r=e.id,s=e.value.split(" ")[0],!0)})))throw new Error(`a=ssrc line with msid information not found [track.id:${a.id}]`);(e.ssrcGroups||[]).some((e=>{if("FID"!==e.semantics)return!1;const a=e.ssrcs.split(/\s+/);return Number(a[0])===r&&(c=Number(a[1]),!0)}));const d=e.ssrcs.find((e=>"cname"===e.attribute&&e.id===r));if(!d)throw new Error(`a=ssrc line with cname information not found [track.id:${a.id}]`);const i=d.value,o=[],n=[];for(let e=0;e<t;++e)o.push(r+e),c&&n.push(c+e);e.ssrcGroups=e.ssrcGroups||[],e.ssrcs=e.ssrcs||[],e.ssrcGroups.push({semantics:"SIM",ssrcs:o.join(" ")});for(let t=0;t<o.length;++t){const r=o[t];e.ssrcs.push({id:r,attribute:"cname",value:i}),e.ssrcs.push({id:r,attribute:"msid",value:`${s} ${a.id}`})}for(let t=0;t<n.length;++t){const r=o[t],c=n[t];e.ssrcs.push({id:c,attribute:"cname",value:i}),e.ssrcs.push({id:c,attribute:"msid",value:`${s} ${a.id}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${r} ${c}`})}}$95414416f142b78649b3036f3acc7f22$exports.getRtpEncodings=$95414416f142b78649b3036f3acc7f22$export$getRtpEncodings,$95414416f142b78649b3036f3acc7f22$export$addLegacySimulcast=$95414416f142b78649b3036f3acc7f22$var$addLegacySimulcast,$95414416f142b78649b3036f3acc7f22$exports.addLegacySimulcast=$95414416f142b78649b3036f3acc7f22$export$addLegacySimulcast;const $4b535345a8382557a5d35f66f7222c89$var$sdpPlanBUtils=$4b535345a8382557a5d35f66f7222c89$var$__importStar($95414416f142b78649b3036f3acc7f22$exports),$4b535345a8382557a5d35f66f7222c89$var$logger=new $1495c7c2155b511d7a7eba88d183bc8a$exports.Logger("Chrome67"),$4b535345a8382557a5d35f66f7222c89$var$SCTP_NUM_STREAMS={OS:1024,MIS:1024};class $4b535345a8382557a5d35f66f7222c89$var$Chrome67 extends $cc0c0c04507cca8137231b297300d331$exports.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new $4b535345a8382557a5d35f66f7222c89$var$Chrome67}get name(){return"Chrome67"}close(){if($4b535345a8382557a5d35f66f7222c89$var$logger.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){$4b535345a8382557a5d35f66f7222c89$var$logger.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const a=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const t=$4b535345a8382557a5d35f66f7222c89$var$sdpTransform.parse(a.sdp);return $4b535345a8382557a5d35f66f7222c89$var$sdpCommonUtils.extractRtpCapabilities({sdpObject:t})}catch(a){try{e.close()}catch(e){}throw a}}async getNativeSctpCapabilities(){return $4b535345a8382557a5d35f66f7222c89$var$logger.debug("getNativeSctpCapabilities()"),{numStreams:$4b535345a8382557a5d35f66f7222c89$var$SCTP_NUM_STREAMS}}run({direction:e,iceParameters:a,iceCandidates:t,dtlsParameters:r,sctpParameters:c,iceServers:s,iceTransportPolicy:d,additionalSettings:i,proprietaryConstraints:o,extendedRtpCapabilities:n}){$4b535345a8382557a5d35f66f7222c89$var$logger.debug("run()"),this._direction=e,this._remoteSdp=new $2aa38523a6b418a7db72b14d2d309ee6$exports.RemoteSdp({iceParameters:a,iceCandidates:t,dtlsParameters:r,sctpParameters:c,planB:!0}),this._sendingRtpParametersByKind={audio:$4b535345a8382557a5d35f66f7222c89$var$ortc.getSendingRtpParameters("audio",n),video:$4b535345a8382557a5d35f66f7222c89$var$ortc.getSendingRtpParameters("video",n)},this._sendingRemoteRtpParametersByKind={audio:$4b535345a8382557a5d35f66f7222c89$var$ortc.getSendingRemoteRtpParameters("audio",n),video:$4b535345a8382557a5d35f66f7222c89$var$ortc.getSendingRemoteRtpParameters("video",n)},this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:d||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},i),o),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){$4b535345a8382557a5d35f66f7222c89$var$logger.debug("updateIceServers()");const a=this._pc.getConfiguration();a.iceServers=e,this._pc.setConfiguration(a)}async restartIce(e){if($4b535345a8382557a5d35f66f7222c89$var$logger.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});$4b535345a8382557a5d35f66f7222c89$var$logger.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const a={type:"answer",sdp:this._remoteSdp.getSdp()};$4b535345a8382557a5d35f66f7222c89$var$logger.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};$4b535345a8382557a5d35f66f7222c89$var$logger.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const a=await this._pc.createAnswer();$4b535345a8382557a5d35f66f7222c89$var$logger.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:a,codecOptions:t,codec:r}){this._assertSendDirection(),$4b535345a8382557a5d35f66f7222c89$var$logger.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),r&&$4b535345a8382557a5d35f66f7222c89$var$logger.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let c,s=await this._pc.createOffer(),d=$4b535345a8382557a5d35f66f7222c89$var$sdpTransform.parse(s.sdp);const i=$4b535345a8382557a5d35f66f7222c89$var$utils.clone(this._sendingRtpParametersByKind[e.kind],{});i.codecs=$4b535345a8382557a5d35f66f7222c89$var$ortc.reduceCodecs(i.codecs);const o=$4b535345a8382557a5d35f66f7222c89$var$utils.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(o.codecs=$4b535345a8382557a5d35f66f7222c89$var$ortc.reduceCodecs(o.codecs),this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:d}),"video"===e.kind&&a&&a.length>1&&($4b535345a8382557a5d35f66f7222c89$var$logger.debug("send() | enabling simulcast"),d=$4b535345a8382557a5d35f66f7222c89$var$sdpTransform.parse(s.sdp),c=d.media.find((e=>"video"===e.type)),$4b535345a8382557a5d35f66f7222c89$var$sdpPlanBUtils.addLegacySimulcast({offerMediaObject:c,track:e,numStreams:a.length}),s={type:"offer",sdp:$4b535345a8382557a5d35f66f7222c89$var$sdpTransform.write(d)}),$4b535345a8382557a5d35f66f7222c89$var$logger.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s),d=$4b535345a8382557a5d35f66f7222c89$var$sdpTransform.parse(this._pc.localDescription.sdp),c=d.media.find((a=>a.type===e.kind)),i.rtcp.cname=$4b535345a8382557a5d35f66f7222c89$var$sdpCommonUtils.getCname({offerMediaObject:c}),i.encodings=$4b535345a8382557a5d35f66f7222c89$var$sdpPlanBUtils.getRtpEncodings({offerMediaObject:c,track:e}),a)for(let e=0;e<i.encodings.length;++e)a[e]&&Object.assign(i.encodings[e],a[e]);if(i.encodings.length>1&&"video/vp8"===i.codecs[0].mimeType.toLowerCase())for(const e of i.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:c,offerRtpParameters:i,answerRtpParameters:o,codecOptions:t});const n={type:"answer",sdp:this._remoteSdp.getSdp()};$4b535345a8382557a5d35f66f7222c89$var$logger.debug("send() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n);const f=String(this._nextSendLocalId);this._nextSendLocalId++;const $=this._pc.getSenders().find((a=>a.track===e));return this._mapSendLocalIdRtpSender.set(f,$),{localId:f,rtpParameters:i,rtpSender:$}}async stopSending(e){this._assertSendDirection(),$4b535345a8382557a5d35f66f7222c89$var$logger.debug("stopSending() [localId:%s]",e);const a=this._mapSendLocalIdRtpSender.get(e);if(!a)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(a),a.track&&this._sendStream.removeTrack(a.track),this._mapSendLocalIdRtpSender.delete(e);const t=await this._pc.createOffer();$4b535345a8382557a5d35f66f7222c89$var$logger.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t);try{await this._pc.setLocalDescription(t)}catch(e){if(0===this._sendStream.getTracks().length)return void $4b535345a8382557a5d35f66f7222c89$var$logger.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"===this._pc.signalingState)return;const r={type:"answer",sdp:this._remoteSdp.getSdp()};$4b535345a8382557a5d35f66f7222c89$var$logger.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async replaceTrack(e,a){this._assertSendDirection(),a?$4b535345a8382557a5d35f66f7222c89$var$logger.debug("replaceTrack() [localId:%s, track.id:%s]",e,a.id):$4b535345a8382557a5d35f66f7222c89$var$logger.debug("replaceTrack() [localId:%s, no track]",e);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");const r=t.track;await t.replaceTrack(a),r&&this._sendStream.removeTrack(r),a&&this._sendStream.addTrack(a)}async setMaxSpatialLayer(e,a){this._assertSendDirection(),$4b535345a8382557a5d35f66f7222c89$var$logger.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,a);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");const r=t.getParameters();r.encodings.forEach(((e,t)=>{e.active=t<=a})),await t.setParameters(r)}async setRtpEncodingParameters(e,a){this._assertSendDirection(),$4b535345a8382557a5d35f66f7222c89$var$logger.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,a);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");const r=t.getParameters();r.encodings.forEach(((e,t)=>{r.encodings[t]=Object.assign(Object.assign({},e),a)})),await t.setParameters(r)}async getSenderStats(e){this._assertSendDirection();const a=this._mapSendLocalIdRtpSender.get(e);if(!a)throw new Error("associated RTCRtpSender not found");return a.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:a,maxRetransmits:t,label:r,protocol:c,priority:s}){this._assertSendDirection();const d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:t,protocol:c,priority:s};$4b535345a8382557a5d35f66f7222c89$var$logger.debug("sendDataChannel() [options:%o]",d);const i=this._pc.createDataChannel(r,d);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%$4b535345a8382557a5d35f66f7222c89$var$SCTP_NUM_STREAMS.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),a=$4b535345a8382557a5d35f66f7222c89$var$sdpTransform.parse(e.sdp),t=a.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:a}),$4b535345a8382557a5d35f66f7222c89$var$logger.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:t});const r={type:"answer",sdp:this._remoteSdp.getSdp()};$4b535345a8382557a5d35f66f7222c89$var$logger.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r),this._hasDataChannelMediaSection=!0}return{dataChannel:i,sctpStreamParameters:{streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits}}}async receive({trackId:e,kind:a,rtpParameters:t}){this._assertRecvDirection(),$4b535345a8382557a5d35f66f7222c89$var$logger.debug("receive() [trackId:%s, kind:%s]",e,a);const r=e,c=a;this._remoteSdp.receive({mid:c,kind:a,offerRtpParameters:t,streamId:t.rtcp.cname,trackId:e});const s={type:"offer",sdp:this._remoteSdp.getSdp()};$4b535345a8382557a5d35f66f7222c89$var$logger.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let d=await this._pc.createAnswer();const i=$4b535345a8382557a5d35f66f7222c89$var$sdpTransform.parse(d.sdp),o=i.media.find((e=>String(e.mid)===c));$4b535345a8382557a5d35f66f7222c89$var$sdpCommonUtils.applyCodecParameters({offerRtpParameters:t,answerMediaObject:o}),d={type:"answer",sdp:$4b535345a8382557a5d35f66f7222c89$var$sdpTransform.write(i)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:i}),$4b535345a8382557a5d35f66f7222c89$var$logger.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);const n=this._pc.getReceivers().find((e=>e.track&&e.track.id===r));if(!n)throw new Error("new RTCRtpReceiver not");return this._mapRecvLocalIdInfo.set(r,{mid:c,rtpParameters:t,rtpReceiver:n}),{localId:r,track:n.track,rtpReceiver:n}}async stopReceiving(e){this._assertRecvDirection(),$4b535345a8382557a5d35f66f7222c89$var$logger.debug("stopReceiving() [localId:%s]",e);const{mid:a,rtpParameters:t}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:a,offerRtpParameters:t});const r={type:"offer",sdp:this._remoteSdp.getSdp()};$4b535345a8382557a5d35f66f7222c89$var$logger.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const c=await this._pc.createAnswer();$4b535345a8382557a5d35f66f7222c89$var$logger.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}async getReceiverStats(e){this._assertRecvDirection();const{rtpReceiver:a}=this._mapRecvLocalIdInfo.get(e)||{};if(!a)throw new Error("associated RTCRtpReceiver not found");return a.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:a,protocol:t}){this._assertRecvDirection();const{streamId:r,ordered:c,maxPacketLifeTime:s,maxRetransmits:d}=e,i={negotiated:!0,id:r,ordered:c,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:d,protocol:t};$4b535345a8382557a5d35f66f7222c89$var$logger.debug("receiveDataChannel() [options:%o]",i);const o=this._pc.createDataChannel(a,i);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};$4b535345a8382557a5d35f66f7222c89$var$logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const a=await this._pc.createAnswer();if(!this._transportReady){const e=$4b535345a8382557a5d35f66f7222c89$var$sdpTransform.parse(a.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}$4b535345a8382557a5d35f66f7222c89$var$logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setLocalDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:o}}async _setupTransport({localDtlsRole:e,localSdpObject:a}){a||(a=$4b535345a8382557a5d35f66f7222c89$var$sdpTransform.parse(this._pc.localDescription.sdp));const t=$4b535345a8382557a5d35f66f7222c89$var$sdpCommonUtils.extractDtlsParameters({sdpObject:a});t.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:t}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}$4b535345a8382557a5d35f66f7222c89$export$Chrome67=$4b535345a8382557a5d35f66f7222c89$var$Chrome67,$4b535345a8382557a5d35f66f7222c89$exports.Chrome67=$4b535345a8382557a5d35f66f7222c89$export$Chrome67;var $da6e6cb0c9c9bc1adc841a3b05ad48e0$exports={},$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$__createBinding=$da6e6cb0c9c9bc1adc841a3b05ad48e0$exports&&$da6e6cb0c9c9bc1adc841a3b05ad48e0$exports.__createBinding||(Object.create?function(e,a,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,r){void 0===r&&(r=t),e[r]=a[t]}),$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$__setModuleDefault=$da6e6cb0c9c9bc1adc841a3b05ad48e0$exports&&$da6e6cb0c9c9bc1adc841a3b05ad48e0$exports.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$__importStar=$da6e6cb0c9c9bc1adc841a3b05ad48e0$exports&&$da6e6cb0c9c9bc1adc841a3b05ad48e0$exports.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)"default"!==t&&Object.hasOwnProperty.call(e,t)&&$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$__createBinding(a,e,t);return $da6e6cb0c9c9bc1adc841a3b05ad48e0$var$__setModuleDefault(a,e),a};Object.defineProperty($da6e6cb0c9c9bc1adc841a3b05ad48e0$exports,"__esModule",{value:!0});var $da6e6cb0c9c9bc1adc841a3b05ad48e0$export$Chrome55=void 0;$da6e6cb0c9c9bc1adc841a3b05ad48e0$exports.Chrome55=$da6e6cb0c9c9bc1adc841a3b05ad48e0$export$Chrome55;const $da6e6cb0c9c9bc1adc841a3b05ad48e0$var$sdpTransform=$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$__importStar($b905cbabdece2b7ed3d885dc9ff42ac0$exports),$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$utils=$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$__importStar($6abc7ab33e1327c2d411a5fc6b37fe23$exports),$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$ortc=$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$__importStar($c14b343179c41479c8bdeecb64f7be76$exports),$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$sdpCommonUtils=$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$__importStar($d52929f92c17dce5cc60b70ec647fedb$exports),$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$sdpPlanBUtils=$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$__importStar($95414416f142b78649b3036f3acc7f22$exports),$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger=new $1495c7c2155b511d7a7eba88d183bc8a$exports.Logger("Chrome55"),$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$SCTP_NUM_STREAMS={OS:1024,MIS:1024};class $da6e6cb0c9c9bc1adc841a3b05ad48e0$var$Chrome55 extends $cc0c0c04507cca8137231b297300d331$exports.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new $da6e6cb0c9c9bc1adc841a3b05ad48e0$var$Chrome55}get name(){return"Chrome55"}close(){if($da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const a=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const t=$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$sdpTransform.parse(a.sdp);return $da6e6cb0c9c9bc1adc841a3b05ad48e0$var$sdpCommonUtils.extractRtpCapabilities({sdpObject:t})}catch(a){try{e.close()}catch(e){}throw a}}async getNativeSctpCapabilities(){return $da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("getNativeSctpCapabilities()"),{numStreams:$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$SCTP_NUM_STREAMS}}run({direction:e,iceParameters:a,iceCandidates:t,dtlsParameters:r,sctpParameters:c,iceServers:s,iceTransportPolicy:d,additionalSettings:i,proprietaryConstraints:o,extendedRtpCapabilities:n}){$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("run()"),this._direction=e,this._remoteSdp=new $2aa38523a6b418a7db72b14d2d309ee6$exports.RemoteSdp({iceParameters:a,iceCandidates:t,dtlsParameters:r,sctpParameters:c,planB:!0}),this._sendingRtpParametersByKind={audio:$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$ortc.getSendingRtpParameters("audio",n),video:$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$ortc.getSendingRtpParameters("video",n)},this._sendingRemoteRtpParametersByKind={audio:$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$ortc.getSendingRemoteRtpParameters("audio",n),video:$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$ortc.getSendingRemoteRtpParameters("video",n)},this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:d||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},i),o),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("updateIceServers()");const a=this._pc.getConfiguration();a.iceServers=e,this._pc.setConfiguration(a)}async restartIce(e){if($da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const a={type:"answer",sdp:this._remoteSdp.getSdp()};$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const a=await this._pc.createAnswer();$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:a,codecOptions:t,codec:r}){this._assertSendDirection(),$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),r&&$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let c,s=await this._pc.createOffer(),d=$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$sdpTransform.parse(s.sdp);const i=$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$utils.clone(this._sendingRtpParametersByKind[e.kind],{});i.codecs=$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$ortc.reduceCodecs(i.codecs);const o=$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$utils.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(o.codecs=$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$ortc.reduceCodecs(o.codecs),this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:d}),"video"===e.kind&&a&&a.length>1&&($da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("send() | enabling simulcast"),d=$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$sdpTransform.parse(s.sdp),c=d.media.find((e=>"video"===e.type)),$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$sdpPlanBUtils.addLegacySimulcast({offerMediaObject:c,track:e,numStreams:a.length}),s={type:"offer",sdp:$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$sdpTransform.write(d)}),$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s),d=$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$sdpTransform.parse(this._pc.localDescription.sdp),c=d.media.find((a=>a.type===e.kind)),i.rtcp.cname=$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$sdpCommonUtils.getCname({offerMediaObject:c}),i.encodings=$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$sdpPlanBUtils.getRtpEncodings({offerMediaObject:c,track:e}),a)for(let e=0;e<i.encodings.length;++e)a[e]&&Object.assign(i.encodings[e],a[e]);if(i.encodings.length>1&&"video/vp8"===i.codecs[0].mimeType.toLowerCase())for(const e of i.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:c,offerRtpParameters:i,answerRtpParameters:o,codecOptions:t});const n={type:"answer",sdp:this._remoteSdp.getSdp()};$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("send() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n);const f=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(f,e),{localId:f,rtpParameters:i}}async stopSending(e){this._assertSendDirection(),$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("stopSending() [localId:%s]",e);const a=this._mapSendLocalIdTrack.get(e);if(!a)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(a),this._pc.addStream(this._sendStream);const t=await this._pc.createOffer();$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t);try{await this._pc.setLocalDescription(t)}catch(e){if(0===this._sendStream.getTracks().length)return void $da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"===this._pc.signalingState)return;const r={type:"answer",sdp:this._remoteSdp.getSdp()};$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async replaceTrack(e,a){throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,a){throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError(" not implemented")}async setRtpEncodingParameters(e,a){throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("not supported")}async getSenderStats(e){throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:a,maxRetransmits:t,label:r,protocol:c,priority:s}){this._assertSendDirection();const d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:t,protocol:c,priority:s};$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("sendDataChannel() [options:%o]",d);const i=this._pc.createDataChannel(r,d);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$SCTP_NUM_STREAMS.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),a=$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$sdpTransform.parse(e.sdp),t=a.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:a}),$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:t});const r={type:"answer",sdp:this._remoteSdp.getSdp()};$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r),this._hasDataChannelMediaSection=!0}return{dataChannel:i,sctpStreamParameters:{streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits}}}async receive({trackId:e,kind:a,rtpParameters:t}){this._assertRecvDirection(),$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("receive() [trackId:%s, kind:%s]",e,a);const r=e,c=a,s=t.rtcp.cname;this._remoteSdp.receive({mid:c,kind:a,offerRtpParameters:t,streamId:s,trackId:e});const d={type:"offer",sdp:this._remoteSdp.getSdp()};$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d);let i=await this._pc.createAnswer();const o=$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$sdpTransform.parse(i.sdp),n=o.media.find((e=>String(e.mid)===c));$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$sdpCommonUtils.applyCodecParameters({offerRtpParameters:t,answerMediaObject:n}),i={type:"answer",sdp:$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$sdpTransform.write(o)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:o}),$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);const f=this._pc.getRemoteStreams().find((e=>e.id===s)).getTrackById(r);if(!f)throw new Error("remote track not found");return this._mapRecvLocalIdInfo.set(r,{mid:c,rtpParameters:t}),{localId:r,track:f}}async stopReceiving(e){this._assertRecvDirection(),$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("stopReceiving() [localId:%s]",e);const{mid:a,rtpParameters:t}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:a,offerRtpParameters:t});const r={type:"offer",sdp:this._remoteSdp.getSdp()};$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const c=await this._pc.createAnswer();$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}async getReceiverStats(e){throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:a,protocol:t}){this._assertRecvDirection();const{streamId:r,ordered:c,maxPacketLifeTime:s,maxRetransmits:d}=e,i={negotiated:!0,id:r,ordered:c,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:d,protocol:t};$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("receiveDataChannel() [options:%o]",i);const o=this._pc.createDataChannel(a,i);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const a=await this._pc.createAnswer();if(!this._transportReady){const e=$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$sdpTransform.parse(a.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setLocalDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:o}}async _setupTransport({localDtlsRole:e,localSdpObject:a}){a||(a=$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$sdpTransform.parse(this._pc.localDescription.sdp));const t=$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$sdpCommonUtils.extractDtlsParameters({sdpObject:a});t.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:t}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}$da6e6cb0c9c9bc1adc841a3b05ad48e0$export$Chrome55=$da6e6cb0c9c9bc1adc841a3b05ad48e0$var$Chrome55,$da6e6cb0c9c9bc1adc841a3b05ad48e0$exports.Chrome55=$da6e6cb0c9c9bc1adc841a3b05ad48e0$export$Chrome55;var $18e9bd9c8d78496d027f1375b29ceee9$exports={},$18e9bd9c8d78496d027f1375b29ceee9$var$__createBinding=$18e9bd9c8d78496d027f1375b29ceee9$exports&&$18e9bd9c8d78496d027f1375b29ceee9$exports.__createBinding||(Object.create?function(e,a,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,r){void 0===r&&(r=t),e[r]=a[t]}),$18e9bd9c8d78496d027f1375b29ceee9$var$__setModuleDefault=$18e9bd9c8d78496d027f1375b29ceee9$exports&&$18e9bd9c8d78496d027f1375b29ceee9$exports.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),$18e9bd9c8d78496d027f1375b29ceee9$var$__importStar=$18e9bd9c8d78496d027f1375b29ceee9$exports&&$18e9bd9c8d78496d027f1375b29ceee9$exports.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)"default"!==t&&Object.hasOwnProperty.call(e,t)&&$18e9bd9c8d78496d027f1375b29ceee9$var$__createBinding(a,e,t);return $18e9bd9c8d78496d027f1375b29ceee9$var$__setModuleDefault(a,e),a};Object.defineProperty($18e9bd9c8d78496d027f1375b29ceee9$exports,"__esModule",{value:!0});var $18e9bd9c8d78496d027f1375b29ceee9$export$Firefox60=void 0;$18e9bd9c8d78496d027f1375b29ceee9$exports.Firefox60=$18e9bd9c8d78496d027f1375b29ceee9$export$Firefox60;const $18e9bd9c8d78496d027f1375b29ceee9$var$sdpTransform=$18e9bd9c8d78496d027f1375b29ceee9$var$__importStar($b905cbabdece2b7ed3d885dc9ff42ac0$exports),$18e9bd9c8d78496d027f1375b29ceee9$var$utils=$18e9bd9c8d78496d027f1375b29ceee9$var$__importStar($6abc7ab33e1327c2d411a5fc6b37fe23$exports),$18e9bd9c8d78496d027f1375b29ceee9$var$ortc=$18e9bd9c8d78496d027f1375b29ceee9$var$__importStar($c14b343179c41479c8bdeecb64f7be76$exports),$18e9bd9c8d78496d027f1375b29ceee9$var$sdpCommonUtils=$18e9bd9c8d78496d027f1375b29ceee9$var$__importStar($d52929f92c17dce5cc60b70ec647fedb$exports),$18e9bd9c8d78496d027f1375b29ceee9$var$sdpUnifiedPlanUtils=$18e9bd9c8d78496d027f1375b29ceee9$var$__importStar($9ea9aaf7fac84dd2d2be874016e3619c$exports),$18e9bd9c8d78496d027f1375b29ceee9$var$logger=new $1495c7c2155b511d7a7eba88d183bc8a$exports.Logger("Firefox60"),$18e9bd9c8d78496d027f1375b29ceee9$var$SCTP_NUM_STREAMS={OS:16,MIS:2048};class $18e9bd9c8d78496d027f1375b29ceee9$var$Firefox60 extends $cc0c0c04507cca8137231b297300d331$exports.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new $18e9bd9c8d78496d027f1375b29ceee9$var$Firefox60}get name(){return"Firefox60"}close(){if($18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),a=document.createElement("canvas");a.getContext("2d");const t=a.captureStream().getVideoTracks()[0];try{e.addTransceiver("audio",{direction:"sendrecv"});const r=e.addTransceiver(t,{direction:"sendrecv"}),c=r.sender.getParameters(),s=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];c.encodings=s,await r.sender.setParameters(c);const d=await e.createOffer();try{a.remove()}catch(e){}try{t.stop()}catch(e){}try{e.close()}catch(e){}const i=$18e9bd9c8d78496d027f1375b29ceee9$var$sdpTransform.parse(d.sdp);return $18e9bd9c8d78496d027f1375b29ceee9$var$sdpCommonUtils.extractRtpCapabilities({sdpObject:i})}catch(r){try{a.remove()}catch(e){}try{t.stop()}catch(e){}try{e.close()}catch(e){}throw r}}async getNativeSctpCapabilities(){return $18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("getNativeSctpCapabilities()"),{numStreams:$18e9bd9c8d78496d027f1375b29ceee9$var$SCTP_NUM_STREAMS}}run({direction:e,iceParameters:a,iceCandidates:t,dtlsParameters:r,sctpParameters:c,iceServers:s,iceTransportPolicy:d,additionalSettings:i,proprietaryConstraints:o,extendedRtpCapabilities:n}){$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("run()"),this._direction=e,this._remoteSdp=new $2aa38523a6b418a7db72b14d2d309ee6$exports.RemoteSdp({iceParameters:a,iceCandidates:t,dtlsParameters:r,sctpParameters:c}),this._sendingRtpParametersByKind={audio:$18e9bd9c8d78496d027f1375b29ceee9$var$ortc.getSendingRtpParameters("audio",n),video:$18e9bd9c8d78496d027f1375b29ceee9$var$ortc.getSendingRtpParameters("video",n)},this._sendingRemoteRtpParametersByKind={audio:$18e9bd9c8d78496d027f1375b29ceee9$var$ortc.getSendingRemoteRtpParameters("audio",n),video:$18e9bd9c8d78496d027f1375b29ceee9$var$ortc.getSendingRemoteRtpParameters("video",n)},this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:d||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},i),o),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("not supported")}async restartIce(e){if($18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const a={type:"answer",sdp:this._remoteSdp.getSdp()};$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const a=await this._pc.createAnswer();$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:a,codecOptions:t,codec:r}){this._assertSendDirection(),$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),a&&(a=$18e9bd9c8d78496d027f1375b29ceee9$var$utils.clone(a,[])).length>1&&(a.forEach(((e,a)=>{e.rid=`r${a}`})),a.reverse());const c=$18e9bd9c8d78496d027f1375b29ceee9$var$utils.clone(this._sendingRtpParametersByKind[e.kind],{});c.codecs=$18e9bd9c8d78496d027f1375b29ceee9$var$ortc.reduceCodecs(c.codecs,r);const s=$18e9bd9c8d78496d027f1375b29ceee9$var$utils.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});s.codecs=$18e9bd9c8d78496d027f1375b29ceee9$var$ortc.reduceCodecs(s.codecs,r);const d=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});if(a){const e=d.sender.getParameters();e.encodings=a,await d.sender.setParameters(e)}const i=await this._pc.createOffer();let o=$18e9bd9c8d78496d027f1375b29ceee9$var$sdpTransform.parse(i.sdp);this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:o}),$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("send() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const n=d.mid;c.mid=n,o=$18e9bd9c8d78496d027f1375b29ceee9$var$sdpTransform.parse(this._pc.localDescription.sdp);const f=o.media[o.media.length-1];if(c.rtcp.cname=$18e9bd9c8d78496d027f1375b29ceee9$var$sdpCommonUtils.getCname({offerMediaObject:f}),a)if(1===a.length){const e=$18e9bd9c8d78496d027f1375b29ceee9$var$sdpUnifiedPlanUtils.getRtpEncodings({offerMediaObject:f});Object.assign(e[0],a[0]),c.encodings=e}else c.encodings=a.reverse();else c.encodings=$18e9bd9c8d78496d027f1375b29ceee9$var$sdpUnifiedPlanUtils.getRtpEncodings({offerMediaObject:f});if(c.encodings.length>1&&("video/vp8"===c.codecs[0].mimeType.toLowerCase()||"video/h264"===c.codecs[0].mimeType.toLowerCase()))for(const e of c.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:f,offerRtpParameters:c,answerRtpParameters:s,codecOptions:t,extmapAllowMixed:!0});const $={type:"answer",sdp:this._remoteSdp.getSdp()};return $18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("send() | calling pc.setRemoteDescription() [answer:%o]",$),await this._pc.setRemoteDescription($),this._mapMidTransceiver.set(n,d),{localId:n,rtpParameters:c,rtpSender:d.sender}}async stopSending(e){$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("stopSending() [localId:%s]",e);const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated transceiver not found");a.sender.replaceTrack(null),this._pc.removeTrack(a.sender),this._remoteSdp.disableMediaSection(a.mid);const t=await this._pc.createOffer();$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const r={type:"answer",sdp:this._remoteSdp.getSdp()};$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async replaceTrack(e,a){this._assertSendDirection(),a?$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("replaceTrack() [localId:%s, track.id:%s]",e,a.id):$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("replaceTrack() [localId:%s, no track]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");await t.sender.replaceTrack(a)}async setMaxSpatialLayer(e,a){this._assertSendDirection(),$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,a);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");const r=t.sender.getParameters();a=r.encodings.length-1-a,r.encodings.forEach(((e,t)=>{e.active=t>=a})),await t.sender.setParameters(r)}async setRtpEncodingParameters(e,a){this._assertSendDirection(),$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,a);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach(((e,t)=>{r.encodings[t]=Object.assign(Object.assign({},e),a)})),await t.sender.setParameters(r)}async getSenderStats(e){this._assertSendDirection();const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");return a.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:a,maxRetransmits:t,label:r,protocol:c,priority:s}){this._assertSendDirection();const d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:a,maxRetransmits:t,protocol:c,priority:s};$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("sendDataChannel() [options:%o]",d);const i=this._pc.createDataChannel(r,d);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%$18e9bd9c8d78496d027f1375b29ceee9$var$SCTP_NUM_STREAMS.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),a=$18e9bd9c8d78496d027f1375b29ceee9$var$sdpTransform.parse(e.sdp),t=a.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:a}),$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:t});const r={type:"answer",sdp:this._remoteSdp.getSdp()};$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r),this._hasDataChannelMediaSection=!0}return{dataChannel:i,sctpStreamParameters:{streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits}}}async receive({trackId:e,kind:a,rtpParameters:t}){this._assertRecvDirection(),$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("receive() [trackId:%s, kind:%s]",e,a);const r=t.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:r,kind:a,offerRtpParameters:t,streamId:t.rtcp.cname,trackId:e});const c={type:"offer",sdp:this._remoteSdp.getSdp()};$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let s=await this._pc.createAnswer();const d=$18e9bd9c8d78496d027f1375b29ceee9$var$sdpTransform.parse(s.sdp),i=d.media.find((e=>String(e.mid)===r));$18e9bd9c8d78496d027f1375b29ceee9$var$sdpCommonUtils.applyCodecParameters({offerRtpParameters:t,answerMediaObject:i}),s={type:"answer",sdp:$18e9bd9c8d78496d027f1375b29ceee9$var$sdpTransform.write(d)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:d}),$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);const o=this._pc.getTransceivers().find((e=>e.mid===r));if(!o)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(r,o),{localId:r,track:o.receiver.track,rtpReceiver:o.receiver}}async stopReceiving(e){this._assertRecvDirection(),$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("stopReceiving() [localId:%s]",e);const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid);const t={type:"offer",sdp:this._remoteSdp.getSdp()};$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(e){this._assertRecvDirection();const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");return a.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:a,protocol:t}){this._assertRecvDirection();const{streamId:r,ordered:c,maxPacketLifeTime:s,maxRetransmits:d}=e,i={negotiated:!0,id:r,ordered:c,maxPacketLifeTime:s,maxRetransmits:d,protocol:t};$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("receiveDataChannel() [options:%o]",i);const o=this._pc.createDataChannel(a,i);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const a=await this._pc.createAnswer();if(!this._transportReady){const e=$18e9bd9c8d78496d027f1375b29ceee9$var$sdpTransform.parse(a.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}$18e9bd9c8d78496d027f1375b29ceee9$var$logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setLocalDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:o}}async _setupTransport({localDtlsRole:e,localSdpObject:a}){a||(a=$18e9bd9c8d78496d027f1375b29ceee9$var$sdpTransform.parse(this._pc.localDescription.sdp));const t=$18e9bd9c8d78496d027f1375b29ceee9$var$sdpCommonUtils.extractDtlsParameters({sdpObject:a});t.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:t}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}$18e9bd9c8d78496d027f1375b29ceee9$export$Firefox60=$18e9bd9c8d78496d027f1375b29ceee9$var$Firefox60,$18e9bd9c8d78496d027f1375b29ceee9$exports.Firefox60=$18e9bd9c8d78496d027f1375b29ceee9$export$Firefox60;var $9f79eaaf7465a254ff8a5c616b8f0c5e$exports={},$9f79eaaf7465a254ff8a5c616b8f0c5e$var$__createBinding=$9f79eaaf7465a254ff8a5c616b8f0c5e$exports&&$9f79eaaf7465a254ff8a5c616b8f0c5e$exports.__createBinding||(Object.create?function(e,a,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,r){void 0===r&&(r=t),e[r]=a[t]}),$9f79eaaf7465a254ff8a5c616b8f0c5e$var$__setModuleDefault=$9f79eaaf7465a254ff8a5c616b8f0c5e$exports&&$9f79eaaf7465a254ff8a5c616b8f0c5e$exports.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),$9f79eaaf7465a254ff8a5c616b8f0c5e$var$__importStar=$9f79eaaf7465a254ff8a5c616b8f0c5e$exports&&$9f79eaaf7465a254ff8a5c616b8f0c5e$exports.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)"default"!==t&&Object.hasOwnProperty.call(e,t)&&$9f79eaaf7465a254ff8a5c616b8f0c5e$var$__createBinding(a,e,t);return $9f79eaaf7465a254ff8a5c616b8f0c5e$var$__setModuleDefault(a,e),a};Object.defineProperty($9f79eaaf7465a254ff8a5c616b8f0c5e$exports,"__esModule",{value:!0});var $9f79eaaf7465a254ff8a5c616b8f0c5e$export$Safari12=void 0;$9f79eaaf7465a254ff8a5c616b8f0c5e$exports.Safari12=$9f79eaaf7465a254ff8a5c616b8f0c5e$export$Safari12;const $9f79eaaf7465a254ff8a5c616b8f0c5e$var$sdpTransform=$9f79eaaf7465a254ff8a5c616b8f0c5e$var$__importStar($b905cbabdece2b7ed3d885dc9ff42ac0$exports),$9f79eaaf7465a254ff8a5c616b8f0c5e$var$utils=$9f79eaaf7465a254ff8a5c616b8f0c5e$var$__importStar($6abc7ab33e1327c2d411a5fc6b37fe23$exports),$9f79eaaf7465a254ff8a5c616b8f0c5e$var$ortc=$9f79eaaf7465a254ff8a5c616b8f0c5e$var$__importStar($c14b343179c41479c8bdeecb64f7be76$exports),$9f79eaaf7465a254ff8a5c616b8f0c5e$var$sdpCommonUtils=$9f79eaaf7465a254ff8a5c616b8f0c5e$var$__importStar($d52929f92c17dce5cc60b70ec647fedb$exports),$9f79eaaf7465a254ff8a5c616b8f0c5e$var$sdpUnifiedPlanUtils=$9f79eaaf7465a254ff8a5c616b8f0c5e$var$__importStar($9ea9aaf7fac84dd2d2be874016e3619c$exports),$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger=new $1495c7c2155b511d7a7eba88d183bc8a$exports.Logger("Safari12"),$9f79eaaf7465a254ff8a5c616b8f0c5e$var$SCTP_NUM_STREAMS={OS:1024,MIS:1024};class $9f79eaaf7465a254ff8a5c616b8f0c5e$var$Safari12 extends $cc0c0c04507cca8137231b297300d331$exports.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new $9f79eaaf7465a254ff8a5c616b8f0c5e$var$Safari12}get name(){return"Safari12"}close(){if($9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const a=await e.createOffer();try{e.close()}catch(e){}const t=$9f79eaaf7465a254ff8a5c616b8f0c5e$var$sdpTransform.parse(a.sdp);return $9f79eaaf7465a254ff8a5c616b8f0c5e$var$sdpCommonUtils.extractRtpCapabilities({sdpObject:t})}catch(a){try{e.close()}catch(e){}throw a}}async getNativeSctpCapabilities(){return $9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("getNativeSctpCapabilities()"),{numStreams:$9f79eaaf7465a254ff8a5c616b8f0c5e$var$SCTP_NUM_STREAMS}}run({direction:e,iceParameters:a,iceCandidates:t,dtlsParameters:r,sctpParameters:c,iceServers:s,iceTransportPolicy:d,additionalSettings:i,proprietaryConstraints:o,extendedRtpCapabilities:n}){$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("run()"),this._direction=e,this._remoteSdp=new $2aa38523a6b418a7db72b14d2d309ee6$exports.RemoteSdp({iceParameters:a,iceCandidates:t,dtlsParameters:r,sctpParameters:c}),this._sendingRtpParametersByKind={audio:$9f79eaaf7465a254ff8a5c616b8f0c5e$var$ortc.getSendingRtpParameters("audio",n),video:$9f79eaaf7465a254ff8a5c616b8f0c5e$var$ortc.getSendingRtpParameters("video",n)},this._sendingRemoteRtpParametersByKind={audio:$9f79eaaf7465a254ff8a5c616b8f0c5e$var$ortc.getSendingRemoteRtpParameters("audio",n),video:$9f79eaaf7465a254ff8a5c616b8f0c5e$var$ortc.getSendingRemoteRtpParameters("video",n)},this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:d||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},i),o),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("updateIceServers()");const a=this._pc.getConfiguration();a.iceServers=e,this._pc.setConfiguration(a)}async restartIce(e){if($9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const a={type:"answer",sdp:this._remoteSdp.getSdp()};$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const a=await this._pc.createAnswer();$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:a,codecOptions:t,codec:r}){this._assertSendDirection(),$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const c=$9f79eaaf7465a254ff8a5c616b8f0c5e$var$utils.clone(this._sendingRtpParametersByKind[e.kind],{});c.codecs=$9f79eaaf7465a254ff8a5c616b8f0c5e$var$ortc.reduceCodecs(c.codecs,r);const s=$9f79eaaf7465a254ff8a5c616b8f0c5e$var$utils.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});s.codecs=$9f79eaaf7465a254ff8a5c616b8f0c5e$var$ortc.reduceCodecs(s.codecs,r);const d=this._remoteSdp.getNextMediaSectionIdx(),i=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let o,n=await this._pc.createOffer(),f=$9f79eaaf7465a254ff8a5c616b8f0c5e$var$sdpTransform.parse(n.sdp);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:f}),a&&a.length>1&&($9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("send() | enabling legacy simulcast"),f=$9f79eaaf7465a254ff8a5c616b8f0c5e$var$sdpTransform.parse(n.sdp),o=f.media[d.idx],$9f79eaaf7465a254ff8a5c616b8f0c5e$var$sdpUnifiedPlanUtils.addLegacySimulcast({offerMediaObject:o,numStreams:a.length}),n={type:"offer",sdp:$9f79eaaf7465a254ff8a5c616b8f0c5e$var$sdpTransform.write(f)}),$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("send() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const $=i.mid;if(c.mid=$,f=$9f79eaaf7465a254ff8a5c616b8f0c5e$var$sdpTransform.parse(this._pc.localDescription.sdp),o=f.media[d.idx],c.rtcp.cname=$9f79eaaf7465a254ff8a5c616b8f0c5e$var$sdpCommonUtils.getCname({offerMediaObject:o}),c.encodings=$9f79eaaf7465a254ff8a5c616b8f0c5e$var$sdpUnifiedPlanUtils.getRtpEncodings({offerMediaObject:o}),a)for(let e=0;e<c.encodings.length;++e)a[e]&&Object.assign(c.encodings[e],a[e]);if(c.encodings.length>1&&("video/vp8"===c.codecs[0].mimeType.toLowerCase()||"video/h264"===c.codecs[0].mimeType.toLowerCase()))for(const e of c.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:o,reuseMid:d.reuseMid,offerRtpParameters:c,answerRtpParameters:s,codecOptions:t});const b={type:"answer",sdp:this._remoteSdp.getSdp()};return $9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("send() | calling pc.setRemoteDescription() [answer:%o]",b),await this._pc.setRemoteDescription(b),this._mapMidTransceiver.set($,i),{localId:$,rtpParameters:c,rtpSender:i.sender}}async stopSending(e){this._assertSendDirection(),$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("stopSending() [localId:%s]",e);const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.sender.replaceTrack(null),this._pc.removeTrack(a.sender),this._remoteSdp.closeMediaSection(a.mid);const t=await this._pc.createOffer();$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const r={type:"answer",sdp:this._remoteSdp.getSdp()};$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async replaceTrack(e,a){this._assertSendDirection(),a?$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("replaceTrack() [localId:%s, track.id:%s]",e,a.id):$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("replaceTrack() [localId:%s, no track]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");await t.sender.replaceTrack(a)}async setMaxSpatialLayer(e,a){this._assertSendDirection(),$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,a);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach(((e,t)=>{e.active=t<=a})),await t.sender.setParameters(r)}async setRtpEncodingParameters(e,a){this._assertSendDirection(),$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,a);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach(((e,t)=>{r.encodings[t]=Object.assign(Object.assign({},e),a)})),await t.sender.setParameters(r)}async getSenderStats(e){this._assertSendDirection();const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");return a.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:a,maxRetransmits:t,label:r,protocol:c,priority:s}){this._assertSendDirection();const d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:a,maxRetransmits:t,protocol:c,priority:s};$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("sendDataChannel() [options:%o]",d);const i=this._pc.createDataChannel(r,d);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%$9f79eaaf7465a254ff8a5c616b8f0c5e$var$SCTP_NUM_STREAMS.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),a=$9f79eaaf7465a254ff8a5c616b8f0c5e$var$sdpTransform.parse(e.sdp),t=a.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:a}),$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:t});const r={type:"answer",sdp:this._remoteSdp.getSdp()};$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r),this._hasDataChannelMediaSection=!0}return{dataChannel:i,sctpStreamParameters:{streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits}}}async receive({trackId:e,kind:a,rtpParameters:t}){this._assertRecvDirection(),$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("receive() [trackId:%s, kind:%s]",e,a);const r=t.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:r,kind:a,offerRtpParameters:t,streamId:t.rtcp.cname,trackId:e});const c={type:"offer",sdp:this._remoteSdp.getSdp()};$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let s=await this._pc.createAnswer();const d=$9f79eaaf7465a254ff8a5c616b8f0c5e$var$sdpTransform.parse(s.sdp),i=d.media.find((e=>String(e.mid)===r));$9f79eaaf7465a254ff8a5c616b8f0c5e$var$sdpCommonUtils.applyCodecParameters({offerRtpParameters:t,answerMediaObject:i}),s={type:"answer",sdp:$9f79eaaf7465a254ff8a5c616b8f0c5e$var$sdpTransform.write(d)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:d}),$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);const o=this._pc.getTransceivers().find((e=>e.mid===r));if(!o)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(r,o),{localId:r,track:o.receiver.track,rtpReceiver:o.receiver}}async stopReceiving(e){this._assertRecvDirection(),$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("stopReceiving() [localId:%s]",e);const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid);const t={type:"offer",sdp:this._remoteSdp.getSdp()};$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(e){this._assertRecvDirection();const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");return a.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:a,protocol:t}){this._assertRecvDirection();const{streamId:r,ordered:c,maxPacketLifeTime:s,maxRetransmits:d}=e,i={negotiated:!0,id:r,ordered:c,maxPacketLifeTime:s,maxRetransmits:d,protocol:t};$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("receiveDataChannel() [options:%o]",i);const o=this._pc.createDataChannel(a,i);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const a=await this._pc.createAnswer();if(!this._transportReady){const e=$9f79eaaf7465a254ff8a5c616b8f0c5e$var$sdpTransform.parse(a.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}$9f79eaaf7465a254ff8a5c616b8f0c5e$var$logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setLocalDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:o}}async _setupTransport({localDtlsRole:e,localSdpObject:a}){a||(a=$9f79eaaf7465a254ff8a5c616b8f0c5e$var$sdpTransform.parse(this._pc.localDescription.sdp));const t=$9f79eaaf7465a254ff8a5c616b8f0c5e$var$sdpCommonUtils.extractDtlsParameters({sdpObject:a});t.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:t}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}$9f79eaaf7465a254ff8a5c616b8f0c5e$export$Safari12=$9f79eaaf7465a254ff8a5c616b8f0c5e$var$Safari12,$9f79eaaf7465a254ff8a5c616b8f0c5e$exports.Safari12=$9f79eaaf7465a254ff8a5c616b8f0c5e$export$Safari12;var $4a2af2708bb3e4b82830beeecde2e434$exports={},$4a2af2708bb3e4b82830beeecde2e434$var$__createBinding=$4a2af2708bb3e4b82830beeecde2e434$exports&&$4a2af2708bb3e4b82830beeecde2e434$exports.__createBinding||(Object.create?function(e,a,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,r){void 0===r&&(r=t),e[r]=a[t]}),$4a2af2708bb3e4b82830beeecde2e434$var$__setModuleDefault=$4a2af2708bb3e4b82830beeecde2e434$exports&&$4a2af2708bb3e4b82830beeecde2e434$exports.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),$4a2af2708bb3e4b82830beeecde2e434$var$__importStar=$4a2af2708bb3e4b82830beeecde2e434$exports&&$4a2af2708bb3e4b82830beeecde2e434$exports.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)"default"!==t&&Object.hasOwnProperty.call(e,t)&&$4a2af2708bb3e4b82830beeecde2e434$var$__createBinding(a,e,t);return $4a2af2708bb3e4b82830beeecde2e434$var$__setModuleDefault(a,e),a};Object.defineProperty($4a2af2708bb3e4b82830beeecde2e434$exports,"__esModule",{value:!0});var $4a2af2708bb3e4b82830beeecde2e434$export$Safari11=void 0;$4a2af2708bb3e4b82830beeecde2e434$exports.Safari11=$4a2af2708bb3e4b82830beeecde2e434$export$Safari11;const $4a2af2708bb3e4b82830beeecde2e434$var$sdpTransform=$4a2af2708bb3e4b82830beeecde2e434$var$__importStar($b905cbabdece2b7ed3d885dc9ff42ac0$exports),$4a2af2708bb3e4b82830beeecde2e434$var$utils=$4a2af2708bb3e4b82830beeecde2e434$var$__importStar($6abc7ab33e1327c2d411a5fc6b37fe23$exports),$4a2af2708bb3e4b82830beeecde2e434$var$ortc=$4a2af2708bb3e4b82830beeecde2e434$var$__importStar($c14b343179c41479c8bdeecb64f7be76$exports),$4a2af2708bb3e4b82830beeecde2e434$var$sdpCommonUtils=$4a2af2708bb3e4b82830beeecde2e434$var$__importStar($d52929f92c17dce5cc60b70ec647fedb$exports),$4a2af2708bb3e4b82830beeecde2e434$var$sdpPlanBUtils=$4a2af2708bb3e4b82830beeecde2e434$var$__importStar($95414416f142b78649b3036f3acc7f22$exports),$4a2af2708bb3e4b82830beeecde2e434$var$logger=new $1495c7c2155b511d7a7eba88d183bc8a$exports.Logger("Safari11"),$4a2af2708bb3e4b82830beeecde2e434$var$SCTP_NUM_STREAMS={OS:1024,MIS:1024};class $4a2af2708bb3e4b82830beeecde2e434$var$Safari11 extends $cc0c0c04507cca8137231b297300d331$exports.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new $4a2af2708bb3e4b82830beeecde2e434$var$Safari11}get name(){return"Safari11"}close(){if($4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const a=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const t=$4a2af2708bb3e4b82830beeecde2e434$var$sdpTransform.parse(a.sdp);return $4a2af2708bb3e4b82830beeecde2e434$var$sdpCommonUtils.extractRtpCapabilities({sdpObject:t})}catch(a){try{e.close()}catch(e){}throw a}}async getNativeSctpCapabilities(){return $4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("getNativeSctpCapabilities()"),{numStreams:$4a2af2708bb3e4b82830beeecde2e434$var$SCTP_NUM_STREAMS}}run({direction:e,iceParameters:a,iceCandidates:t,dtlsParameters:r,sctpParameters:c,iceServers:s,iceTransportPolicy:d,additionalSettings:i,proprietaryConstraints:o,extendedRtpCapabilities:n}){$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("run()"),this._direction=e,this._remoteSdp=new $2aa38523a6b418a7db72b14d2d309ee6$exports.RemoteSdp({iceParameters:a,iceCandidates:t,dtlsParameters:r,sctpParameters:c,planB:!0}),this._sendingRtpParametersByKind={audio:$4a2af2708bb3e4b82830beeecde2e434$var$ortc.getSendingRtpParameters("audio",n),video:$4a2af2708bb3e4b82830beeecde2e434$var$ortc.getSendingRtpParameters("video",n)},this._sendingRemoteRtpParametersByKind={audio:$4a2af2708bb3e4b82830beeecde2e434$var$ortc.getSendingRemoteRtpParameters("audio",n),video:$4a2af2708bb3e4b82830beeecde2e434$var$ortc.getSendingRemoteRtpParameters("video",n)},this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:d||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},i),o),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("updateIceServers()");const a=this._pc.getConfiguration();a.iceServers=e,this._pc.setConfiguration(a)}async restartIce(e){if($4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const a={type:"answer",sdp:this._remoteSdp.getSdp()};$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const a=await this._pc.createAnswer();$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:a,codecOptions:t,codec:r}){this._assertSendDirection(),$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),r&&$4a2af2708bb3e4b82830beeecde2e434$var$logger.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let c,s=await this._pc.createOffer(),d=$4a2af2708bb3e4b82830beeecde2e434$var$sdpTransform.parse(s.sdp);const i=$4a2af2708bb3e4b82830beeecde2e434$var$utils.clone(this._sendingRtpParametersByKind[e.kind],{});i.codecs=$4a2af2708bb3e4b82830beeecde2e434$var$ortc.reduceCodecs(i.codecs);const o=$4a2af2708bb3e4b82830beeecde2e434$var$utils.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(o.codecs=$4a2af2708bb3e4b82830beeecde2e434$var$ortc.reduceCodecs(o.codecs),this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:d}),"video"===e.kind&&a&&a.length>1&&($4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("send() | enabling simulcast"),d=$4a2af2708bb3e4b82830beeecde2e434$var$sdpTransform.parse(s.sdp),c=d.media.find((e=>"video"===e.type)),$4a2af2708bb3e4b82830beeecde2e434$var$sdpPlanBUtils.addLegacySimulcast({offerMediaObject:c,track:e,numStreams:a.length}),s={type:"offer",sdp:$4a2af2708bb3e4b82830beeecde2e434$var$sdpTransform.write(d)}),$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s),d=$4a2af2708bb3e4b82830beeecde2e434$var$sdpTransform.parse(this._pc.localDescription.sdp),c=d.media.find((a=>a.type===e.kind)),i.rtcp.cname=$4a2af2708bb3e4b82830beeecde2e434$var$sdpCommonUtils.getCname({offerMediaObject:c}),i.encodings=$4a2af2708bb3e4b82830beeecde2e434$var$sdpPlanBUtils.getRtpEncodings({offerMediaObject:c,track:e}),a)for(let e=0;e<i.encodings.length;++e)a[e]&&Object.assign(i.encodings[e],a[e]);if(i.encodings.length>1&&"video/vp8"===i.codecs[0].mimeType.toLowerCase())for(const e of i.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:c,offerRtpParameters:i,answerRtpParameters:o,codecOptions:t});const n={type:"answer",sdp:this._remoteSdp.getSdp()};$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("send() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n);const f=String(this._nextSendLocalId);this._nextSendLocalId++;const $=this._pc.getSenders().find((a=>a.track===e));return this._mapSendLocalIdRtpSender.set(f,$),{localId:f,rtpParameters:i,rtpSender:$}}async stopSending(e){this._assertSendDirection();const a=this._mapSendLocalIdRtpSender.get(e);if(!a)throw new Error("associated RTCRtpSender not found");a.track&&this._sendStream.removeTrack(a.track),this._mapSendLocalIdRtpSender.delete(e);const t=await this._pc.createOffer();$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t);try{await this._pc.setLocalDescription(t)}catch(e){if(0===this._sendStream.getTracks().length)return void $4a2af2708bb3e4b82830beeecde2e434$var$logger.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"===this._pc.signalingState)return;const r={type:"answer",sdp:this._remoteSdp.getSdp()};$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async replaceTrack(e,a){this._assertSendDirection(),a?$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("replaceTrack() [localId:%s, track.id:%s]",e,a.id):$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("replaceTrack() [localId:%s, no track]",e);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");const r=t.track;await t.replaceTrack(a),r&&this._sendStream.removeTrack(r),a&&this._sendStream.addTrack(a)}async setMaxSpatialLayer(e,a){this._assertSendDirection(),$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,a);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");const r=t.getParameters();r.encodings.forEach(((e,t)=>{e.active=t<=a})),await t.setParameters(r)}async setRtpEncodingParameters(e,a){this._assertSendDirection(),$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,a);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");const r=t.getParameters();r.encodings.forEach(((e,t)=>{r.encodings[t]=Object.assign(Object.assign({},e),a)})),await t.setParameters(r)}async getSenderStats(e){this._assertSendDirection();const a=this._mapSendLocalIdRtpSender.get(e);if(!a)throw new Error("associated RTCRtpSender not found");return a.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:a,maxRetransmits:t,label:r,protocol:c,priority:s}){this._assertSendDirection();const d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:a,maxRetransmits:t,protocol:c,priority:s};$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("sendDataChannel() [options:%o]",d);const i=this._pc.createDataChannel(r,d);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%$4a2af2708bb3e4b82830beeecde2e434$var$SCTP_NUM_STREAMS.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),a=$4a2af2708bb3e4b82830beeecde2e434$var$sdpTransform.parse(e.sdp),t=a.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:a}),$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:t});const r={type:"answer",sdp:this._remoteSdp.getSdp()};$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r),this._hasDataChannelMediaSection=!0}return{dataChannel:i,sctpStreamParameters:{streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits}}}async receive({trackId:e,kind:a,rtpParameters:t}){this._assertRecvDirection(),$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("receive() [trackId:%s, kind:%s]",e,a);const r=e,c=a;this._remoteSdp.receive({mid:c,kind:a,offerRtpParameters:t,streamId:t.rtcp.cname,trackId:e});const s={type:"offer",sdp:this._remoteSdp.getSdp()};$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let d=await this._pc.createAnswer();const i=$4a2af2708bb3e4b82830beeecde2e434$var$sdpTransform.parse(d.sdp),o=i.media.find((e=>String(e.mid)===c));$4a2af2708bb3e4b82830beeecde2e434$var$sdpCommonUtils.applyCodecParameters({offerRtpParameters:t,answerMediaObject:o}),d={type:"answer",sdp:$4a2af2708bb3e4b82830beeecde2e434$var$sdpTransform.write(i)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:i}),$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);const n=this._pc.getReceivers().find((e=>e.track&&e.track.id===r));if(!n)throw new Error("new RTCRtpReceiver not");return this._mapRecvLocalIdInfo.set(r,{mid:c,rtpParameters:t,rtpReceiver:n}),{localId:r,track:n.track,rtpReceiver:n}}async stopReceiving(e){this._assertRecvDirection(),$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("stopReceiving() [localId:%s]",e);const{mid:a,rtpParameters:t}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:a,offerRtpParameters:t});const r={type:"offer",sdp:this._remoteSdp.getSdp()};$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const c=await this._pc.createAnswer();$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}async getReceiverStats(e){this._assertRecvDirection();const{rtpReceiver:a}=this._mapRecvLocalIdInfo.get(e)||{};if(!a)throw new Error("associated RTCRtpReceiver not found");return a.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:a,protocol:t}){this._assertRecvDirection();const{streamId:r,ordered:c,maxPacketLifeTime:s,maxRetransmits:d}=e,i={negotiated:!0,id:r,ordered:c,maxPacketLifeTime:s,maxRetransmits:d,protocol:t};$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("receiveDataChannel() [options:%o]",i);const o=this._pc.createDataChannel(a,i);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const a=await this._pc.createAnswer();if(!this._transportReady){const e=$4a2af2708bb3e4b82830beeecde2e434$var$sdpTransform.parse(a.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}$4a2af2708bb3e4b82830beeecde2e434$var$logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setLocalDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:o}}async _setupTransport({localDtlsRole:e,localSdpObject:a}){a||(a=$4a2af2708bb3e4b82830beeecde2e434$var$sdpTransform.parse(this._pc.localDescription.sdp));const t=$4a2af2708bb3e4b82830beeecde2e434$var$sdpCommonUtils.extractDtlsParameters({sdpObject:a});t.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:t}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}$4a2af2708bb3e4b82830beeecde2e434$export$Safari11=$4a2af2708bb3e4b82830beeecde2e434$var$Safari11,$4a2af2708bb3e4b82830beeecde2e434$exports.Safari11=$4a2af2708bb3e4b82830beeecde2e434$export$Safari11;var $598a700fa83066927b7fb86b77b7b937$exports={},$598a700fa83066927b7fb86b77b7b937$var$__createBinding=$598a700fa83066927b7fb86b77b7b937$exports&&$598a700fa83066927b7fb86b77b7b937$exports.__createBinding||(Object.create?function(e,a,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,r){void 0===r&&(r=t),e[r]=a[t]}),$598a700fa83066927b7fb86b77b7b937$var$__setModuleDefault=$598a700fa83066927b7fb86b77b7b937$exports&&$598a700fa83066927b7fb86b77b7b937$exports.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),$598a700fa83066927b7fb86b77b7b937$var$__importStar=$598a700fa83066927b7fb86b77b7b937$exports&&$598a700fa83066927b7fb86b77b7b937$exports.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)"default"!==t&&Object.hasOwnProperty.call(e,t)&&$598a700fa83066927b7fb86b77b7b937$var$__createBinding(a,e,t);return $598a700fa83066927b7fb86b77b7b937$var$__setModuleDefault(a,e),a};Object.defineProperty($598a700fa83066927b7fb86b77b7b937$exports,"__esModule",{value:!0});var $598a700fa83066927b7fb86b77b7b937$export$Edge11=void 0;$598a700fa83066927b7fb86b77b7b937$exports.Edge11=$598a700fa83066927b7fb86b77b7b937$export$Edge11;const $598a700fa83066927b7fb86b77b7b937$var$utils=$598a700fa83066927b7fb86b77b7b937$var$__importStar($6abc7ab33e1327c2d411a5fc6b37fe23$exports),$598a700fa83066927b7fb86b77b7b937$var$ortc=$598a700fa83066927b7fb86b77b7b937$var$__importStar($c14b343179c41479c8bdeecb64f7be76$exports);var $67bfc4f3dee823a1e5aae52efd0456d4$exports={},$67bfc4f3dee823a1e5aae52efd0456d4$var$__createBinding=$67bfc4f3dee823a1e5aae52efd0456d4$exports&&$67bfc4f3dee823a1e5aae52efd0456d4$exports.__createBinding||(Object.create?function(e,a,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,r){void 0===r&&(r=t),e[r]=a[t]}),$67bfc4f3dee823a1e5aae52efd0456d4$var$__setModuleDefault=$67bfc4f3dee823a1e5aae52efd0456d4$exports&&$67bfc4f3dee823a1e5aae52efd0456d4$exports.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),$67bfc4f3dee823a1e5aae52efd0456d4$var$__importStar=$67bfc4f3dee823a1e5aae52efd0456d4$exports&&$67bfc4f3dee823a1e5aae52efd0456d4$exports.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)"default"!==t&&Object.hasOwnProperty.call(e,t)&&$67bfc4f3dee823a1e5aae52efd0456d4$var$__createBinding(a,e,t);return $67bfc4f3dee823a1e5aae52efd0456d4$var$__setModuleDefault(a,e),a};Object.defineProperty($67bfc4f3dee823a1e5aae52efd0456d4$exports,"__esModule",{value:!0});var $67bfc4f3dee823a1e5aae52efd0456d4$export$mangleRtpParameters=($67bfc4f3dee823a1e5aae52efd0456d4$export$getCapabilities=void 0,$67bfc4f3dee823a1e5aae52efd0456d4$exports.getCapabilities=$67bfc4f3dee823a1e5aae52efd0456d4$export$getCapabilities);$67bfc4f3dee823a1e5aae52efd0456d4$exports.mangleRtpParameters=$67bfc4f3dee823a1e5aae52efd0456d4$export$mangleRtpParameters;const $67bfc4f3dee823a1e5aae52efd0456d4$var$utils=$67bfc4f3dee823a1e5aae52efd0456d4$var$__importStar($6abc7ab33e1327c2d411a5fc6b37fe23$exports);function $67bfc4f3dee823a1e5aae52efd0456d4$var$getCapabilities(){const e=RTCRtpReceiver.getCapabilities(),a=$67bfc4f3dee823a1e5aae52efd0456d4$var$utils.clone(e,{});for(const e of a.codecs){if(e.channels=e.numChannels,delete e.numChannels,e.mimeType=e.mimeType||`${e.kind}/${e.name}`,e.parameters){const a=e.parameters;a.apt&&(a.apt=Number(a.apt)),a["packetization-mode"]&&(a["packetization-mode"]=Number(a["packetization-mode"]))}for(const a of e.rtcpFeedback||[])a.parameter||(a.parameter="")}return a}var $67bfc4f3dee823a1e5aae52efd0456d4$export$getCapabilities=$67bfc4f3dee823a1e5aae52efd0456d4$var$getCapabilities;function $67bfc4f3dee823a1e5aae52efd0456d4$var$mangleRtpParameters(e){const a=$67bfc4f3dee823a1e5aae52efd0456d4$var$utils.clone(e,{});a.mid&&(a.muxId=a.mid,delete a.mid);for(const e of a.codecs)e.channels&&(e.numChannels=e.channels,delete e.channels),e.mimeType&&!e.name&&(e.name=e.mimeType.split("/")[1]),delete e.mimeType;return a}$67bfc4f3dee823a1e5aae52efd0456d4$exports.getCapabilities=$67bfc4f3dee823a1e5aae52efd0456d4$export$getCapabilities,$67bfc4f3dee823a1e5aae52efd0456d4$export$mangleRtpParameters=$67bfc4f3dee823a1e5aae52efd0456d4$var$mangleRtpParameters,$67bfc4f3dee823a1e5aae52efd0456d4$exports.mangleRtpParameters=$67bfc4f3dee823a1e5aae52efd0456d4$export$mangleRtpParameters;const $598a700fa83066927b7fb86b77b7b937$var$edgeUtils=$598a700fa83066927b7fb86b77b7b937$var$__importStar($67bfc4f3dee823a1e5aae52efd0456d4$exports),$598a700fa83066927b7fb86b77b7b937$var$logger=new $1495c7c2155b511d7a7eba88d183bc8a$exports.Logger("Edge11");class $598a700fa83066927b7fb86b77b7b937$var$Edge11 extends $cc0c0c04507cca8137231b297300d331$exports.HandlerInterface{constructor(){super(),this._rtpSenders=new Map,this._rtpReceivers=new Map,this._nextSendLocalId=0,this._transportReady=!1}static createFactory(){return()=>new $598a700fa83066927b7fb86b77b7b937$var$Edge11}get name(){return"Edge11"}close(){$598a700fa83066927b7fb86b77b7b937$var$logger.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}for(const e of this._rtpSenders.values())try{e.stop()}catch(e){}for(const e of this._rtpReceivers.values())try{e.stop()}catch(e){}}async getNativeRtpCapabilities(){return $598a700fa83066927b7fb86b77b7b937$var$logger.debug("getNativeRtpCapabilities()"),$598a700fa83066927b7fb86b77b7b937$var$edgeUtils.getCapabilities()}async getNativeSctpCapabilities(){return $598a700fa83066927b7fb86b77b7b937$var$logger.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({direction:e,iceParameters:a,iceCandidates:t,dtlsParameters:r,sctpParameters:c,iceServers:s,iceTransportPolicy:d,additionalSettings:i,proprietaryConstraints:o,extendedRtpCapabilities:n}){$598a700fa83066927b7fb86b77b7b937$var$logger.debug("run()"),this._sendingRtpParametersByKind={audio:$598a700fa83066927b7fb86b77b7b937$var$ortc.getSendingRtpParameters("audio",n),video:$598a700fa83066927b7fb86b77b7b937$var$ortc.getSendingRtpParameters("video",n)},this._remoteIceParameters=a,this._remoteIceCandidates=t,this._remoteDtlsParameters=r,this._cname=`CNAME-${$598a700fa83066927b7fb86b77b7b937$var$utils.generateRandomNumber()}`,this._setIceGatherer({iceServers:s,iceTransportPolicy:d}),this._setIceTransport(),this._setDtlsTransport()}async updateIceServers(e){throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("not supported")}async restartIce(e){if($598a700fa83066927b7fb86b77b7b937$var$logger.debug("restartIce()"),this._remoteIceParameters=e,this._transportReady){$598a700fa83066927b7fb86b77b7b937$var$logger.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,e,"controlling");for(const e of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(e);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:e,encodings:a,codecOptions:t,codec:r}){$598a700fa83066927b7fb86b77b7b937$var$logger.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._transportReady||await this._setupTransport({localDtlsRole:"server"}),$598a700fa83066927b7fb86b77b7b937$var$logger.debug("send() | calling new RTCRtpSender()");const c=new RTCRtpSender(e,this._dtlsTransport),s=$598a700fa83066927b7fb86b77b7b937$var$utils.clone(this._sendingRtpParametersByKind[e.kind],{});s.codecs=$598a700fa83066927b7fb86b77b7b937$var$ortc.reduceCodecs(s.codecs,r);const d=s.codecs.some((e=>/.+\/rtx$/i.test(e.mimeType)));a||(a=[{}]);for(const e of a)e.ssrc=$598a700fa83066927b7fb86b77b7b937$var$utils.generateRandomNumber(),d&&(e.rtx={ssrc:$598a700fa83066927b7fb86b77b7b937$var$utils.generateRandomNumber()});s.encodings=a,s.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const i=$598a700fa83066927b7fb86b77b7b937$var$edgeUtils.mangleRtpParameters(s);$598a700fa83066927b7fb86b77b7b937$var$logger.debug("send() | calling rtpSender.send() [params:%o]",i),await c.send(i);const o=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(o,c),{localId:o,rtpParameters:s,rtpSender:c}}async stopSending(e){$598a700fa83066927b7fb86b77b7b937$var$logger.debug("stopSending() [localId:%s]",e);const a=this._rtpSenders.get(e);if(!a)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(e);try{$598a700fa83066927b7fb86b77b7b937$var$logger.debug("stopSending() | calling rtpSender.stop()"),a.stop()}catch(e){throw $598a700fa83066927b7fb86b77b7b937$var$logger.warn("stopSending() | rtpSender.stop() failed:%o",e),e}}async replaceTrack(e,a){a?$598a700fa83066927b7fb86b77b7b937$var$logger.debug("replaceTrack() [localId:%s, track.id:%s]",e,a.id):$598a700fa83066927b7fb86b77b7b937$var$logger.debug("replaceTrack() [localId:%s, no track]",e);const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");t.setTrack(a)}async setMaxSpatialLayer(e,a){$598a700fa83066927b7fb86b77b7b937$var$logger.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,a);const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");const r=t.getParameters();r.encodings.forEach(((e,t)=>{e.active=t<=a})),await t.setParameters(r)}async setRtpEncodingParameters(e,a){$598a700fa83066927b7fb86b77b7b937$var$logger.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,a);const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");const r=t.getParameters();r.encodings.forEach(((e,t)=>{r.encodings[t]=Object.assign(Object.assign({},e),a)})),await t.setParameters(r)}async getSenderStats(e){const a=this._rtpSenders.get(e);if(!a)throw new Error("RTCRtpSender not found");return a.getStats()}async sendDataChannel(e){throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("not implemented")}async receive({trackId:e,kind:a,rtpParameters:t}){$598a700fa83066927b7fb86b77b7b937$var$logger.debug("receive() [trackId:%s, kind:%s]",e,a),this._transportReady||await this._setupTransport({localDtlsRole:"server"}),$598a700fa83066927b7fb86b77b7b937$var$logger.debug("receive() | calling new RTCRtpReceiver()");const r=new RTCRtpReceiver(this._dtlsTransport,a);r.addEventListener("error",(e=>{$598a700fa83066927b7fb86b77b7b937$var$logger.error('rtpReceiver "error" event [event:%o]',e)}));const c=$598a700fa83066927b7fb86b77b7b937$var$edgeUtils.mangleRtpParameters(t);$598a700fa83066927b7fb86b77b7b937$var$logger.debug("receive() | calling rtpReceiver.receive() [params:%o]",c),await r.receive(c);const s=e;return this._rtpReceivers.set(s,r),{localId:s,track:r.track,rtpReceiver:r}}async stopReceiving(e){$598a700fa83066927b7fb86b77b7b937$var$logger.debug("stopReceiving() [localId:%s]",e);const a=this._rtpReceivers.get(e);if(!a)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(e);try{$598a700fa83066927b7fb86b77b7b937$var$logger.debug("stopReceiving() | calling rtpReceiver.stop()"),a.stop()}catch(e){$598a700fa83066927b7fb86b77b7b937$var$logger.warn("stopReceiving() | rtpReceiver.stop() failed:%o",e)}}async getReceiverStats(e){const a=this._rtpReceivers.get(e);if(!a)throw new Error("RTCRtpReceiver not found");return a.getStats()}async receiveDataChannel(e){throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("not implemented")}_setIceGatherer({iceServers:e,iceTransportPolicy:a}){const t=new RTCIceGatherer({iceServers:e||[],gatherPolicy:a||"all"});t.addEventListener("error",(e=>{$598a700fa83066927b7fb86b77b7b937$var$logger.error('iceGatherer "error" event [event:%o]',e)}));try{t.gather()}catch(e){$598a700fa83066927b7fb86b77b7b937$var$logger.debug("_setIceGatherer() | iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=t}_setIceTransport(){const e=new RTCIceTransport(this._iceGatherer);e.addEventListener("statechange",(()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})),e.addEventListener("icestatechange",(()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})),e.addEventListener("candidatepairchange",(e=>{$598a700fa83066927b7fb86b77b7b937$var$logger.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)})),this._iceTransport=e}_setDtlsTransport(){const e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",(()=>{$598a700fa83066927b7fb86b77b7b937$var$logger.debug('dtlsTransport "statechange" event [state:%s]',e.state)})),e.addEventListener("dtlsstatechange",(()=>{$598a700fa83066927b7fb86b77b7b937$var$logger.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state),"closed"===e.state&&this.emit("@connectionstatechange","closed")})),e.addEventListener("error",(e=>{$598a700fa83066927b7fb86b77b7b937$var$logger.error('dtlsTransport "error" event [event:%o]',e)})),this._dtlsTransport=e}async _setupTransport({localDtlsRole:e}){$598a700fa83066927b7fb86b77b7b937$var$logger.debug("_setupTransport()");const a=this._dtlsTransport.getLocalParameters();a.role=e,await this.safeEmitAsPromise("@connect",{dtlsParameters:a}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const e of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(e);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter((e=>"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm)),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}}$598a700fa83066927b7fb86b77b7b937$export$Edge11=$598a700fa83066927b7fb86b77b7b937$var$Edge11,$598a700fa83066927b7fb86b77b7b937$exports.Edge11=$598a700fa83066927b7fb86b77b7b937$export$Edge11;var $13c2668609c96ef019acdaa14f568034$exports={},$13c2668609c96ef019acdaa14f568034$var$__createBinding=$13c2668609c96ef019acdaa14f568034$exports&&$13c2668609c96ef019acdaa14f568034$exports.__createBinding||(Object.create?function(e,a,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,r){void 0===r&&(r=t),e[r]=a[t]}),$13c2668609c96ef019acdaa14f568034$var$__setModuleDefault=$13c2668609c96ef019acdaa14f568034$exports&&$13c2668609c96ef019acdaa14f568034$exports.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),$13c2668609c96ef019acdaa14f568034$var$__importStar=$13c2668609c96ef019acdaa14f568034$exports&&$13c2668609c96ef019acdaa14f568034$exports.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)"default"!==t&&Object.hasOwnProperty.call(e,t)&&$13c2668609c96ef019acdaa14f568034$var$__createBinding(a,e,t);return $13c2668609c96ef019acdaa14f568034$var$__setModuleDefault(a,e),a};Object.defineProperty($13c2668609c96ef019acdaa14f568034$exports,"__esModule",{value:!0});var $13c2668609c96ef019acdaa14f568034$export$ReactNative=void 0;$13c2668609c96ef019acdaa14f568034$exports.ReactNative=$13c2668609c96ef019acdaa14f568034$export$ReactNative;const $13c2668609c96ef019acdaa14f568034$var$sdpTransform=$13c2668609c96ef019acdaa14f568034$var$__importStar($b905cbabdece2b7ed3d885dc9ff42ac0$exports),$13c2668609c96ef019acdaa14f568034$var$utils=$13c2668609c96ef019acdaa14f568034$var$__importStar($6abc7ab33e1327c2d411a5fc6b37fe23$exports),$13c2668609c96ef019acdaa14f568034$var$ortc=$13c2668609c96ef019acdaa14f568034$var$__importStar($c14b343179c41479c8bdeecb64f7be76$exports),$13c2668609c96ef019acdaa14f568034$var$sdpCommonUtils=$13c2668609c96ef019acdaa14f568034$var$__importStar($d52929f92c17dce5cc60b70ec647fedb$exports),$13c2668609c96ef019acdaa14f568034$var$sdpPlanBUtils=$13c2668609c96ef019acdaa14f568034$var$__importStar($95414416f142b78649b3036f3acc7f22$exports),$13c2668609c96ef019acdaa14f568034$var$logger=new $1495c7c2155b511d7a7eba88d183bc8a$exports.Logger("ReactNative"),$13c2668609c96ef019acdaa14f568034$var$SCTP_NUM_STREAMS={OS:1024,MIS:1024};class $13c2668609c96ef019acdaa14f568034$var$ReactNative extends $cc0c0c04507cca8137231b297300d331$exports.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new $13c2668609c96ef019acdaa14f568034$var$ReactNative}get name(){return"ReactNative"}close(){if($13c2668609c96ef019acdaa14f568034$var$logger.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){$13c2668609c96ef019acdaa14f568034$var$logger.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const a=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const t=$13c2668609c96ef019acdaa14f568034$var$sdpTransform.parse(a.sdp);return $13c2668609c96ef019acdaa14f568034$var$sdpCommonUtils.extractRtpCapabilities({sdpObject:t})}catch(a){try{e.close()}catch(e){}throw a}}async getNativeSctpCapabilities(){return $13c2668609c96ef019acdaa14f568034$var$logger.debug("getNativeSctpCapabilities()"),{numStreams:$13c2668609c96ef019acdaa14f568034$var$SCTP_NUM_STREAMS}}run({direction:e,iceParameters:a,iceCandidates:t,dtlsParameters:r,sctpParameters:c,iceServers:s,iceTransportPolicy:d,additionalSettings:i,proprietaryConstraints:o,extendedRtpCapabilities:n}){$13c2668609c96ef019acdaa14f568034$var$logger.debug("run()"),this._direction=e,this._remoteSdp=new $2aa38523a6b418a7db72b14d2d309ee6$exports.RemoteSdp({iceParameters:a,iceCandidates:t,dtlsParameters:r,sctpParameters:c,planB:!0}),this._sendingRtpParametersByKind={audio:$13c2668609c96ef019acdaa14f568034$var$ortc.getSendingRtpParameters("audio",n),video:$13c2668609c96ef019acdaa14f568034$var$ortc.getSendingRtpParameters("video",n)},this._sendingRemoteRtpParametersByKind={audio:$13c2668609c96ef019acdaa14f568034$var$ortc.getSendingRemoteRtpParameters("audio",n),video:$13c2668609c96ef019acdaa14f568034$var$ortc.getSendingRemoteRtpParameters("video",n)},this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:d||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},i),o),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){$13c2668609c96ef019acdaa14f568034$var$logger.debug("updateIceServers()");const a=this._pc.getConfiguration();a.iceServers=e,this._pc.setConfiguration(a)}async restartIce(e){if($13c2668609c96ef019acdaa14f568034$var$logger.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});$13c2668609c96ef019acdaa14f568034$var$logger.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const a={type:"answer",sdp:this._remoteSdp.getSdp()};$13c2668609c96ef019acdaa14f568034$var$logger.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};$13c2668609c96ef019acdaa14f568034$var$logger.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const a=await this._pc.createAnswer();$13c2668609c96ef019acdaa14f568034$var$logger.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:a,codecOptions:t,codec:r}){this._assertSendDirection(),$13c2668609c96ef019acdaa14f568034$var$logger.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),r&&$13c2668609c96ef019acdaa14f568034$var$logger.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let c,s=await this._pc.createOffer(),d=$13c2668609c96ef019acdaa14f568034$var$sdpTransform.parse(s.sdp);const i=$13c2668609c96ef019acdaa14f568034$var$utils.clone(this._sendingRtpParametersByKind[e.kind],{});i.codecs=$13c2668609c96ef019acdaa14f568034$var$ortc.reduceCodecs(i.codecs);const o=$13c2668609c96ef019acdaa14f568034$var$utils.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(o.codecs=$13c2668609c96ef019acdaa14f568034$var$ortc.reduceCodecs(o.codecs),this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:d}),"video"===e.kind&&a&&a.length>1&&($13c2668609c96ef019acdaa14f568034$var$logger.debug("send() | enabling simulcast"),d=$13c2668609c96ef019acdaa14f568034$var$sdpTransform.parse(s.sdp),c=d.media.find((e=>"video"===e.type)),$13c2668609c96ef019acdaa14f568034$var$sdpPlanBUtils.addLegacySimulcast({offerMediaObject:c,track:e,numStreams:a.length}),s={type:"offer",sdp:$13c2668609c96ef019acdaa14f568034$var$sdpTransform.write(d)}),$13c2668609c96ef019acdaa14f568034$var$logger.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s),d=$13c2668609c96ef019acdaa14f568034$var$sdpTransform.parse(this._pc.localDescription.sdp),c=d.media.find((a=>a.type===e.kind)),i.rtcp.cname=$13c2668609c96ef019acdaa14f568034$var$sdpCommonUtils.getCname({offerMediaObject:c}),i.encodings=$13c2668609c96ef019acdaa14f568034$var$sdpPlanBUtils.getRtpEncodings({offerMediaObject:c,track:e}),a)for(let e=0;e<i.encodings.length;++e)a[e]&&Object.assign(i.encodings[e],a[e]);if(i.encodings.length>1&&("video/vp8"===i.codecs[0].mimeType.toLowerCase()||"video/h264"===i.codecs[0].mimeType.toLowerCase()))for(const e of i.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:c,offerRtpParameters:i,answerRtpParameters:o,codecOptions:t});const n={type:"answer",sdp:this._remoteSdp.getSdp()};$13c2668609c96ef019acdaa14f568034$var$logger.debug("send() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n);const f=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(f,e),{localId:f,rtpParameters:i}}async stopSending(e){this._assertSendDirection(),$13c2668609c96ef019acdaa14f568034$var$logger.debug("stopSending() [localId:%s]",e);const a=this._mapSendLocalIdTrack.get(e);if(!a)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(a),this._pc.addStream(this._sendStream);const t=await this._pc.createOffer();$13c2668609c96ef019acdaa14f568034$var$logger.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t);try{await this._pc.setLocalDescription(t)}catch(e){if(0===this._sendStream.getTracks().length)return void $13c2668609c96ef019acdaa14f568034$var$logger.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"===this._pc.signalingState)return;const r={type:"answer",sdp:this._remoteSdp.getSdp()};$13c2668609c96ef019acdaa14f568034$var$logger.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async replaceTrack(e,a){throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,a){throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("not implemented")}async setRtpEncodingParameters(e,a){throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("not implemented")}async getSenderStats(e){throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:a,maxRetransmits:t,label:r,protocol:c,priority:s}){this._assertSendDirection();const d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:t,protocol:c,priority:s};$13c2668609c96ef019acdaa14f568034$var$logger.debug("sendDataChannel() [options:%o]",d);const i=this._pc.createDataChannel(r,d);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%$13c2668609c96ef019acdaa14f568034$var$SCTP_NUM_STREAMS.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),a=$13c2668609c96ef019acdaa14f568034$var$sdpTransform.parse(e.sdp),t=a.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:a}),$13c2668609c96ef019acdaa14f568034$var$logger.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:t});const r={type:"answer",sdp:this._remoteSdp.getSdp()};$13c2668609c96ef019acdaa14f568034$var$logger.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r),this._hasDataChannelMediaSection=!0}return{dataChannel:i,sctpStreamParameters:{streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits}}}async receive({trackId:e,kind:a,rtpParameters:t}){this._assertRecvDirection(),$13c2668609c96ef019acdaa14f568034$var$logger.debug("receive() [trackId:%s, kind:%s]",e,a);const r=e,c=a;let s=t.rtcp.cname;$13c2668609c96ef019acdaa14f568034$var$logger.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),s+=`-hack-${$13c2668609c96ef019acdaa14f568034$var$utils.generateRandomNumber()}`,this._remoteSdp.receive({mid:c,kind:a,offerRtpParameters:t,streamId:s,trackId:e});const d={type:"offer",sdp:this._remoteSdp.getSdp()};$13c2668609c96ef019acdaa14f568034$var$logger.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d);let i=await this._pc.createAnswer();const o=$13c2668609c96ef019acdaa14f568034$var$sdpTransform.parse(i.sdp),n=o.media.find((e=>String(e.mid)===c));$13c2668609c96ef019acdaa14f568034$var$sdpCommonUtils.applyCodecParameters({offerRtpParameters:t,answerMediaObject:n}),i={type:"answer",sdp:$13c2668609c96ef019acdaa14f568034$var$sdpTransform.write(o)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:o}),$13c2668609c96ef019acdaa14f568034$var$logger.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);const f=this._pc.getRemoteStreams().find((e=>e.id===s)).getTrackById(r);if(!f)throw new Error("remote track not found");return this._mapRecvLocalIdInfo.set(r,{mid:c,rtpParameters:t}),{localId:r,track:f}}async stopReceiving(e){this._assertRecvDirection(),$13c2668609c96ef019acdaa14f568034$var$logger.debug("stopReceiving() [localId:%s]",e);const{mid:a,rtpParameters:t}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:a,offerRtpParameters:t});const r={type:"offer",sdp:this._remoteSdp.getSdp()};$13c2668609c96ef019acdaa14f568034$var$logger.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const c=await this._pc.createAnswer();$13c2668609c96ef019acdaa14f568034$var$logger.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}async getReceiverStats(e){throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:a,protocol:t}){this._assertRecvDirection();const{streamId:r,ordered:c,maxPacketLifeTime:s,maxRetransmits:d}=e,i={negotiated:!0,id:r,ordered:c,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:d,protocol:t};$13c2668609c96ef019acdaa14f568034$var$logger.debug("receiveDataChannel() [options:%o]",i);const o=this._pc.createDataChannel(a,i);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};$13c2668609c96ef019acdaa14f568034$var$logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const a=await this._pc.createAnswer();if(!this._transportReady){const e=$13c2668609c96ef019acdaa14f568034$var$sdpTransform.parse(a.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}$13c2668609c96ef019acdaa14f568034$var$logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setLocalDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:o}}async _setupTransport({localDtlsRole:e,localSdpObject:a}){a||(a=$13c2668609c96ef019acdaa14f568034$var$sdpTransform.parse(this._pc.localDescription.sdp));const t=$13c2668609c96ef019acdaa14f568034$var$sdpCommonUtils.extractDtlsParameters({sdpObject:a});t.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:t}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}$13c2668609c96ef019acdaa14f568034$export$ReactNative=$13c2668609c96ef019acdaa14f568034$var$ReactNative,$13c2668609c96ef019acdaa14f568034$exports.ReactNative=$13c2668609c96ef019acdaa14f568034$export$ReactNative;const $300fb327e45c7345f50fad064ffa0c99$var$logger=new $1495c7c2155b511d7a7eba88d183bc8a$exports.Logger("Device");function $300fb327e45c7345f50fad064ffa0c99$var$detectDevice(){if("object"==typeof navigator&&"ReactNative"===navigator.product)return"undefined"==typeof RTCPeerConnection?void $300fb327e45c7345f50fad064ffa0c99$var$logger.warn("this._detectDevice() | unsupported ReactNative without RTCPeerConnection"):($300fb327e45c7345f50fad064ffa0c99$var$logger.debug("this._detectDevice() | ReactNative handler chosen"),"ReactNative");if("object"!=typeof navigator||"string"!=typeof navigator.userAgent)$300fb327e45c7345f50fad064ffa0c99$var$logger.warn("this._detectDevice() | unknown device");else{const e=navigator.userAgent,a=$300fb327e45c7345f50fad064ffa0c99$var$bowser_1.default.getParser(e),t=a.getEngine();if(a.satisfies({chrome:">=74",chromium:">=74"}))return"Chrome74";if(a.satisfies({chrome:">=70",chromium:">=70"}))return"Chrome70";if(a.satisfies({chrome:">=67",chromium:">=67"}))return"Chrome67";if(a.satisfies({chrome:">=55",chromium:">=55"}))return"Chrome55";if(a.satisfies({firefox:">=60"}))return"Firefox60";if(a.satisfies({safari:">=12.0"})&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(a.satisfies({safari:">=11"}))return"Safari11";if(a.satisfies({"microsoft edge":">=11"})&&a.satisfies({"microsoft edge":"<=18"}))return"Edge11";if(t.name&&"blink"===t.name.toLowerCase()){const a=e.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(a){const e=Number(a[1]);return e>=74?"Chrome74":e>=70?"Chrome70":e>=67?"Chrome67":"Chrome55"}return"Chrome74"}$300fb327e45c7345f50fad064ffa0c99$var$logger.warn("this._detectDevice() | browser not supported [name:%s, version:%s]",a.getBrowserName(),a.getBrowserVersion())}}var $300fb327e45c7345f50fad064ffa0c99$export$detectDevice=$300fb327e45c7345f50fad064ffa0c99$var$detectDevice;$300fb327e45c7345f50fad064ffa0c99$exports.detectDevice=$300fb327e45c7345f50fad064ffa0c99$export$detectDevice;class $300fb327e45c7345f50fad064ffa0c99$var$Device{constructor({handlerName:e,handlerFactory:a,Handler:t}={}){if(this._loaded=!1,this._observer=new $233e1f2fffc8d465fe34283eded93370$exports.EnhancedEventEmitter,$300fb327e45c7345f50fad064ffa0c99$var$logger.debug("constructor()"),t){if($300fb327e45c7345f50fad064ffa0c99$var$logger.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),"string"!=typeof t)throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");e=t}if(e&&a)throw new TypeError("just one of handlerName or handlerInterface can be given");if(a)this._handlerFactory=a;else{if(e)$300fb327e45c7345f50fad064ffa0c99$var$logger.debug("constructor() | handler given: %s",e);else{if(!(e=$300fb327e45c7345f50fad064ffa0c99$var$detectDevice()))throw new $bc57fcc64273e15720ee6bd761f472a5$exports.UnsupportedError("device not supported");$300fb327e45c7345f50fad064ffa0c99$var$logger.debug("constructor() | detected handler: %s",e)}switch(e){case"Chrome74":this._handlerFactory=$49246bb5a2f6e045fa681202ab25d3c3$exports.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=$f94627158a480fddc2767d3897b30f81$exports.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=$4b535345a8382557a5d35f66f7222c89$exports.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=$da6e6cb0c9c9bc1adc841a3b05ad48e0$exports.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=$18e9bd9c8d78496d027f1375b29ceee9$exports.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=$9f79eaaf7465a254ff8a5c616b8f0c5e$exports.Safari12.createFactory();break;case"Safari11":this._handlerFactory=$4a2af2708bb3e4b82830beeecde2e434$exports.Safari11.createFactory();break;case"Edge11":this._handlerFactory=$598a700fa83066927b7fb86b77b7b937$exports.Edge11.createFactory();break;case"ReactNative":this._handlerFactory=$13c2668609c96ef019acdaa14f568034$exports.ReactNative.createFactory();break;default:throw new TypeError(`unknown handlerName "${e}"`)}}const r=this._handlerFactory();this._handlerName=r.name,r.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:e}){let a;$300fb327e45c7345f50fad064ffa0c99$var$logger.debug("load() [routerRtpCapabilities:%o]",e),e=$300fb327e45c7345f50fad064ffa0c99$var$utils.clone(e,void 0);try{if(this._loaded)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError("already loaded");$300fb327e45c7345f50fad064ffa0c99$var$ortc.validateRtpCapabilities(e),a=this._handlerFactory();const t=await a.getNativeRtpCapabilities();$300fb327e45c7345f50fad064ffa0c99$var$logger.debug("load() | got native RTP capabilities:%o",t),$300fb327e45c7345f50fad064ffa0c99$var$ortc.validateRtpCapabilities(t),this._extendedRtpCapabilities=$300fb327e45c7345f50fad064ffa0c99$var$ortc.getExtendedRtpCapabilities(t,e),$300fb327e45c7345f50fad064ffa0c99$var$logger.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=$300fb327e45c7345f50fad064ffa0c99$var$ortc.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=$300fb327e45c7345f50fad064ffa0c99$var$ortc.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=$300fb327e45c7345f50fad064ffa0c99$var$ortc.getRecvRtpCapabilities(this._extendedRtpCapabilities),$300fb327e45c7345f50fad064ffa0c99$var$ortc.validateRtpCapabilities(this._recvRtpCapabilities),$300fb327e45c7345f50fad064ffa0c99$var$logger.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await a.getNativeSctpCapabilities(),$300fb327e45c7345f50fad064ffa0c99$var$logger.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),$300fb327e45c7345f50fad064ffa0c99$var$ortc.validateSctpCapabilities(this._sctpCapabilities),$300fb327e45c7345f50fad064ffa0c99$var$logger.debug("load() succeeded"),this._loaded=!0,a.close()}catch(e){throw a&&a.close(),e}}canProduce(e){if(!this._loaded)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError("not loaded");if("audio"!==e&&"video"!==e)throw new TypeError(`invalid kind "${e}"`);return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:a,iceCandidates:t,dtlsParameters:r,sctpParameters:c,iceServers:s,iceTransportPolicy:d,additionalSettings:i,proprietaryConstraints:o,appData:n={}}){return $300fb327e45c7345f50fad064ffa0c99$var$logger.debug("createSendTransport()"),this._createTransport({direction:"send",id:e,iceParameters:a,iceCandidates:t,dtlsParameters:r,sctpParameters:c,iceServers:s,iceTransportPolicy:d,additionalSettings:i,proprietaryConstraints:o,appData:n})}createRecvTransport({id:e,iceParameters:a,iceCandidates:t,dtlsParameters:r,sctpParameters:c,iceServers:s,iceTransportPolicy:d,additionalSettings:i,proprietaryConstraints:o,appData:n={}}){return $300fb327e45c7345f50fad064ffa0c99$var$logger.debug("createRecvTransport()"),this._createTransport({direction:"recv",id:e,iceParameters:a,iceCandidates:t,dtlsParameters:r,sctpParameters:c,iceServers:s,iceTransportPolicy:d,additionalSettings:i,proprietaryConstraints:o,appData:n})}_createTransport({direction:e,id:a,iceParameters:t,iceCandidates:r,dtlsParameters:c,sctpParameters:s,iceServers:d,iceTransportPolicy:i,additionalSettings:o,proprietaryConstraints:n,appData:f={}}){if(!this._loaded)throw new $bc57fcc64273e15720ee6bd761f472a5$exports.InvalidStateError("not loaded");if("string"!=typeof a)throw new TypeError("missing id");if("object"!=typeof t)throw new TypeError("missing iceParameters");if(!Array.isArray(r))throw new TypeError("missing iceCandidates");if("object"!=typeof c)throw new TypeError("missing dtlsParameters");if(s&&"object"!=typeof s)throw new TypeError("wrong sctpParameters");if(f&&"object"!=typeof f)throw new TypeError("if given, appData must be an object");const $=new $5f92f7b37da9b8a6f20b18d49540582a$exports.Transport({direction:e,id:a,iceParameters:t,iceCandidates:r,dtlsParameters:c,sctpParameters:s,iceServers:d,iceTransportPolicy:i,additionalSettings:o,proprietaryConstraints:n,appData:f,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",$),$}}$300fb327e45c7345f50fad064ffa0c99$export$Device=$300fb327e45c7345f50fad064ffa0c99$var$Device,$300fb327e45c7345f50fad064ffa0c99$exports.Device=$300fb327e45c7345f50fad064ffa0c99$export$Device,Object.defineProperty($10e1dd25d7ef981085f794456239c45d$exports,"Device",{enumerable:!0,get:function(){return $300fb327e45c7345f50fad064ffa0c99$exports.Device}}),Object.defineProperty($10e1dd25d7ef981085f794456239c45d$exports,"detectDevice",{enumerable:!0,get:function(){return $300fb327e45c7345f50fad064ffa0c99$exports.detectDevice}});var $7996b8cc06a0752258011a0558d52322$exports={},$7996b8cc06a0752258011a0558d52322$var$__createBinding=$7996b8cc06a0752258011a0558d52322$exports&&$7996b8cc06a0752258011a0558d52322$exports.__createBinding||(Object.create?function(e,a,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,r){void 0===r&&(r=t),e[r]=a[t]}),$7996b8cc06a0752258011a0558d52322$var$__exportStar=$7996b8cc06a0752258011a0558d52322$exports&&$7996b8cc06a0752258011a0558d52322$exports.__exportStar||function(e,a){for(var t in e)"default"===t||a.hasOwnProperty(t)||$7996b8cc06a0752258011a0558d52322$var$__createBinding(a,e,t)};Object.defineProperty($7996b8cc06a0752258011a0558d52322$exports,"__esModule",{value:!0}),$7996b8cc06a0752258011a0558d52322$var$__exportStar($300fb327e45c7345f50fad064ffa0c99$exports,$7996b8cc06a0752258011a0558d52322$exports),$7996b8cc06a0752258011a0558d52322$var$__exportStar($5f92f7b37da9b8a6f20b18d49540582a$exports,$7996b8cc06a0752258011a0558d52322$exports),$7996b8cc06a0752258011a0558d52322$var$__exportStar($9bd46aaebdf0dcccd04feef1bfe3f740$exports,$7996b8cc06a0752258011a0558d52322$exports),$7996b8cc06a0752258011a0558d52322$var$__exportStar($6d860932940735229ce399ee376f25ac$exports,$7996b8cc06a0752258011a0558d52322$exports),$7996b8cc06a0752258011a0558d52322$var$__exportStar($e0d0870270a5e570fb0c2456c14d4c42$exports,$7996b8cc06a0752258011a0558d52322$exports),$7996b8cc06a0752258011a0558d52322$var$__exportStar($495f846525d246cda6052a324fbd15fe$exports,$7996b8cc06a0752258011a0558d52322$exports);var $8c4d5a0515bd244c91a86ba4032b5a47$exports={};Object.defineProperty($8c4d5a0515bd244c91a86ba4032b5a47$exports,"__esModule",{value:!0}),$7996b8cc06a0752258011a0558d52322$var$__exportStar($8c4d5a0515bd244c91a86ba4032b5a47$exports,$7996b8cc06a0752258011a0558d52322$exports);var $21104c1422d0b8cb82c957bcaf1ac250$exports={};Object.defineProperty($21104c1422d0b8cb82c957bcaf1ac250$exports,"__esModule",{value:!0}),$7996b8cc06a0752258011a0558d52322$var$__exportStar($21104c1422d0b8cb82c957bcaf1ac250$exports,$7996b8cc06a0752258011a0558d52322$exports),$7996b8cc06a0752258011a0558d52322$var$__exportStar($cc0c0c04507cca8137231b297300d331$exports,$7996b8cc06a0752258011a0558d52322$exports),$7996b8cc06a0752258011a0558d52322$var$__exportStar($bc57fcc64273e15720ee6bd761f472a5$exports,$7996b8cc06a0752258011a0558d52322$exports);const $10e1dd25d7ef981085f794456239c45d$var$types=$10e1dd25d7ef981085f794456239c45d$var$__importStar($7996b8cc06a0752258011a0558d52322$exports);var $10e1dd25d7ef981085f794456239c45d$export$types=$10e1dd25d7ef981085f794456239c45d$var$types;$10e1dd25d7ef981085f794456239c45d$exports.types=$10e1dd25d7ef981085f794456239c45d$export$types;var $10e1dd25d7ef981085f794456239c45d$export$version="3.6.29";$10e1dd25d7ef981085f794456239c45d$exports.version=$10e1dd25d7ef981085f794456239c45d$export$version,Object.defineProperty($10e1dd25d7ef981085f794456239c45d$exports,"parseScalabilityMode",{enumerable:!0,get:function(){return $991a06b940351aa492c8a67e5b288aa6$exports.parse}});var $4918b6d01dd8ffca6052ffdacce383c0$exports={};$4918b6d01dd8ffca6052ffdacce383c0$exports=JSON.parse('{"_args":[["protoo-client@4.0.6","/Users/ojack/PROJECTS/flujos"]],"_from":"protoo-client@4.0.6","_id":"protoo-client@4.0.6","_inBundle":false,"_integrity":"sha512-ZqImkKHpeJhSlgvyI6QAfZNc/aXcCgmmocMx4S1w2lAaxXtckxxeDtcVNtkOISUWm/mbC+BrmYPXoGMkfhkKOQ==","_location":"/protoo-client","_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"protoo-client@4.0.6","name":"protoo-client","escapedName":"protoo-client","rawSpec":"4.0.6","saveSpec":null,"fetchSpec":"4.0.6"},"_requiredBy":["/"],"_resolved":"https://registry.npmjs.org/protoo-client/-/protoo-client-4.0.6.tgz","_spec":"4.0.6","_where":"/Users/ojack/PROJECTS/flujos","author":{"name":"Iaki Baz Castillo","email":"ibc@aliax.net"},"bugs":{"url":"https://github.com/ibc/protoo/issues"},"dependencies":{"debug":"^4.3.1","events":"^3.2.0","retry":"^0.12.0","websocket":"^1.0.33"},"description":"protoo JavaScript client module","devDependencies":{"eslint":"^5.16.0"},"engines":{"node":">=8.0.0"},"homepage":"https://protoo.versatica.com","keywords":["nodejs","browser","websocket"],"license":"MIT","main":"lib/index.js","name":"protoo-client","optionalDependencies":{"websocket":"^1.0.33"},"repository":{"type":"git","url":"git+https://github.com/ibc/protoo.git"},"scripts":{"lint":"eslint -c .eslintrc.js lib"},"version":"4.0.6"}');var $96af5b9c5ae0bf0fe7e74e10f4373355$exports={},$101ba540d922a9103f2b36ca357c9ba5$exports={};const $101ba540d922a9103f2b36ca357c9ba5$var$debug=$e4073ed42c3319e72efcba5381e94562$exports,$101ba540d922a9103f2b36ca357c9ba5$var$APP_NAME="protoo-client";class $101ba540d922a9103f2b36ca357c9ba5$var$Logger{constructor(e){e?(this._debug=$101ba540d922a9103f2b36ca357c9ba5$var$debug(`${$101ba540d922a9103f2b36ca357c9ba5$var$APP_NAME}:${e}`),this._warn=$101ba540d922a9103f2b36ca357c9ba5$var$debug(`${$101ba540d922a9103f2b36ca357c9ba5$var$APP_NAME}:WARN:${e}`),this._error=$101ba540d922a9103f2b36ca357c9ba5$var$debug(`${$101ba540d922a9103f2b36ca357c9ba5$var$APP_NAME}:ERROR:${e}`)):(this._debug=$101ba540d922a9103f2b36ca357c9ba5$var$debug($101ba540d922a9103f2b36ca357c9ba5$var$APP_NAME),this._warn=$101ba540d922a9103f2b36ca357c9ba5$var$debug(`${$101ba540d922a9103f2b36ca357c9ba5$var$APP_NAME}:WARN`),this._error=$101ba540d922a9103f2b36ca357c9ba5$var$debug(`${$101ba540d922a9103f2b36ca357c9ba5$var$APP_NAME}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}$101ba540d922a9103f2b36ca357c9ba5$exports=$101ba540d922a9103f2b36ca357c9ba5$var$Logger;const $96af5b9c5ae0bf0fe7e74e10f4373355$var$Logger=$101ba540d922a9103f2b36ca357c9ba5$exports;var $a55a01021a0f490ef13fc2132572bba5$exports={};const $a55a01021a0f490ef13fc2132572bba5$var$Logger=$101ba540d922a9103f2b36ca357c9ba5$exports;class $a55a01021a0f490ef13fc2132572bba5$var$EnhancedEventEmitter extends $47097ee663d5613230304ea01db841ae$exports.EventEmitter{constructor(e){super(),this.setMaxListeners(1/0),this._logger=e||new $a55a01021a0f490ef13fc2132572bba5$var$Logger("EnhancedEventEmitter")}safeEmit(e,...a){try{this.emit(e,...a)}catch(a){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",e,a)}}async safeEmitAsPromise(e,...a){return new Promise(((t,r)=>{this.safeEmit(e,...a,t,r)}))}}$a55a01021a0f490ef13fc2132572bba5$exports=$a55a01021a0f490ef13fc2132572bba5$var$EnhancedEventEmitter;const $96af5b9c5ae0bf0fe7e74e10f4373355$var$EnhancedEventEmitter=$a55a01021a0f490ef13fc2132572bba5$exports;var $86d0dccef1e10ddd0df4d626eec36333$exports={};const $86d0dccef1e10ddd0df4d626eec36333$var$Logger=$101ba540d922a9103f2b36ca357c9ba5$exports;var $79fb5a912c1c13aa8b4d9b921ff5d7f0$export$generateRandomNumber=function(){return Math.round(1e7*Math.random())};const $86d0dccef1e10ddd0df4d626eec36333$var$logger=new $86d0dccef1e10ddd0df4d626eec36333$var$Logger("Message");class $86d0dccef1e10ddd0df4d626eec36333$var$Message{static parse(e){let a;const t={};try{a=JSON.parse(e)}catch(e){return void $86d0dccef1e10ddd0df4d626eec36333$var$logger.error("parse() | invalid JSON: %s",e)}if("object"==typeof a&&!Array.isArray(a)){if(a.request){if(t.request=!0,"string"!=typeof a.method)return void $86d0dccef1e10ddd0df4d626eec36333$var$logger.error("parse() | missing/invalid method field");if("number"!=typeof a.id)return void $86d0dccef1e10ddd0df4d626eec36333$var$logger.error("parse() | missing/invalid id field");t.id=a.id,t.method=a.method,t.data=a.data||{}}else if(a.response){if(t.response=!0,"number"!=typeof a.id)return void $86d0dccef1e10ddd0df4d626eec36333$var$logger.error("parse() | missing/invalid id field");t.id=a.id,a.ok?(t.ok=!0,t.data=a.data||{}):(t.ok=!1,t.errorCode=a.errorCode,t.errorReason=a.errorReason)}else{if(!a.notification)return void $86d0dccef1e10ddd0df4d626eec36333$var$logger.error("parse() | missing request/response field");if(t.notification=!0,"string"!=typeof a.method)return void $86d0dccef1e10ddd0df4d626eec36333$var$logger.error("parse() | missing/invalid method field");t.method=a.method,t.data=a.data||{}}return t}$86d0dccef1e10ddd0df4d626eec36333$var$logger.error("parse() | not an object")}static createRequest(e,a){return{request:!0,id:$79fb5a912c1c13aa8b4d9b921ff5d7f0$export$generateRandomNumber(),method:e,data:a||{}}}static createSuccessResponse(e,a){return{response:!0,id:e.id,ok:!0,data:a||{}}}static createErrorResponse(e,a,t){return{response:!0,id:e.id,ok:!1,errorCode:a,errorReason:t}}static createNotification(e,a){return{notification:!0,method:e,data:a||{}}}}$86d0dccef1e10ddd0df4d626eec36333$exports=$86d0dccef1e10ddd0df4d626eec36333$var$Message;const $96af5b9c5ae0bf0fe7e74e10f4373355$var$logger=new $96af5b9c5ae0bf0fe7e74e10f4373355$var$Logger("Peer");class $96af5b9c5ae0bf0fe7e74e10f4373355$var$Peer extends $96af5b9c5ae0bf0fe7e74e10f4373355$var$EnhancedEventEmitter{constructor(e){super($96af5b9c5ae0bf0fe7e74e10f4373355$var$logger),$96af5b9c5ae0bf0fe7e74e10f4373355$var$logger.debug("constructor()"),this._closed=!1,this._transport=e,this._connected=!1,this._data={},this._sents=new Map,this._handleTransport()}get closed(){return this._closed}get connected(){return this._connected}get data(){return this._data}set data(e){throw new Error("cannot override data object")}close(){if(!this._closed){$96af5b9c5ae0bf0fe7e74e10f4373355$var$logger.debug("close()"),this._closed=!0,this._connected=!1,this._transport.close();for(const e of this._sents.values())e.close();this.safeEmit("close")}}async request(e,a){const t=$86d0dccef1e10ddd0df4d626eec36333$exports.createRequest(e,a);return this._logger.debug("request() [method:%s, id:%s]",e,t.id),await this._transport.send(t),new Promise(((e,a)=>{const r=1500*(15+.1*this._sents.size),c={id:t.id,method:t.method,resolve:a=>{this._sents.delete(t.id)&&(clearTimeout(c.timer),e(a))},reject:e=>{this._sents.delete(t.id)&&(clearTimeout(c.timer),a(e))},timer:setTimeout((()=>{this._sents.delete(t.id)&&a(new Error("request timeout"))}),r),close:()=>{clearTimeout(c.timer),a(new Error("peer closed"))}};this._sents.set(t.id,c)}))}async notify(e,a){const t=$86d0dccef1e10ddd0df4d626eec36333$exports.createNotification(e,a);this._logger.debug("notify() [method:%s]",e),await this._transport.send(t)}_handleTransport(){if(this._transport.closed)return this._closed=!0,void setTimeout((()=>{this._closed||(this._connected=!1,this.safeEmit("close"))}));this._transport.on("open",(()=>{this._closed||($96af5b9c5ae0bf0fe7e74e10f4373355$var$logger.debug('emit "open"'),this._connected=!0,this.safeEmit("open"))})),this._transport.on("disconnected",(()=>{this._closed||($96af5b9c5ae0bf0fe7e74e10f4373355$var$logger.debug('emit "disconnected"'),this._connected=!1,this.safeEmit("disconnected"))})),this._transport.on("failed",(e=>{this._closed||($96af5b9c5ae0bf0fe7e74e10f4373355$var$logger.debug('emit "failed" [currentAttempt:%s]',e),this._connected=!1,this.safeEmit("failed",e))})),this._transport.on("close",(()=>{this._closed||(this._closed=!0,$96af5b9c5ae0bf0fe7e74e10f4373355$var$logger.debug('emit "close"'),this._connected=!1,this.safeEmit("close"))})),this._transport.on("message",(e=>{e.request?this._handleRequest(e):e.response?this._handleResponse(e):e.notification&&this._handleNotification(e)}))}_handleRequest(e){try{this.emit("request",e,(a=>{const t=$86d0dccef1e10ddd0df4d626eec36333$exports.createSuccessResponse(e,a);this._transport.send(t).catch((()=>{}))}),((a,t)=>{a instanceof Error?(t=a.message,a=500):"number"==typeof a&&t instanceof Error&&(t=t.message);const r=$86d0dccef1e10ddd0df4d626eec36333$exports.createErrorResponse(e,a,t);this._transport.send(r).catch((()=>{}))}))}catch(a){const t=$86d0dccef1e10ddd0df4d626eec36333$exports.createErrorResponse(e,500,String(a));this._transport.send(t).catch((()=>{}))}}_handleResponse(e){const a=this._sents.get(e.id);if(a)if(e.ok)a.resolve(e.data);else{const t=new Error(e.errorReason);t.code=e.errorCode,a.reject(t)}else $96af5b9c5ae0bf0fe7e74e10f4373355$var$logger.error("received response does not match any sent request [id:%s]",e.id)}_handleNotification(e){this.safeEmit("notification",e)}}$96af5b9c5ae0bf0fe7e74e10f4373355$exports=$96af5b9c5ae0bf0fe7e74e10f4373355$var$Peer;const $86f5587e24816ad05909b9cc2a9770db$var$Peer=$96af5b9c5ae0bf0fe7e74e10f4373355$exports;var $e17e243f41ba429b4719faa4f8a2e91e$exports={},$ab9a2fc9f2f19c439e89a30bf26139a0$exports,$ab9a2fc9f2f19c439e89a30bf26139a0$var$naiveFallback,$ab9a2fc9f2f19c439e89a30bf26139a0$executed=!1;function $ab9a2fc9f2f19c439e89a30bf26139a0$exec(){$ab9a2fc9f2f19c439e89a30bf26139a0$exports={},$ab9a2fc9f2f19c439e89a30bf26139a0$var$naiveFallback=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")},$ab9a2fc9f2f19c439e89a30bf26139a0$exports=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return $ab9a2fc9f2f19c439e89a30bf26139a0$var$naiveFallback()}try{return __global__||$ab9a2fc9f2f19c439e89a30bf26139a0$var$naiveFallback()}finally{delete Object.prototype.__global__}}()}function $ab9a2fc9f2f19c439e89a30bf26139a0$init(){return $ab9a2fc9f2f19c439e89a30bf26139a0$executed||($ab9a2fc9f2f19c439e89a30bf26139a0$executed=!0,$ab9a2fc9f2f19c439e89a30bf26139a0$exec()),$ab9a2fc9f2f19c439e89a30bf26139a0$exports}var $93f74e68f8d7783af15e97ca6ba2bd36$exports={},$93f74e68f8d7783af15e97ca6ba2bd36$var$_globalThis;try{$93f74e68f8d7783af15e97ca6ba2bd36$var$_globalThis=$ab9a2fc9f2f19c439e89a30bf26139a0$init()}catch(e){}finally{if($93f74e68f8d7783af15e97ca6ba2bd36$var$_globalThis||"undefined"==typeof window||($93f74e68f8d7783af15e97ca6ba2bd36$var$_globalThis=window),!$93f74e68f8d7783af15e97ca6ba2bd36$var$_globalThis)throw new Error("Could not determine global this")}var $93f74e68f8d7783af15e97ca6ba2bd36$var$NativeWebSocket=$93f74e68f8d7783af15e97ca6ba2bd36$var$_globalThis.WebSocket||$93f74e68f8d7783af15e97ca6ba2bd36$var$_globalThis.MozWebSocket,$85fef016e14b32659ae33f1857b29a0d$exports={},$66f07bf3bd38e05c359c5c5070f6fbb1$exports={};$66f07bf3bd38e05c359c5c5070f6fbb1$exports=JSON.parse('{"_args":[["websocket@1.0.33","/Users/ojack/PROJECTS/flujos"]],"_from":"websocket@1.0.33","_id":"websocket@1.0.33","_inBundle":false,"_integrity":"sha512-XwNqM2rN5eh3G2CUQE3OHZj+0xfdH42+OFK6LdC2yqiC0YU8e5UK0nYre220T0IyyN031V/XOvtHvXozvJYFWA==","_location":"/websocket","_optional":true,"_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"websocket@1.0.33","name":"websocket","escapedName":"websocket","rawSpec":"1.0.33","saveSpec":null,"fetchSpec":"1.0.33"},"_requiredBy":["/protoo-client"],"_resolved":"https://registry.npmjs.org/websocket/-/websocket-1.0.33.tgz","_spec":"1.0.33","_where":"/Users/ojack/PROJECTS/flujos","author":{"name":"Brian McKelvey","email":"theturtle32@gmail.com","url":"https://github.com/theturtle32"},"browser":"lib/browser.js","bugs":{"url":"https://github.com/theturtle32/WebSocket-Node/issues"},"config":{"verbose":false},"contributors":[{"name":"Iaki Baz Castillo","email":"ibc@aliax.net","url":"http://dev.sipdoc.net"}],"dependencies":{"bufferutil":"^4.0.1","debug":"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2","yaeti":"^0.0.6"},"description":"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.","devDependencies":{"buffer-equal":"^1.0.0","gulp":"^4.0.2","gulp-jshint":"^2.0.4","jshint":"^2.0.0","jshint-stylish":"^2.2.1","tape":"^4.9.1"},"directories":{"lib":"./lib"},"engines":{"node":">=4.0.0"},"homepage":"https://github.com/theturtle32/WebSocket-Node","keywords":["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],"license":"Apache-2.0","main":"index","name":"websocket","repository":{"type":"git","url":"git+https://github.com/theturtle32/WebSocket-Node.git"},"scripts":{"gulp":"gulp","test":"tape test/unit/*.js"},"version":"1.0.33"}'),$85fef016e14b32659ae33f1857b29a0d$exports=$66f07bf3bd38e05c359c5c5070f6fbb1$exports.version;var $93f74e68f8d7783af15e97ca6ba2bd36$var$websocket_version=$85fef016e14b32659ae33f1857b29a0d$exports;function $93f74e68f8d7783af15e97ca6ba2bd36$var$W3CWebSocket(e,a){return a?new $93f74e68f8d7783af15e97ca6ba2bd36$var$NativeWebSocket(e,a):new $93f74e68f8d7783af15e97ca6ba2bd36$var$NativeWebSocket(e)}$93f74e68f8d7783af15e97ca6ba2bd36$var$NativeWebSocket&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(e){Object.defineProperty($93f74e68f8d7783af15e97ca6ba2bd36$var$W3CWebSocket,e,{get:function(){return $93f74e68f8d7783af15e97ca6ba2bd36$var$NativeWebSocket[e]}})})),$93f74e68f8d7783af15e97ca6ba2bd36$exports={w3cwebsocket:$93f74e68f8d7783af15e97ca6ba2bd36$var$NativeWebSocket?$93f74e68f8d7783af15e97ca6ba2bd36$var$W3CWebSocket:null,version:$93f74e68f8d7783af15e97ca6ba2bd36$var$websocket_version};const $e17e243f41ba429b4719faa4f8a2e91e$var$W3CWebSocket=$93f74e68f8d7783af15e97ca6ba2bd36$exports.w3cwebsocket;var $8ff081482a48bba1886b38a3c2a469f2$exports={},$7d80b54b996e2c4ce94abf603a57cbf4$exports={},$2dbd5e12d47b84fea99f38eed15b618d$exports={};function $2dbd5e12d47b84fea99f38eed15b618d$var$RetryOperation(e,a){"boolean"==typeof a&&(a={forever:a}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=a||{},this._maxRetryTime=a&&a.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}$2dbd5e12d47b84fea99f38eed15b618d$exports=$2dbd5e12d47b84fea99f38eed15b618d$var$RetryOperation,$2dbd5e12d47b84fea99f38eed15b618d$var$RetryOperation.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},$2dbd5e12d47b84fea99f38eed15b618d$var$RetryOperation.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},$2dbd5e12d47b84fea99f38eed15b618d$var$RetryOperation.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var a=(new Date).getTime();if(e&&a-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var t=this._timeouts.shift();if(void 0===t){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),t=this._timeouts.shift()}var r=this,c=setTimeout((function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout((function(){r._operationTimeoutCb(r._attempts)}),r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)}),t);return this._options.unref&&c.unref(),!0},$2dbd5e12d47b84fea99f38eed15b618d$var$RetryOperation.prototype.attempt=function(e,a){this._fn=e,a&&(a.timeout&&(this._operationTimeout=a.timeout),a.cb&&(this._operationTimeoutCb=a.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){t._operationTimeoutCb()}),t._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},$2dbd5e12d47b84fea99f38eed15b618d$var$RetryOperation.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},$2dbd5e12d47b84fea99f38eed15b618d$var$RetryOperation.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},$2dbd5e12d47b84fea99f38eed15b618d$var$RetryOperation.prototype.start=$2dbd5e12d47b84fea99f38eed15b618d$var$RetryOperation.prototype.try,$2dbd5e12d47b84fea99f38eed15b618d$var$RetryOperation.prototype.errors=function(){return this._errors},$2dbd5e12d47b84fea99f38eed15b618d$var$RetryOperation.prototype.attempts=function(){return this._attempts},$2dbd5e12d47b84fea99f38eed15b618d$var$RetryOperation.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},a=null,t=0,r=0;r<this._errors.length;r++){var c=this._errors[r],s=c.message,d=(e[s]||0)+1;e[s]=d,d>=t&&(a=c,t=d)}return a};var $7d80b54b996e2c4ce94abf603a57cbf4$var$RetryOperation=$2dbd5e12d47b84fea99f38eed15b618d$exports,$7d80b54b996e2c4ce94abf603a57cbf4$export$operation=function(e){var a=$7d80b54b996e2c4ce94abf603a57cbf4$export$timeouts(e);return new $7d80b54b996e2c4ce94abf603a57cbf4$var$RetryOperation(a,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})};$7d80b54b996e2c4ce94abf603a57cbf4$exports.operation=$7d80b54b996e2c4ce94abf603a57cbf4$export$operation;var $7d80b54b996e2c4ce94abf603a57cbf4$export$timeouts=function(e){if(e instanceof Array)return[].concat(e);var a={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var t in e)a[t]=e[t];if(a.minTimeout>a.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],c=0;c<a.retries;c++)r.push(this.createTimeout(c,a));return e&&e.forever&&!r.length&&r.push(this.createTimeout(c,a)),r.sort((function(e,a){return e-a})),r};$7d80b54b996e2c4ce94abf603a57cbf4$exports.timeouts=$7d80b54b996e2c4ce94abf603a57cbf4$export$timeouts;var $7d80b54b996e2c4ce94abf603a57cbf4$export$createTimeout=function(e,a){var t=a.randomize?Math.random()+1:1,r=Math.round(t*a.minTimeout*Math.pow(a.factor,e));return r=Math.min(r,a.maxTimeout)};$7d80b54b996e2c4ce94abf603a57cbf4$exports.createTimeout=$7d80b54b996e2c4ce94abf603a57cbf4$export$createTimeout;var $7d80b54b996e2c4ce94abf603a57cbf4$export$wrap=function(e,a,t){if(a instanceof Array&&(t=a,a=null),!t)for(var r in t=[],e)"function"==typeof e[r]&&t.push(r);for(var c=0;c<t.length;c++){var s=t[c],d=e[s];e[s]=function(t){var r=$7d80b54b996e2c4ce94abf603a57cbf4$export$operation(a),c=Array.prototype.slice.call(arguments,1),s=c.pop();c.push((function(e){r.retry(e)||(e&&(arguments[0]=r.mainError()),s.apply(this,arguments))})),r.attempt((function(){t.apply(e,c)}))}.bind(e,d),e[s].options=a}};$7d80b54b996e2c4ce94abf603a57cbf4$exports.wrap=$7d80b54b996e2c4ce94abf603a57cbf4$export$wrap,$8ff081482a48bba1886b38a3c2a469f2$exports=$7d80b54b996e2c4ce94abf603a57cbf4$exports;const $e17e243f41ba429b4719faa4f8a2e91e$var$Logger=$101ba540d922a9103f2b36ca357c9ba5$exports,$e17e243f41ba429b4719faa4f8a2e91e$var$EnhancedEventEmitter=$a55a01021a0f490ef13fc2132572bba5$exports,$e17e243f41ba429b4719faa4f8a2e91e$var$WS_SUBPROTOCOL="protoo",$e17e243f41ba429b4719faa4f8a2e91e$var$DEFAULT_RETRY_OPTIONS={retries:10,factor:2,minTimeout:1e3,maxTimeout:8e3},$e17e243f41ba429b4719faa4f8a2e91e$var$logger=new $e17e243f41ba429b4719faa4f8a2e91e$var$Logger("WebSocketTransport");class $e17e243f41ba429b4719faa4f8a2e91e$var$WebSocketTransport extends $e17e243f41ba429b4719faa4f8a2e91e$var$EnhancedEventEmitter{constructor(e,a){super($e17e243f41ba429b4719faa4f8a2e91e$var$logger),$e17e243f41ba429b4719faa4f8a2e91e$var$logger.debug("constructor() [url:%s, options:%o]",e,a),this._closed=!1,this._url=e,this._options=a||{},this._ws=null,this._runWebSocket()}get closed(){return this._closed}close(){if(!this._closed){$e17e243f41ba429b4719faa4f8a2e91e$var$logger.debug("close()"),this._closed=!0,this.safeEmit("close");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(e){$e17e243f41ba429b4719faa4f8a2e91e$var$logger.error("close() | error closing the WebSocket: %o",e)}}}async send(e){if(this._closed)throw new Error("transport closed");try{this._ws.send(JSON.stringify(e))}catch(e){throw $e17e243f41ba429b4719faa4f8a2e91e$var$logger.warn("send() failed:%o",e),e}}_runWebSocket(){const e=$8ff081482a48bba1886b38a3c2a469f2$exports.operation(this._options.retry||$e17e243f41ba429b4719faa4f8a2e91e$var$DEFAULT_RETRY_OPTIONS);let a=!1;e.attempt((t=>{this._closed?e.stop():($e17e243f41ba429b4719faa4f8a2e91e$var$logger.debug("_runWebSocket() [currentAttempt:%s]",t),this._ws=new $e17e243f41ba429b4719faa4f8a2e91e$var$W3CWebSocket(this._url,$e17e243f41ba429b4719faa4f8a2e91e$var$WS_SUBPROTOCOL,this._options.origin,this._options.headers,this._options.requestOptions,this._options.clientConfig),this._ws.onopen=()=>{this._closed||(a=!0,this.safeEmit("open"))},this._ws.onclose=r=>{if(!this._closed){if($e17e243f41ba429b4719faa4f8a2e91e$var$logger.warn('WebSocket "close" event [wasClean:%s, code:%s, reason:"%s"]',r.wasClean,r.code,r.reason),4e3!==r.code){if(a){if(e.stop(),this.safeEmit("disconnected"),this._closed)return;return void this._runWebSocket()}if(this.safeEmit("failed",t),this._closed)return;if(e.retry(!0))return}this._closed=!0,this.safeEmit("close")}},this._ws.onerror=()=>{this._closed||$e17e243f41ba429b4719faa4f8a2e91e$var$logger.error('WebSocket "error" event')},this._ws.onmessage=e=>{if(this._closed)return;const a=$86d0dccef1e10ddd0df4d626eec36333$exports.parse(e.data);a&&(0!==this.listenerCount("message")?this.safeEmit("message",a):$e17e243f41ba429b4719faa4f8a2e91e$var$logger.error('no listeners for WebSocket "message" event, ignoring received message'))})}))}}$e17e243f41ba429b4719faa4f8a2e91e$exports=$e17e243f41ba429b4719faa4f8a2e91e$var$WebSocketTransport;const $86f5587e24816ad05909b9cc2a9770db$var$WebSocketTransport=$e17e243f41ba429b4719faa4f8a2e91e$exports;var $86f5587e24816ad05909b9cc2a9770db$export$Peer=$86f5587e24816ad05909b9cc2a9770db$var$Peer,$86f5587e24816ad05909b9cc2a9770db$export$WebSocketTransport=$86f5587e24816ad05909b9cc2a9770db$var$WebSocketTransport;$9ef8fa1341c22d7f2dffb07658fdb4ff$exports=class extends $47097ee663d5613230304ea01db841ae$exports.EventEmitter{constructor(){super(),this.peer=null,this.sendTransport=null,this.recvTransport=null}join(e="ws://localhost:2345"){const a=new $86f5587e24816ad05909b9cc2a9770db$export$WebSocketTransport(e);this.peer=new $86f5587e24816ad05909b9cc2a9770db$export$Peer(a),this.peer.on("open",this.onPeerOpen.bind(this)),this.peer.on("request",this.onPeerRequest.bind(this)),this.peer.on("notification",this.onPeerNotification.bind(this)),this.peer.on("failed",console.error),this.peer.on("disconnected",console.error),this.peer.on("close",console.error)}async sendAudio(e){const a=await this.sendTransport.produce({track:e});return a.on("trackended",(async()=>{await this._closeProducer(a)})),a}async sendVideo(e){const a=await this.sendTransport.produce({track:e});return a.on("trackended",(async()=>{await this._closeProducer(a)})),a}async onPeerOpen(){const e=new $10e1dd25d7ef981085f794456239c45d$exports.Device,a=await this.peer.request("getRouterRtpCapabilities").catch(console.error);await e.load({routerRtpCapabilities:a}),await this._prepareSendTransport(e).catch(console.error),await this._prepareRecvTransport(e).catch(console.error);const t=await this.peer.request("join",{rtpCapabilities:e.rtpCapabilities});this.emit("@open",t)}async _prepareSendTransport(e){const a=await this.peer.request("createWebRtcTransport",{producing:!0,consuming:!1}).catch(console.error);this.sendTransport=e.createSendTransport(a),this.sendTransport.on("connect",(({dtlsParameters:e},a,t)=>{this.peer.request("connectWebRtcTransport",{transportId:this.sendTransport.id,dtlsParameters:e}).then(a).catch(t)})),this.sendTransport.on("produce",(async({kind:e,rtpParameters:a,appData:t},r,c)=>{try{const{id:c}=await this.peer.request("produce",{transportId:this.sendTransport.id,kind:e,rtpParameters:a,appData:t});r({id:c})}catch(e){c(e)}}))}async _prepareRecvTransport(e){const a=await this.peer.request("createWebRtcTransport",{producing:!1,consuming:!0}).catch(console.error);this.recvTransport=e.createRecvTransport(a),this.recvTransport.on("connect",(({dtlsParameters:e},a,t)=>{this.peer.request("connectWebRtcTransport",{transportId:this.recvTransport.id,dtlsParameters:e}).then(a).catch(t)}))}async _closeProducer(e){e.close(),await this.peer.request("closeProducer",{producerId:e.id}).catch(console.error),this.emit("@producerClosed",{producerId:e.id})}onPeerRequest(e,a,t){switch(e.method){case"newConsumerOffer":a({accept:!0});break;case"newConsumer":this.recvTransport.consume(e.data).then((e=>{this.emit("@consumer",e),a()})).catch(t);break;default:a()}}onPeerNotification(e){this.emit("@"+e.method,e.data)}};const $7446334a50f2a0a9edc09a8962bee8ae$var$Room=$9ef8fa1341c22d7f2dffb07658fdb4ff$exports,$7446334a50f2a0a9edc09a8962bee8ae$var$EventEmitter=$47097ee663d5613230304ea01db841ae$exports;$7446334a50f2a0a9edc09a8962bee8ae$exports=class extends $7446334a50f2a0a9edc09a8962bee8ae$var$EventEmitter{constructor({videoEl:e,server:a="ws://localhost:2345",streamKey:t="test"}){super(),this.room=new $7446334a50f2a0a9edc09a8962bee8ae$var$Room,this.tracks={audio:null,video:null},this.isActive=!1;const r=`${a}/?stream=${t}`;console.log("connecting to",r),this.room.join(r),e||(e=document.createElement("video"),document.body.appendChild(e)),this.video=e,this.video.addEventListener("canplay",(e=>{})),this.room.on("@consumer",(async e=>{const{id:a,appData:{peerId:t},track:r}=e;this.addTrack(r,t,a)})),this.room.on("@consumerClosed",(e=>{console.log(e),console.log(e.consumerId),this.removeTrack(e.consumerId)})),this.room.on("@producerClosed",(({producerId:e})=>{console.log("producer closed")})),this.room.on("@peerClosed",(({peerId:e})=>{}))}addTrack(e,a,t){this.tracks[e.kind],this.tracks[e.kind]={track:e,peerId:a,consumerId:t},this.updateStream()}updateStream(){const e=new MediaStream;null!==this.tracks.audio&&e.addTrack(this.tracks.audio.track),null!==this.tracks.video&&e.addTrack(this.tracks.video.track),this.video.srcObject=e,this.isActive=!0,null===this.tracks.audio&&null===this.tracks.video&&(this.isActive=!1),this.emit("update",this.tracks)}removeTrack(e){null!==this.tracks.audio&&this.tracks.audio.consumerId===e&&(this.tracks.audio=null),null!==this.tracks.video&&this.tracks.video.consumerId===e&&(this.tracks.video=null),this.updateStream()}};const $94c28b103a4a6d930fad09b856750405$var$Viewer=$7446334a50f2a0a9edc09a8962bee8ae$exports;var $e0cf6fb2df47987f764a4892c6de7f19$exports={},$838e0c0147d239dd86f1e97d0f52d840$exports={},$5caf5ce6d952c9f1358b6f45e7a8aebf$exports={},$e71363ec7c3059781fd8c06beaa8fc96$exports={};$e71363ec7c3059781fd8c06beaa8fc96$exports=$e71363ec7c3059781fd8c06beaa8fc96$var$attributeToProperty;var $e71363ec7c3059781fd8c06beaa8fc96$var$transform={class:"className",for:"htmlFor","http-equiv":"httpEquiv"};function $e71363ec7c3059781fd8c06beaa8fc96$var$attributeToProperty(e){return function(a,t,r){for(var c in t)c in $e71363ec7c3059781fd8c06beaa8fc96$var$transform&&(t[$e71363ec7c3059781fd8c06beaa8fc96$var$transform[c]]=t[c],delete t[c]);return e(a,t,r)}}var $5caf5ce6d952c9f1358b6f45e7a8aebf$var$attrToProp=$e71363ec7c3059781fd8c06beaa8fc96$exports,$5caf5ce6d952c9f1358b6f45e7a8aebf$var$VAR=0,$5caf5ce6d952c9f1358b6f45e7a8aebf$var$TEXT=1,$5caf5ce6d952c9f1358b6f45e7a8aebf$var$OPEN=2,$5caf5ce6d952c9f1358b6f45e7a8aebf$var$CLOSE=3,$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR=4,$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY=5,$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY_W=6,$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_W=7,$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE=8,$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_SQ=9,$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_DQ=10,$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_EQ=11,$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_BREAK=12,$5caf5ce6d952c9f1358b6f45e7a8aebf$var$COMMENT=13;function $5caf5ce6d952c9f1358b6f45e7a8aebf$var$quot(e){return e===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_SQ||e===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_DQ}$5caf5ce6d952c9f1358b6f45e7a8aebf$exports=function(e,a){a||(a={});var t=a.concat||function(e,a){return String(e)+String(a)};return!1!==a.attrToProp&&(e=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$attrToProp(e)),function(c){for(var s=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$TEXT,d="",i=arguments.length,o=[],n=0;n<c.length;n++)if(n<i-1){var f=arguments[n+1],$=x(c[n]),b=s;b===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_DQ&&(b=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE),b===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_SQ&&(b=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE),b===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_W&&(b=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE),b===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR&&(b=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY),b===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$OPEN?"/"===d?($.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$OPEN,"/",f]),d=""):$.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$OPEN,f]):b===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$COMMENT&&a.comments?d+=String(f):b!==$5caf5ce6d952c9f1358b6f45e7a8aebf$var$COMMENT&&$.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$VAR,b,f]),o.push.apply(o,$)}else o.push.apply(o,x(c[n]));var p=[null,{},[]],l=[[p,-1]];for(n=0;n<o.length;n++){var m=l[l.length-1][0],u=($=o[n])[0];if(u===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$OPEN&&/^\//.test($[1])){var v=l[l.length-1][1];l.length>1&&(l.pop(),l[l.length-1][0][2][v]=e(m[0],m[1],m[2].length?m[2]:void 0))}else if(u===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$OPEN){var h=[$[1],{},[]];m[2].push(h),l.push([h,m[2].length-1])}else if(u===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY||u===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$VAR&&$[1]===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY){for(var g,_="";n<o.length;n++)if(o[n][0]===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY)_=t(_,o[n][1]);else{if(o[n][0]!==$5caf5ce6d952c9f1358b6f45e7a8aebf$var$VAR||o[n][1]!==$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY)break;if("object"!=typeof o[n][2]||_)_=t(_,o[n][2]);else for(g in o[n][2])o[n][2].hasOwnProperty(g)&&!m[1][g]&&(m[1][g]=o[n][2][g])}o[n][0]===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_EQ&&n++;for(var S=n;n<o.length;n++)if(o[n][0]===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE||o[n][0]===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY)m[1][_]?""===o[n][1]||(m[1][_]=t(m[1][_],o[n][1])):m[1][_]=r(o[n][1]);else{if(o[n][0]!==$5caf5ce6d952c9f1358b6f45e7a8aebf$var$VAR||o[n][1]!==$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE&&o[n][1]!==$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY){!_.length||m[1][_]||n!==S||o[n][0]!==$5caf5ce6d952c9f1358b6f45e7a8aebf$var$CLOSE&&o[n][0]!==$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_BREAK||(m[1][_]=_.toLowerCase()),o[n][0]===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$CLOSE&&n--;break}m[1][_]?""===o[n][2]||(m[1][_]=t(m[1][_],o[n][2])):m[1][_]=r(o[n][2])}}else if(u===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY)m[1][$[1]]=!0;else if(u===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$VAR&&$[1]===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY)m[1][$[2]]=!0;else if(u===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$CLOSE){if($5caf5ce6d952c9f1358b6f45e7a8aebf$var$selfClosing(m[0])&&l.length){v=l[l.length-1][1];l.pop(),l[l.length-1][0][2][v]=e(m[0],m[1],m[2].length?m[2]:void 0)}}else if(u===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$VAR&&$[1]===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$TEXT)void 0===$[2]||null===$[2]?$[2]="":$[2]||($[2]=t("",$[2])),Array.isArray($[2][0])?m[2].push.apply(m[2],$[2]):m[2].push($[2]);else if(u===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$TEXT)m[2].push($[1]);else if(u!==$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_EQ&&u!==$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_BREAK)throw new Error("unhandled: "+u)}if(p[2].length>1&&/^\s*$/.test(p[2][0])&&p[2].shift(),p[2].length>2||2===p[2].length&&/\S/.test(p[2][1])){if(a.createFragment)return a.createFragment(p[2]);throw new Error("multiple root elements must be wrapped in an enclosing tag")}return Array.isArray(p[2][0])&&"string"==typeof p[2][0][0]&&Array.isArray(p[2][0][2])&&(p[2][0]=e(p[2][0][0],p[2][0][1],p[2][0][2])),p[2][0];function x(e){var t=[];s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_W&&(s=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR);for(var r=0;r<e.length;r++){var c=e.charAt(r);s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$TEXT&&"<"===c?(d.length&&t.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$TEXT,d]),d="",s=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$OPEN):">"!==c||$5caf5ce6d952c9f1358b6f45e7a8aebf$var$quot(s)||s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$COMMENT?s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$COMMENT&&/-$/.test(d)&&"-"===c?(a.comments&&t.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE,d.substr(0,d.length-1)]),d="",s=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$TEXT):s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$OPEN&&/^!--$/.test(d)?(a.comments&&t.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$OPEN,d],[$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY,"comment"],[$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_EQ]),d=c,s=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$COMMENT):s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$TEXT||s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$COMMENT?d+=c:s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$OPEN&&"/"===c&&d.length||(s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$OPEN&&/\s/.test(c)?(d.length&&t.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$OPEN,d]),d="",s=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR):s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$OPEN?d+=c:s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR&&/[^\s"'=/]/.test(c)?(s=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY,d=c):s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR&&/\s/.test(c)?(d.length&&t.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY,d]),t.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_BREAK])):s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY&&/\s/.test(c)?(t.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY,d]),d="",s=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY_W):s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY&&"="===c?(t.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY,d],[$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_EQ]),d="",s=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_W):s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY?d+=c:s!==$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY_W&&s!==$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR||"="!==c?s!==$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY_W&&s!==$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR||/\s/.test(c)?s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_W&&'"'===c?s=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_DQ:s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_W&&"'"===c?s=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_SQ:s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_DQ&&'"'===c||s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_SQ&&"'"===c?(t.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE,d],[$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_BREAK]),d="",s=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR):s!==$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_W||/\s/.test(c)?s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE&&/\s/.test(c)?(t.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE,d],[$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_BREAK]),d="",s=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR):s!==$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE&&s!==$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_SQ&&s!==$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_DQ||(d+=c):(s=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE,r--):(t.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_BREAK]),/[\w-]/.test(c)?(d+=c,s=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY):s=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR):(t.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_EQ]),s=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_W)):(s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$OPEN&&d.length?t.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$OPEN,d]):s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY?t.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY,d]):s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE&&d.length&&t.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE,d]),t.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$CLOSE]),d="",s=$5caf5ce6d952c9f1358b6f45e7a8aebf$var$TEXT)}return s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$TEXT&&d.length?(t.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$TEXT,d]),d=""):s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE&&d.length||s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_DQ&&d.length||s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE_SQ&&d.length?(t.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_VALUE,d]),d=""):s===$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY&&(t.push([$5caf5ce6d952c9f1358b6f45e7a8aebf$var$ATTR_KEY,d]),d=""),t}};function r(e){return"function"==typeof e||"string"==typeof e||e&&"object"==typeof e||null==e?e:t("",e)}};var $5caf5ce6d952c9f1358b6f45e7a8aebf$var$closeRE=RegExp("^("+["area","base","basefont","bgsound","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr","!--","animate","animateTransform","circle","cursor","desc","ellipse","feBlend","feColorMatrix","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","font-face-format","font-face-name","font-face-uri","glyph","glyphRef","hkern","image","line","missing-glyph","mpath","path","polygon","polyline","rect","set","stop","tref","use","view","vkern"].join("|")+")(?:[.#][a-zA-Z0-9-_:-]+)*$");function $5caf5ce6d952c9f1358b6f45e7a8aebf$var$selfClosing(e){return $5caf5ce6d952c9f1358b6f45e7a8aebf$var$closeRE.test(e)}var $838e0c0147d239dd86f1e97d0f52d840$var$hyperx=$5caf5ce6d952c9f1358b6f45e7a8aebf$exports,$aced84e58576f349c2e316658b78b29a$exports={},$aced84e58576f349c2e316658b78b29a$var$trailingNewlineRegex=/\n[\s]+$/,$aced84e58576f349c2e316658b78b29a$var$leadingNewlineRegex=/^\n[\s]+/,$aced84e58576f349c2e316658b78b29a$var$trailingSpaceRegex=/[\s]+$/,$aced84e58576f349c2e316658b78b29a$var$leadingSpaceRegex=/^[\s]+/,$aced84e58576f349c2e316658b78b29a$var$multiSpaceRegex=/[\n\s]+/g,$aced84e58576f349c2e316658b78b29a$var$TEXT_TAGS=["a","abbr","b","bdi","bdo","br","cite","data","dfn","em","i","kbd","mark","q","rp","rt","rtc","ruby","s","amp","small","span","strong","sub","sup","time","u","var","wbr"],$aced84e58576f349c2e316658b78b29a$var$VERBATIM_TAGS=["code","pre","textarea"];$aced84e58576f349c2e316658b78b29a$exports=function e(a,t){if(Array.isArray(t))for(var r,c,s=a.nodeName.toLowerCase(),d=!1,i=0,o=t.length;i<o;i++){var n=t[i];if(Array.isArray(n))e(a,n);else{("number"==typeof n||"boolean"==typeof n||"function"==typeof n||n instanceof Date||n instanceof RegExp)&&(n=n.toString());var f=a.childNodes[a.childNodes.length-1];if("string"==typeof n)d=!0,f&&"#text"===f.nodeName?f.nodeValue+=n:(n=a.ownerDocument.createTextNode(n),a.appendChild(n),f=n),i===o-1&&(d=!1,-1===$aced84e58576f349c2e316658b78b29a$var$TEXT_TAGS.indexOf(s)&&-1===$aced84e58576f349c2e316658b78b29a$var$VERBATIM_TAGS.indexOf(s)?""===(r=f.nodeValue.replace($aced84e58576f349c2e316658b78b29a$var$leadingNewlineRegex,"").replace($aced84e58576f349c2e316658b78b29a$var$trailingSpaceRegex,"").replace($aced84e58576f349c2e316658b78b29a$var$trailingNewlineRegex,"").replace($aced84e58576f349c2e316658b78b29a$var$multiSpaceRegex," "))?a.removeChild(f):f.nodeValue=r:-1===$aced84e58576f349c2e316658b78b29a$var$VERBATIM_TAGS.indexOf(s)&&(c=0===i?"":" ",r=f.nodeValue.replace($aced84e58576f349c2e316658b78b29a$var$leadingNewlineRegex,c).replace($aced84e58576f349c2e316658b78b29a$var$leadingSpaceRegex," ").replace($aced84e58576f349c2e316658b78b29a$var$trailingSpaceRegex,"").replace($aced84e58576f349c2e316658b78b29a$var$trailingNewlineRegex,"").replace($aced84e58576f349c2e316658b78b29a$var$multiSpaceRegex," "),f.nodeValue=r));else if(n&&n.nodeType){d&&(d=!1,-1===$aced84e58576f349c2e316658b78b29a$var$TEXT_TAGS.indexOf(s)&&-1===$aced84e58576f349c2e316658b78b29a$var$VERBATIM_TAGS.indexOf(s)?""===(r=f.nodeValue.replace($aced84e58576f349c2e316658b78b29a$var$leadingNewlineRegex,"").replace($aced84e58576f349c2e316658b78b29a$var$trailingNewlineRegex," ").replace($aced84e58576f349c2e316658b78b29a$var$multiSpaceRegex," "))?a.removeChild(f):f.nodeValue=r:-1===$aced84e58576f349c2e316658b78b29a$var$VERBATIM_TAGS.indexOf(s)&&(r=f.nodeValue.replace($aced84e58576f349c2e316658b78b29a$var$leadingSpaceRegex," ").replace($aced84e58576f349c2e316658b78b29a$var$leadingNewlineRegex,"").replace($aced84e58576f349c2e316658b78b29a$var$trailingNewlineRegex," ").replace($aced84e58576f349c2e316658b78b29a$var$multiSpaceRegex," "),f.nodeValue=r));var $=n.nodeName;$&&(s=$.toLowerCase()),a.appendChild(n)}}}};var $838e0c0147d239dd86f1e97d0f52d840$var$appendChild=$aced84e58576f349c2e316658b78b29a$exports,$1c6365ec1e4bac3b720edd9d91fe0ee1$exports={};$1c6365ec1e4bac3b720edd9d91fe0ee1$exports=["svg","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","stop","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"];var $1db694e2e5e6ae07bd4bc33bfc4b2d18$exports={};$1db694e2e5e6ae07bd4bc33bfc4b2d18$exports=["async","autofocus","autoplay","checked","controls","default","defaultchecked","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","novalidate","open","playsinline","readonly","required","reversed","selected"];var $05a363fbc3d11ad9a6d935d7659ed2ba$exports={};$05a363fbc3d11ad9a6d935d7659ed2ba$exports=["indeterminate"];var $838e0c0147d239dd86f1e97d0f52d840$var$SVGNS="http://www.w3.org/2000/svg",$838e0c0147d239dd86f1e97d0f52d840$var$XLINKNS="http://www.w3.org/1999/xlink",$838e0c0147d239dd86f1e97d0f52d840$var$COMMENT_TAG="!--";$838e0c0147d239dd86f1e97d0f52d840$exports=function(e){function a(a,t,r){var c;-1!==$1c6365ec1e4bac3b720edd9d91fe0ee1$exports.indexOf(a)&&(t.namespace=$838e0c0147d239dd86f1e97d0f52d840$var$SVGNS);var s=!1;t.namespace&&(s=t.namespace,delete t.namespace);var d=!1;if(t.is&&(d=t.is,delete t.is),s)c=d?e.createElementNS(s,a,{is:d}):e.createElementNS(s,a);else{if(a===$838e0c0147d239dd86f1e97d0f52d840$var$COMMENT_TAG)return e.createComment(t.comment);c=d?e.createElement(a,{is:d}):e.createElement(a)}for(var i in t)if(t.hasOwnProperty(i)){var o=i.toLowerCase(),n=t[i];if("classname"===o&&(o="class",i="class"),"htmlFor"===i&&(i="for"),-1!==$1db694e2e5e6ae07bd4bc33bfc4b2d18$exports.indexOf(o))if("true"===String(n))n=o;else if("false"===String(n))continue;"on"===o.slice(0,2)||-1!==$05a363fbc3d11ad9a6d935d7659ed2ba$exports.indexOf(o)?c[i]=n:s?"xlink:href"===i?c.setAttributeNS($838e0c0147d239dd86f1e97d0f52d840$var$XLINKNS,i,n):/^xmlns($|:)/i.test(i)||c.setAttributeNS(null,i,n):c.setAttribute(i,n)}return $838e0c0147d239dd86f1e97d0f52d840$var$appendChild(c,r),c}var t=$838e0c0147d239dd86f1e97d0f52d840$var$hyperx(a,{comments:!0,createFragment:function a(t){for(var r=e.createDocumentFragment(),c=0;c<t.length;c++)null!=t[c]&&(Array.isArray(t[c])?r.appendChild(a(t[c])):("string"==typeof t[c]&&(t[c]=e.createTextNode(t[c])),r.appendChild(t[c])));return r}});return t.default=t,t.createComment=a,t},$e0cf6fb2df47987f764a4892c6de7f19$exports=$838e0c0147d239dd86f1e97d0f52d840$exports(document);const $94c28b103a4a6d930fad09b856750405$var$html=$e0cf6fb2df47987f764a4892c6de7f19$exports;function $94c28b103a4a6d930fad09b856750405$var$createVideo({width:e=300,height:a=200}={},t=(()=>{})){const r=$94c28b103a4a6d930fad09b856750405$var$html`<video style="width:${e};height:${a};clip-path:circle(${a/2}px at ${e/2}px ${a/2}px)"></video>`;return r.autoplay=!0,r.addEventListener("loadeddata",t),r}$94c28b103a4a6d930fad09b856750405$exports=()=>{let e=!1;const a="wss://mediasoup.tentacles.live:8000";if(!e){const t=$94c28b103a4a6d930fad09b856750405$var$createVideo({},(()=>{setTimeout((()=>{t.play()}),600)})),r=$94c28b103a4a6d930fad09b856750405$var$createVideo({},(()=>{t.play()})),c=$94c28b103a4a6d930fad09b856750405$var$html`<div class="absolute right-0 top-0 fr">${t}${r}</div>`;document.body.appendChild(c);new $94c28b103a4a6d930fad09b856750405$var$Viewer({videoEl:t,server:a,streamKey:"flujos"}),new $94c28b103a4a6d930fad09b856750405$var$Viewer({videoEl:r,server:a,streamKey:"flujos2"});e=!0}};var $6ad8e1b8df8271dd48f7ed82991babeb$exports={};const $6ad8e1b8df8271dd48f7ed82991babeb$var$html=$e0cf6fb2df47987f764a4892c6de7f19$exports;$6ad8e1b8df8271dd48f7ed82991babeb$exports=()=>{const e=$6ad8e1b8df8271dd48f7ed82991babeb$var$html`<canvas class="w-100 h-100"></canvas>`;e.width=window.innerWidth,e.height=window.innerHeight,document.body.appendChild(e);new Hydra({detectAudio:!1,canvas:e});speed=.5,osc(10,.03,1.2).color(1,.3,.6).add(osc(15,-.1).color(.1,.9,.3)).out(),src(o1).layer(src(o0).mask(osc(10,-.1).rotate(0,.1).modulate(osc(10).thresh(.8,.4)).kaleid(2).thresh(.9,0)),0).modulate(osc(20),-.004,1.02).modulate(src(o1).color(1,0),.1).contrast(1.1).blend(o0,(()=>.5*Math.sin(.1*time)+.5)).out(o1),render(o1)};var $5e7f5133aa180791b144f0ec224707ca$exports=function(){var exports=this,module={exports:this};const initStreamingMedia=$94c28b103a4a6d930fad09b856750405$exports,initHydra=$6ad8e1b8df8271dd48f7ed82991babeb$exports,html=$e0cf6fb2df47987f764a4892c6de7f19$exports,flokURL="https://flok.clic.cf/s/NjUxMWM2MjUtOTFlZi00NzNiLWJhNTUtMzVhNWIwY2U0MmFm?layout=hydra,hydra&noHydra=1&bgOpacity=0",queryString=window.location.search,urlParams=new URLSearchParams(queryString),edit=urlParams.get("edit"),readOnly=1!=edit;initHydra();const intro=html`<div class="pa4 i f3"> <h1 class="f1 i"> flujos </h1>
    <p class="f3"> web_site_specific performance</p>
    <p class="f3">by Celeste Betancur and Olivia Jack </p>
    <div onclick=${start} class="pointer dim"> ${">>>"} enter ${"<<<<"} </div>
    </div>`,uiContainer=html`<div class="w-100 h-100 absolute top-0 left-0 overflow-y-auto">${intro}</div>`,editor=html`<div class="absolute mb5 bottom-0 left-0 w-100 skewY" style="height:40%">
<iframe src="${flokURL}${readOnly?"&readonly=1":""}" frameborder="0" class="w-100 h-100"></iframe>
</div>`;function start(){uiContainer.innerHTML="",uiContainer.appendChild(editor),initStreamingMedia()}return window.addEventListener("message",(function(event){event.data&&"evaluateCode"===event.data.cmd&&eval(event.data.args.body)})),document.body.appendChild(uiContainer),module.exports}.call({})})();
//# sourceMappingURL=index.dec001af.js.map
